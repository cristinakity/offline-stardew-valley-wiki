<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from stardewvalleywiki.com/mediawiki/index.php?title=Modding:Common_tasks&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 11 Apr 2024 05:50:07 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>View source for Modding:Common tasks - Stardew Valley Wiki</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":!0,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"bd98b51eb5eb99fbabe2c77a","wgCSPNonce":!1,"wgCanonicalNamespace":"Modding","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":570,"wgPageName":"Modding:Common_tasks","wgTitle":"Common tasks","wgCurRevisionId":149461,"wgRevisionId":0,"wgArticleId":8061,"wgIsArticle":!1,"wgIsRedirect":!1,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"Modding:Common_tasks","wgRelevantArticleId":8061,"wgIsProbablyEditable":!1,"wgRelevantPageIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgMFMode":"stable","wgMFAmc":!1,"wgMFAmcOutreachActive":!1,
"wgMFAmcOutreachUserEligible":!1,"wgMFLazyLoadImages":!0,"wgMFDisplayWikibaseDescriptions":{"search":!1,"nearby":!1,"watchlist":!1,"tagline":!1},"wgMFIsPageContentModelEditable":!0,"wgCargoMapClusteringMinimum":80,"wgCargoMonthNames":["January","February","March","April","May","June","July","August","September","October","November","December"],"wgCargoMonthNamesShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgCargoWeekDays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"wgCargoWeekDaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"wgMinervaPermissions":{"watch":!0,"talk":!1},"wgMinervaFeatures":{"beta":!1,"donate":!0,"mobileOptionsLink":!0,"categories":!1,"pageIssues":!0,"talkAtTop":!1,"historyInPageActions":!1,"overflowSubmenu":!1,"tabsOnSpecials":!1,"personalMenu":!1,"mainMenuExpanded":!1,"simplifiedTalk":!0},"wgMinervaDownloadNamespaces":[0],"wgSiteNoticeId":
"1.0"};RLSTATE={"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","mediawiki.ui.input":"ready","mediawiki.ui.checkbox":"ready","skins.minerva.base.styles":"ready","skins.minerva.content.styles":"ready","skins.minerva.content.styles.images":"ready","mediawiki.hlist":"ready","mediawiki.ui.icon":"ready","mediawiki.ui.button":"ready","skins.minerva.icons.wikimedia":"ready","skins.minerva.mainMenu.icons":"ready","skins.minerva.mainMenu.styles":"ready","mobile.init.styles":"ready","mobile.messageBox.styles":"ready","ext.dismissableSiteNotice.styles":"ready"};RLPAGEMODULES=["site","mediawiki.page.startup","skins.minerva.options","skins.minerva.scripts","mobile.init","ext.dismissableSiteNotice"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@1hzgi",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});});</script>
<link rel="stylesheet" href="load85db.css?lang=en&amp;modules=ext.dismissableSiteNotice.styles%7Cmediawiki.hlist%7Cmediawiki.ui.button%2Ccheckbox%2Cicon%2Cinput%7Cmobile.init.styles%7Cmobile.messageBox.styles%7Cskins.minerva.base.styles%7Cskins.minerva.content.styles%7Cskins.minerva.content.styles.images%7Cskins.minerva.icons.wikimedia%7Cskins.minerva.mainMenu.icons%2Cstyles&amp;only=styles&amp;skin=minerva"/>
<script async="" src="loadc82b.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=minerva&amp;target=mobile"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="load1154.css?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=minerva"/>
<meta name="generator" content="MediaWiki 1.35.1"/>
<meta name="robots" content="noindex,nofollow"/>
<meta name="description" content="You do not have permission to edit this page, for the following reason:"/>
<meta name="theme-color" content="#eaecf0"/>
<meta name="viewport" content="initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0, width=device-width"/>
<link rel="manifest" href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/api.php?action=webapp-manifest"/>
<link rel="shortcut icon" href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/favicon.png"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/opensearch_desc.php" title="Stardew Valley Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="../../external.html?link=http://stardewvalleywiki.com/mediawiki/api.php?action=rsd"/>
<link rel="license" href="../../external.html?link=https://creativecommons.org/licenses/by-nc-sa/3.0/"/>
<meta property="og:title" content="View source for Modding:Common tasks - Stardew Valley Wiki"/>
<meta property="og:site_name" content="Stardew Valley Wiki"/>
<meta property="og:url" content="https://stardewvalleywiki.com/Modding:Common_tasks"/>
<meta property="og:description" content="← Index"/>
<meta property="og:image" content="https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/site_logo_sm.png"/>
<meta property="article:modified_time" content="2023-07-29T19:22:48Z"/>
<meta property="article:published_time" content="2023-07-29T19:22:48Z"/>
<meta property="twitter:site" content="@stardewwiki"/>
<meta property="twitter:title" content="View source for Modding:Common tasks - Stardew Valley Wiki"/>
<meta property="twitter:description" content="← Index"/>
<meta property="twitter:image" content="https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/site_logo_sm.png"/>
<meta property="twitter:card" content="summary_large_image"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"article","name":"View source for Modding:Common tasks - Stardew Valley Wiki","headline":"View source for Modding:Common tasks - Stardew Valley Wiki","mainEntityOfPage":"View source for Modding:Common tasks","identifier":"https:\/\/stardewvalleywiki.com\/Modding:Common_tasks","url":"https:\/\/stardewvalleywiki.com\/Modding:Common_tasks","description":"\u2190 Index","dateModified":"2023-07-29T19:22:48Z","datePublished":"2023-07-29T19:22:48Z","image":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png"},"author":{"@type":"Organization","name":"Stardew Valley Wiki","url":"\/\/stardewvalleywiki.com","logo":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png","caption":"Stardew Valley Wiki"}},"publisher":{"@type":"Organization","name":"Stardew Valley Wiki","url":"\/\/stardewvalleywiki.com","logo":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png","caption":"Stardew Valley Wiki"}},"potentialAction":{"@type":"SearchAction","target":"https:\/\/stardewvalleywiki.com\/mediawiki\/index.php?title=Special:Search&search={search_term}","query-input":"required name=search_term"}}</script>
<!--[if lt IE 9]><script src="/mediawiki/resources/lib/html5shiv/html5shiv.js"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-570 ns-subject page-Modding_Common_tasks rootpage-Modding_Common_tasks stable skin-minerva action-edit skin-vector-legacy">
<div id="mw-mf-viewport">
	<div id="mw-mf-page-center">
		<a class="mw-mf-page-center__mask" href="#"></a>
		<header class="header-container header-chrome">
			<form class="header" action="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php" method="get">
				<nav class="navigation-drawer toggle-list view-border-box">
					<input type="checkbox" id="main-menu-input" class="toggle-list__checkbox" role="button" aria-labelledby="mw-mf-main-menu-button">
					<label for="main-menu-input" id="mw-mf-main-menu-button"
						class="mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-menu-base20 mw-ui-icon-flush-left toggle-list__toggle"
						title="Open main menu" data-event-name="ui.mainmenu">Open main menu</label>
					<div id="mw-mf-page-left" class="menu toggle-list__list view-border-box">
	<ul id="p-navigation">
			<li class="">
			    <a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki" class="mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-home" data-event-name="menu.home"><span>Home</span></a>
			</li>
			<li class="">
			    <a href="../../external.html?link=https://stardewvalleywiki.com/Special:Random#/random" class="mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-die " data-event-name="menu.random"><span>Random</span></a>
			</li>
	</ul>
	<ul id="p-personal">
			<li class="">
			    <a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Special:UserLogin&amp;returnto=Modding%3ACommon+tasks&amp;returntoquery=action%3Dedit" class="menu__item--login mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-logIn " data-event-name="menu.login"><span>Log in</span></a>
			</li>
	</ul>
	<ul id="pt-preferences">
			<li class="jsonly">
			    <a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Special:MobileOptions&amp;returnto=Modding%3ACommon+tasks" class="menu__item--settings mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-settings " data-event-name="menu.settings"><span>Settings</span></a>
			</li>
	</ul>
	<ul class="hlist">
			<li class="">
			    <a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:About" class="" data-event-name=""><span>About Stardew Valley Wiki</span></a>
			</li>
			<li class="">
			    <a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:General_disclaimer" class="" data-event-name=""><span>Disclaimers</span></a>
			</li>
	</ul>
</div>

					<label class="main-menu-mask" for="main-menu-input"></label>
				</nav>
				<div class="branding-box">
					<a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki">
						<span>Stardew Valley Wiki</span>
						
					</a>
				</div>
				<div class="search-box">
					<input class="search mw-ui-background-icon-search skin-minerva-search-trigger" type="search" name="search" id="searchInput"
						autocomplete="off" placeholder="Search Stardew Valley Wiki" aria-label="Search Stardew Valley Wiki"
						value="">
				</div>
				<nav class="minerva-user-navigation" aria-label="User navigation">
					<div><button id="searchIcon" class="mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-search-base20 skin-minerva-search-trigger" type="submit">Search</button></div>
					
				</nav>
			</form>
		</header>
		<main id="content" class="mw-body">
			<div class="banner-container">
			<div id="siteNotice"></div>
			</div>
			
			<div class="pre-content heading-holder">
				<div class="page-heading">
					<h1 id="section_0">View source for Modding:Common tasks</h1>
					<div class="tagline"></div>
				</div>
				
				
				
				<div class="minerva__subtitle">← <a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Common_tasks" title="Modding:Common tasks">Modding:Common tasks</a></div>
			</div>
			
			<div id="bodyContent" class="content"><div id="mw-content-text"><script>function mfTempOpenSection(id){var block=document.getElementById("mf-section-"+id);block.className+=" open-block";block.previousSibling.className+=" open-block";}</script><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in the group: <a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Stardew_Valley_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Stardew Valley Wiki:Users (page does not exist)">Users</a>.
</p>
</div><hr />
<p>You can view and copy the source of this page.
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" class="mw-editfont-monospace mw-ui-input" lang="en" dir="ltr" name="wpTextbox1">← [[Modding:Index|Index]]
{{stub|Missing information&lt;li>Requires more formal, objective language cleanup&lt;/li>}}

This page covers how to do common tasks in SMAPI mods. '''Before reading this page, see the [[Modding:Modder Guide/Get Started|Modder Guide]] and [[Modding:Modder Guide/Game Fundamentals|Game Fundamentals]].'''

==Basic techniques==
===Tracking changes to a value===
Mods often need to know when a value changed. If there's no SMAPI event for the value, you can create a private [https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/fields field] to track the value, and update it using the update tick event.

See [[Modding:Modder Guide/APIs/Events#Change monitoring]] for an example.

==Items==
Items are objects which represent things which can be put in an inventory. Tools, Crops, etc. 

===Create an item (Object)===
All constructors for Object:

&lt;syntaxhighlight lang='c#'>
 public Object(Vector2 tileLocation, int parentSheetIndex, int initialStack);
 public Object(Vector2 tileLocation, int parentSheetIndex, bool isRecipe = false);
 public Object(int parentSheetIndex, int initialStack, bool isRecipe = false, int price = -1, int quality = 0);
 public Object(Vector2 tileLocation, int parentSheetIndex, string Givenname, bool canBeSetDown, bool canBeGrabbed, bool isHoedirt, bool isSpawnedObject);
&lt;/syntaxhighlight>

Where '''parentSheetIndex''' is the ID of the item (can be found in ObjectInformation.xnb).

===Spawn an item on the ground===

You can spawn an item on the ground with the &lt;samp>[[Modding:Modder_Guide/Game_Fundamentals#GameLocation_et_al|GameLocation]]&lt;/samp> class's &lt;samp>dropObject&lt;/samp> method:

&lt;syntaxhighlight lang='c#'>
 public virtual bool dropObject(Object obj, Vector2 dropLocation, xTile.Dimensions.Rectangle viewport, bool initialPlacement, Farmer who = null);

 // Concrete code for spawning:
 Game1.getLocationFromName("Farm").dropObject(new StardewValley.Object(itemId, 1, false, -1, 0), new Vector2(x, y) * 64f, Game1.viewport, true, (Farmer)null);
&lt;/syntaxhighlight>

===Add an item to an inventory===
&lt;syntaxhighlight lang='c#'>
//You can add items found in ObjectInformation using:
    Game1.player.addItemByMenuIfNecessary((Item)new StardewValley.Object(int parentSheetIndex, int initialStack, [bool isRecipe = false], [int price = -1], [int quality = 0]));
&lt;/syntaxhighlight>

Another example:

&lt;syntaxhighlight lang='c#'>
    // Add a weapon directly into player's inventory
    const int WEAP_ID = 19;                  // Shadow Dagger -- see Data/weapons
    Item weapon = new MeleeWeapon(WEAP_ID);  // MeleeWeapon is a class in StardewValley.Tools
    Game1.player.addItemByMenuIfNecessary(weapon);

    // Note: This code WORKS.
&lt;/syntaxhighlight>

===Remove an item from an inventory===

This is dependent on the inventory - rarely will you be calling this directly, as the game has functions for this for the Player, located in Farmer (in the main namespace).

To do so, in most situations, just call .removeItemFromInventory(Item)

==Locations==
See [[Modding:Modder Guide/Game Fundamentals#GameLocation|Game Fundamentals#GameLocation]].

===Get all locations===
The list of root locations is stored in &lt;samp>Game1.locations&lt;/samp>, but constructed building interiors aren't included. Instead, use the method &lt;samp>Utility.ForAllLocations&lt;/samp>
&lt;syntaxhighlight lang="c#">
Utility.ForAllLocations((GameLocation location) =>
{
   // do things with location here.
});
&lt;/syntaxhighlight>

Note that farmhands in multiplayer can't see all locations; see [[Modding:Modder Guide/APIs/Multiplayer#GetActiveLocations|&lt;samp>GetActiveLocations&lt;/samp>]] instead.

===Edit a location map===
See [[Modding:Maps]].

===Position===
A Character's position indicates the Character's coordinates in the current location. 

====Position Relative to the Map====
Each location has an ``xTile`` map where the top-left corner of the map is ''(0, 0)'' and the bottom-right corner of the map is ''(location.Map.DisplayWidth, location.Map.DisplayHeight)'' in pixels. 

There are two ways to get a Character's position in the current location: by absolute position and by tile position.

&lt;code>Position.X&lt;/code> and &lt;code>Position.Y&lt;/code> will give the XY coordinates in pixels.

&lt;code>getTileX()&lt;/code> and &lt;code>getTileY()&lt;/code> will give the XY coordinates in tiles.

Each tile is 64x64 pixels as specified by &lt;code>Game1.tileSize&lt;/code>. The conversion between absolute and tile is as follows:
&lt;syntaxhighlight lang='c#'>
// Absolute position => Tile position
Math.Floor(Game1.player.Position.X / Game1.tileSize)
Math.Floor(Game1.player.Position.Y / Game1.tileSize)

// Tile position => Absolute position
Game1.player.getTileX() * Game1.tileSize
Game1.player.getTileY() * Game1.tileSize

// Tilemap dimensions
Math.Floor(Game1.player.currentLocation.Map.DisplayWidth / Game1.tileSize)
Math.Floor(Game1.player.currentLocation.Map.DisplayHeight / Game1.tileSize)
&lt;/syntaxhighlight>

====Position Relative to the Viewport====
The viewport represents the visible area on the screen. Its dimensions are &lt;code>Game1.viewport.Width&lt;/code> by &lt;code>Game1.viewport.Height&lt;/code> in pixels; this is the same as the game's screen resolution.

The viewport also has an absolute position relative to the map, where the top-left corner of the viewport is at ''(Game1.viewport.X, Game1.viewport.Y)''. 


The player's position in pixels relative to the viewport is as follows:
&lt;syntaxhighlight lang='c#'>
Game1.player.Position.X - Game1.viewport.X
Game1.player.Position.Y - Game1.viewport.Y
&lt;/syntaxhighlight>

==NPC==
===Creating Custom NPCs===
Adding new NPCs involves editing a number of files:

* New file: [[Modding:Dialogue|Characters\Dialogue\&lt;name>.json]] (See also [[Modding:Event data]])
* New file: [[Modding:Schedule data|Characters\schedules\&lt;name>.json]] (Note that the "s" in the "schedules" folder is lowercase!)
* New file: [[Modding:NPC data#Portraits|Portraits\&lt;name>.png]]
* New file: [[Modding:NPC data#Overworld sprites|Characters\&lt;name>.png]]
* Add entries [[Modding:Dialogue#Engagement dialogue|Data\EngagementDialogue]] for NPCs that are marriable
* Add entry to [[Modding:NPC data#Basic info|Data\NPCDispositions]]
* Add entry to [[Modding:Gift taste data|Data\NPCGiftTastes]]
* Add entries to [[Modding:Dialogue#Rain dialogue|Characters\Dialogue\rainy]]
* Add entries to [[Modding:Schedule data#Schedule points|Data\animationDescriptions]] (if you want custom animations in their schedule)

All of the above can be done with an AssetRequested event or Content Patcher. If you did all of this correctly, the game will spawn the NPC in for you. (If you didn't, it swallows the error)

==User-interface (UI)==
The User-interface (UI) is a collection of separate elements which make up the HUD and occasional popups.

//TODO: This section needs to be expanded.  Please contribute if you have knowledge in this area.

===Banner message===
HUDMessage are those popups in the lower left hand screen. They have several constructors, which we will briefly go over here (a few non-relevant constructors are not included):

&lt;syntaxhighlight lang="c#">
  public HUDMessage(string message);
  public HUDMessage(string message, int whatType);
  public HUDMessage(string type, int number, bool add, Color color, Item messageSubject = null);
  public HUDMessage(string message, string leaveMeNull)
  public HUDMessage(string message, Color color, float timeLeft, bool fadeIn)
&lt;/syntaxhighlight>


So before we go over when you'd use them, I'm going to briefly note how the class HUDMessage uses these. (I encourage people to read the class if they have further questions, but I doubt most of us will need to know more than this)


[[File:HUDMessage-Types-InGame.png|200px|thumb|right|All of the types for HUDMessage as they appear in-game.]]

Types available:
#Achievement (HUDMessage.achievement_type)
#New Quest (HUDMessage.newQuest_type)
#Error (HUDMessage.error_type)
#Stamina (HUDMessage.stamina_type)
#Health (HUDMessage.health_type)


Color: Fairly obvious. It should be noted that while the first two don't give an option (they default to ''Color:OrangeRed''), the fourth with the param 'leaveMeNull' displays as the same color as the game text.


For specifics:
*'' public HUDMessage(string type, int number, bool add, Color color, Item messageSubject = null);'' - This allows for expanded customization of the message. More often used for money.
*''  public HUDMessage(string message, string leaveMeNull)'' - Also displays no icon.
::Not only displaying no icon, this type of HUDMessage does not have the square on the left side; it will draw a simple rectangle with text within.
*''  public HUDMessage(string message, Color color, float timeLeft, bool fadeIn)'' - Displays a message that fades in for a set amount of time.


Note: For those of you who want a custom HUDMessage: 
- Almost all of these variables are public, excluding messageSubject, so feel free to customize!
To modify them make a HUDMessage variable like so : HUDMessage &lt;name> = new HUDMessage(&lt;message>) ,now you can even animate them with code!

For example: add a new HUDMessage to show [[File:Error-image-ingame.png]] toaster popup. 
&lt;syntaxhighlight lang="c#">
Game1.addHUDMessage(new HUDMessage("MESSAGE", 3));
&lt;/syntaxhighlight>

Another example: add a HUDMessage that shows up like a simple rectangle with no icon, and no square for the icon:
&lt;syntaxhighlight lang="c#">
Game1.addHUDMessage(new HUDMessage("MESSAGE", ""));  // second parameter is the 'leaveMeNull' parameter
&lt;/syntaxhighlight>

===Active clickable menu===
An ''active clickable menu'' is a UI drawn over everything else which accepts user input. For example, the game menu (shown in-game when you hit {{key|ESC}} or controller {{key|B}}) is an active clickable menu. The menu is stored in &lt;code>Game1.activeClickableMenu&lt;/code>; if that field has a non-null value, the menu will be drawn and receive input automatically.

Each menu is different, so you need to look at the menu code to know how to interact with it. Since mods often need to get the current tab on the game menu, here's an example which handles the map tab:
&lt;syntaxhighlight lang="c#">
if (Game1.activeClickableMenu is GameMenu menu)
{
  // get the tab pages
  IList&lt;IClickableMenu> pages = this.Helper.Reflection.GetField&lt;List&lt;IClickableMenu>>(menu, "pages").GetValue();

  // option A: check tab ID
  if (menu.currentTab == GameMenu.mapTab)
  {
     ...
  }

  // option B: check page type
  switch (pages[menu.currentTab])
  {
    case MapPage mapPage:
       ...
       break;
  }
}
&lt;/syntaxhighlight>

To create a custom menu, you need to create a subclass of &lt;samp>IClickableMenu&lt;/samp> and assign it to &lt;samp>Game1.activeClickableMenu&lt;/samp>. At its most basic, a menu is basically just a few methods you override (usually &lt;samp>draw&lt;/samp> and &lt;samp>receiveLeftClick&lt;/samp> at a minimum). When &lt;samp>draw&lt;/samp> is called, you draw whatever you want to the screen; when &lt;samp>receiveLeftClick&lt;/samp> is called, you check if it's within one of the clickable areas and handle it. Normally you'd use some convenience classes like &lt;samp>ClickableTextureButton&lt;/samp> (which has a texture and position, and simplifies checking if they were clicked), though that's not strictly necessary. Here's [https://github.com/janavarro95/Stardew_Valley_Mods/blob/d7d567a72f5feaf3a5a5afd3d054ac9598727a97/GeneralMods/HappyBirthday/Framework/Menus/BirthdayMenu.cs a simple menu] you can use as an example, which draws the birthday menu for {{nexus mod|520|Birthday Mod}}.

===DialogueBox===
[[File:DialogueBox NoChoices Example.jpg|200px|thumb|right|Example of DialogueBox without choices.]]A '''DialogueBox''' is a text box with a slightly larger, slightly boldfaced text, with "typewriter-like" effect.

There are several variants, including ones with a dialogue/conversation choices.

Within the message, use a caret "^" to put a linebreak.

Here is an example of a '''simple, choiceless output:'''

&lt;syntaxhighlight lang="c#">
using StardewValley.Menus;  // This is where the DialogueBox class lives

string message = "This looks like a typewriter ... ^But it's not ...^It's a computer.^";
Game1.activeClickableMenu = new DialogueBox(message);
&lt;/syntaxhighlight>

// TODO: More examples with choices

To utilise options, you are better off using createQuestionDialogue. 

&lt;syntaxhighlight lang="c#">
private void SampleClick()
{
    // List of choices to give the farmer.
    List&lt;Response> choices = new List&lt;Response>()
            {
                new Response("dialogue_id1","Choice 1" ),
                new Response("dialogue_id2", "Choice 2"),
                new Response("dialogue_id3", "Choice 3"),
                new Response("dialogue_id4", "Choice 4")
            };

    // And here we case it to pop up on the farmer's screen. When the farmer has picked a choice, it sends that information to the method below (DialogueSet
    Game1.currentLocation.createQuestionDialogue($"What is the question?", choices.ToArray(), new GameLocation.afterQuestionBehavior(DialogueSet));
}

public void DialogueSet(Farmer who, string dialogue_id)
{
	// Here you get which option was picked as dialogue_id.
	Game1.addHUDMessage(new HUDMessage($"Farmer {who} chose option {dialogue_id}"));
    
}
&lt;/syntaxhighlight>

==Mail==
If you are new to SMAPI or to modding Stardew Valley in general, sending a simple letter to the player's mailbox is a great place to start your learning journey.  You will be treated to some simple to understand code and concepts, as well as receive some instant gratification in the form of a tangible, in-game letter that you can see in action.  If the examples in this section fall short, there are many folks available to assist you on the Discord channel (//TODO: Provide link).

===Mail content===

Before you can actually send any of your own custom mail to the player, you must decided how your letter will be composed.  By that I mean, is your letter static - always the same text - or is it dynamic - text changes based on a variable piece of information?  Obviously a static letter will be easier to implement, so if you are just starting off, go that route for now.  However, both static and dynamic methods are explained below.

To send mail, whether static or dynamic, you first have to let Stardew Valley know about your content, also referred to as an asset.  In the case of mail, you have to inject your additions into the mail data.  You accomplish this via the IAssetEditor interface.  You can implement IAssetEditor from your ModEntry class, or create a separate class that implements IAssetEditor to inject new mail content into "Data\Mail.xnb".  The examples cited below use the latter approach for clarity, easy of reuse, and encapsulation:

===Inject static content===

Most times a static, predefined letter will suffice, whether you are including an attachment (''i.e.,'' object, money, etc.) or not.  "Static" simply means you do not need to change the text once it is typed before sending the letter.  A "static" letter will always be available in the game (unless you remove it from the mod or the mod is removed by the player) so that means the letter is still available if the player quits with your letter still in the mailbox and then returns to play later.  This can be an issue with "dynamic" letters, as explained in more detail in that section, so use "static" content whenever possible.

You can softly reference the player's name, using "@", but other replace codes that may work in dialog texts, like %pet or %farm, do not work in static mail content at this time.  However, you can make use of some special characters that display an icon in the letter, such as "=", which will display a purple star, "&lt;", which will display a pink heart, the "$", which will be replaced with a gold coin, the ">", which will display a right arrow, the "`", which will display an up arrow, and the "+", which will display a head riding a skateboard (maybe?).  There may be additional special cases as well that are not yet documented.

The example below adds 4 letters into the mail data collection.  Note, that the code below does not send any letters to the player, but simply makes them available to Stardew Valley game so they can be sent.

&lt;syntaxhighlight lang="c#">
using StardewModdingAPI;

namespace MyMod
{
    internal sealed class ModEntry: Mod
    {
        public override void Entry(IModHelper helper)
        {
            helper.Events.Content.AssetRequested += this.OnAssetRequested;
        }
        
        private void OnAssetRequested(object? sender, AssetRequestedEventArgs e)
        {
            if (e.NameWithoutLocale.IsEquivalentTo("Data/mail"))
            {
                e.Edit(this.EditImpl);
            }
        }

        public void EditImpl(IAssetData asset)
        {
            var data = asset.AsDictionary&lt;string, string>().Data;

            // "MyModMail1" is referred to as the mail Id.  It is how you will uniquely identify and reference your mail.
            // The @ will be replaced with the player's name.  Other items do not seem to work (''i.e.,'' %pet or %farm)
            // %item object 388 50 %%   - this adds 50 pieces of wood when added to the end of a letter.
            // %item tools Axe Hoe %%   - this adds tools; may list any of Axe, Hoe, Can, Scythe, and Pickaxe
            // %item money 250 601  %%  - this sends a random amount of gold from 250 to 601 inclusive.
            // For more details, see: https://stardewvalleywiki.com/Modding:Mail_data 
            data["MyModMail1"] = "Hello @... ^A single carat is a new line ^^Two carats will double space.";
            data["MyModMail2"] = "This is how you send an existing item via email! %item object 388 50 %%";
            data["MyModMail3"] = "Coin $   Star =   Heart &lt;   Dude +  Right Arrow >   Up Arrow `";
            data["MyWizardMail"] = "Include Wizard in the mail Id to use the special background on a letter";
        }
    }
}
&lt;/syntaxhighlight>

===Send a letter (using static content)===

Now that you have your letter loaded, it's time to send it to the player.  There are a couple different methods available to accomplish this as well, depending on your need.  Two examples are shown below.  The distinction between the two methods will be explained below:

&lt;syntaxhighlight lang="c#">
    Game1.player.mailbox.Add("MyModMail1");
    Game1.addMailForTomorrow("MyModMail2");
&lt;/syntaxhighlight>

The first method (Game1.player.mailbox.Add) adds the letter directly into the mailbox for the current day.  This can be accomplished in your "DayStarting" event code, for example.  Mail added directly to the mailbox is not "remembered" as being sent even after a save.  This is useful in some scenarios depending on your need.

The second method (Game1.addMailForTomorrow) will, as the name implies, add the letter to the player's mailbox on the next day.  This method remembers the mail (Id) sent making it possible not to send the same letter over and over.  This can be handled in "DayStaring", "DayEnding" or other events, as dictated by your need.

You may be able to put the letter directly into the mailbox and also have it be remembered using the mailRecieved collection.  You can simply add your mailId manually if you want it to be remembered when using the add directly to mailbox method.

If you want Stardew Valley to forget that a specific letter has already been sent, you can remove it from the mailReceived collection.  You can iterate through the collection as well using a foreach should you need to remove mail en mass.

&lt;syntaxhighlight lang="c#">
    Game1.player.mailReceived.Remove("MyModMail1");
&lt;/syntaxhighlight>

That is all there is to sending a simple letter.   Attaching objects and sending money via letter is straight-forward, but sending recipes is more complicated  and will need some additional explanation at a future time.

===Inject dynamic content===

If you want to send a letter that contains data that needs to change based on the situation, such as the number of purple mushrooms eaten today, then you have to create that letter content each time you plan on sending it, especially if you want an up-to-date value.  That is what I am referring to by "dynamic" letters. 

Consider the following source code, which is basically an enhanced version of the static mail class shown above, that will also support "dynamic" content.  You could certainly always use the enhanced version of this code and just not make use of the dynamic content unless needed.  The code was separated for the purpose of illustrating the differences.

&lt;syntaxhighlight lang="c#">
using StardewModdingAPI;
using System.Collections.Generic;

namespace MyMail
{
    internal sealed class ModEntry: Mod
    {
        // This collection holds any letters loaded after the initial load or last cache refresh
        private Dictionary&lt;string, string> dynamicMail = new();
       
        public override void Entry(IModHelper helper)
        {
            helper.Events.Content.AssetRequested += this.OnAssetRequested;
        }

        private void OnAssetRequested(object? sender, AssetRequestedEventArgs e)
        {
             if (e.NameWithoutLocale.IsEquivalentTo("Data/mail"))
                 e.Edit(this.EditImpl);
        }

        public void EditImpl(IAssetData asset)
        {
            var data = asset.AsDictionary&lt;string, string>().Data;

            // This is just an example
            data["StaticMail"] = "If there were any letters with static content they could be placed here.";

            // Inject any mail that was added after the initial load.
            foreach (var item in dynamicMail)
            {
                data.Add(item);
            }

            dynamicMail.Clear();    // For the usage of this MOD the letters are cleared
        }

        /// &lt;summary>
        /// Add a new mail asset into the collection so it can be injected by the next cache refresh.  The letter will
        /// not be available to send until the cache is invalidated in the code.
        /// &lt;/summary>
        /// &lt;param name="mailId">The mail key&lt;/param>
        /// &lt;param name="mailText">The mail text&lt;/param>
        public void Add(string mailId, string mailText)
        {
            if (!string.IsNullOrEmpty(mailId))
            {
                dynamicMail[mailId] = mailText;
            }
        }
    }
}

&lt;/syntaxhighlight>

You will notice that there is really very little difference in the code used for static mail and dynamic mail.  The class that supports dynamic mail has a private dictionary collection for holding on to any mail content waiting to be injected.  It could have been made public to allow mail to be added directly into the collection, but that is not good practice.  Instead a public Add method was provided so that mail could be sent, so to speak, to the collection.  This code is for a specific MOD, not a robust framework, so it isn't overly concerned with error handling. You can improve that based on your needs.

Notice the additional code in the Edit method, where any mail in the dynamicMail collection is injected into Stardew Valley's content.  There will be no mail in the dynamicMail collection when the MOD is loaded (in this case) the first time.  If you add mail after the original load, then the content will have to be reloaded by invalidating the cache.  Refer to [[Modding:Modder Guide/APIs/Content#Cache invalidation|Cache invalidation]] for more details.

===Send a letter (using dynamic content)===

You can hook into other events, such as "Day Starting" or "Day Ending" to generate the letter you want to send.  Consider this simple example, that is only for illustration purposes.

&lt;syntaxhighlight lang="c#">
    private void OnDayStarting(object sender, DayStartedEventArgs e)
    {
        string mailMessage = $"@, you have gathered {Game1.stats.rabbitWoolProduced} units of rabbit wool!";

        mailData.Add("MyModMailWool", mailMessage);      // Add this new letter to the mail collection (for next refresh).

        Game1.mailbox.Add("MyModMailWool");              // Add to mailbox and we don't need to track it

        this.Helper.GameContent.InvalidateCache("Data\\mail"); // note that as of SMAPI 3.14.0, this only invalidates the English version of the asset. 
    }
&lt;/syntaxhighlight>

This example formats a letter, showing the up-to-date count of rabbit wool, makes it available to the mail collection, places that letter in the mailbox, and then invalidates the cache so that this new letter will be injected during the cache refresh.  In this case there is no need to remember mailId as the letter will be recreated each time it needs to be sent, which in this example is everyday.  Again, this code is only for illustration of the concept.

There is an important caveat to understand when injecting mail in this simple fashion.  The various mail frameworks available handle this issue, and this section will be expanded to explain how to overcome the issue, but it is being covered here to ensure you have a complete understanding of how MODs work with Stardew Valley and SMAPI.

If you add a dynamic letter and inject it into the content at Day Ending, you have to add the mail for display tomorrow obviously.  That means the game will be saved with a reference to the dynamic letter ("MyMailModWool" in this example) pending in the mail box.  If the player quits the game at that point and returns later to continue playing, then that dynamic letter is not available, resulting in a "phantom letter".  The mailbox will show a letter is available but when clicked on nothing will display.  This can be handled in several ways, including by saving the custom letters and loading them when the player continues, but again this example code does not cover that yet.  That is why the example uses On Day Starting and makes the letter available right away.

==Other==
===Add a small animation===
&lt;syntaxhighlight lang="c#">
location.temporarySprites.Add(new TemporaryAnimatedSprite(...))
&lt;/syntaxhighlight>
See ''TemporaryAnimatedSprite'' for more details

===Play a sound===
&lt;syntaxhighlight lang="c#">
location.playSound("SOUND"); 
&lt;/syntaxhighlight>
(''e.g.,'' "junimoMeep1")

==Open source==
When all else fails, when you've looked at the decompiled source too long and it makes no sense, take a look at some open-source mod code! See the 'source' column in the [[Modding:Mod compatibility|mod compatibility list]] for source code.

[[Category:Modding]]

[[ru:Модификации:Основные возможности]]
[[zh:模组:常用方法]]
</textarea><div class="templatesUsed"><div class="mw-templatesUsedExplanation"><p>Templates used on this page:
</p></div><ul>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Template:Key" title="Template:Key">Template:Key</a> (<a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Template:Key&amp;action=edit" title="Template:Key">view source</a>) </li><li><a href="../../external.html?link=https://stardewvalleywiki.com/Template:Nexus_mod" title="Template:Nexus mod">Template:Nexus mod</a> (<a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Template:Nexus_mod&amp;action=edit" title="Template:Nexus mod">view source</a>) </li><li><a href="../../external.html?link=https://stardewvalleywiki.com/Template:Stub" title="Template:Stub">Template:Stub</a> (<a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Template:Stub&amp;action=edit" title="Template:Stub">view source</a>) </li></ul></div><p id="mw-returnto">Return to <a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Common_tasks" title="Modding:Common tasks">Modding:Common tasks</a>.</p>
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="../../external.html?link=https://stardewvalleywiki.com/Modding:Common_tasks">https://stardewvalleywiki.com/Modding:Common_tasks</a>"</div>
</div>
			<div class="post-content" id="page-secondary-actions">
			
			</div>
		</main>
		<footer class="mw-footer minerva-footer">
		
		<div class="post-content footer-content">
			
			<h2>Stardew Valley Wiki</h2>
			<div class="license">Content is available under <a class="external" rel="nofollow" href="../../external.html?link=https://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike</a> unless otherwise noted.</div>
			<ul class="footer-info hlist hlist-separated">
				
			</ul>
			<ul class="footer-places hlist hlist-separated">
				<li id="footer-places-privacy"><a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:Privacy_policy" title="Stardew Valley Wiki:Privacy policy">Privacy policy</a></li><li id="footer-places-about"><a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:About" title="Stardew Valley Wiki:About">About Stardew Valley Wiki</a></li><li id="footer-places-disclaimer"><a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:General_disclaimer" title="Stardew Valley Wiki:General disclaimer">Disclaimers</a></li><li id="footer-places-desktop-toggle"><a id="mw-mf-display-toggle" href="../../external.html?link=http://stardewvalleywiki.com/mediawiki/index.php?title=Modding:Common_tasks&amp;action=edit&amp;mobileaction=toggle_view_desktop">Desktop</a></li>
			</ul>
		</div>
		</footer>
	</div>
</div>
<div class="mw-notification-area" data-mw="interface"></div>
<!-- v:8.3.0 -->

<script src="../../external.html?link=https://www.googletagmanager.com/gtag/js?id=G-1S37VCXXZ9" async=""></script><script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-1S37VCXXZ9', {"anonymize_ip":true});
</script>

<script>(window.NORLQ=window.NORLQ||[]).push(function(){var ns,i,p,img;ns=document.getElementsByTagName('noscript');for(i=0;i<ns.length;i++){p=ns[i].nextSibling;if(p&&p.className&&p.className.indexOf('lazy-image-placeholder')>-1){img=document.createElement('img');img.setAttribute('src',p.getAttribute('data-src'));img.setAttribute('width',p.getAttribute('data-width'));img.setAttribute('height',p.getAttribute('data-height'));img.setAttribute('alt',p.getAttribute('data-alt'));p.parentNode.replaceChild(img,p);}}});</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":109});});</script>		</body>
		
<!-- Mirrored from stardewvalleywiki.com/mediawiki/index.php?title=Modding:Common_tasks&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 11 Apr 2024 05:50:07 GMT -->
</html>
		