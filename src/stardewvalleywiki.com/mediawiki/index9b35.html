<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">


<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>Modding:Migrate to Stardew Valley 1.3 - Stardew Valley Wiki</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":!1,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"0a905c927b9ecf60e299227a","wgCSPNonce":!1,"wgCanonicalNamespace":"Modding","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":570,"wgPageName":"Modding:Migrate_to_Stardew_Valley_1.3","wgTitle":"Migrate to Stardew Valley 1.3","wgCurRevisionId":130208,"wgRevisionId":130208,"wgArticleId":7686,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"Modding:Migrate_to_Stardew_Valley_1.3","wgRelevantArticleId":7686,"wgIsProbablyEditable":!1,"wgRelevantPageIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgMFMode":"stable",
"wgMFAmc":!1,"wgMFAmcOutreachActive":!1,"wgMFAmcOutreachUserEligible":!1,"wgMFLazyLoadImages":!0,"wgMFDisplayWikibaseDescriptions":{"search":!1,"nearby":!1,"watchlist":!1,"tagline":!1},"wgMFIsPageContentModelEditable":!0,"wgCargoMapClusteringMinimum":80,"wgCargoMonthNames":["January","February","March","April","May","June","July","August","September","October","November","December"],"wgCargoMonthNamesShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgCargoWeekDays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"wgCargoWeekDaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"wgMinervaPermissions":{"watch":!0,"talk":!1},"wgMinervaFeatures":{"beta":!1,"donate":!0,"mobileOptionsLink":!0,"categories":!1,"pageIssues":!0,"talkAtTop":!1,"historyInPageActions":!1,"overflowSubmenu":!1,"tabsOnSpecials":!1,"personalMenu":!1,"mainMenuExpanded":!1,"simplifiedTalk":!0},
"wgMinervaDownloadNamespaces":[0]};RLSTATE={"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","ext.pygments":"ready","skins.minerva.base.styles":"ready","skins.minerva.content.styles":"ready","skins.minerva.content.styles.images":"ready","mediawiki.hlist":"ready","mediawiki.ui.icon":"ready","mediawiki.ui.button":"ready","skins.minerva.icons.wikimedia":"ready","skins.minerva.mainMenu.icons":"ready","skins.minerva.mainMenu.styles":"ready","mobile.init.styles":"ready"};RLPAGEMODULES=["site","mediawiki.page.startup","skins.minerva.options","skins.minerva.scripts","mobile.init"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@1hzgi",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});});</script>
<link rel="stylesheet" href="loadaf7f.css?lang=en&amp;modules=ext.pygments%7Cmediawiki.hlist%7Cmediawiki.ui.button%2Cicon%7Cmobile.init.styles%7Cskins.minerva.base.styles%7Cskins.minerva.content.styles%7Cskins.minerva.content.styles.images%7Cskins.minerva.icons.wikimedia%7Cskins.minerva.mainMenu.icons%2Cstyles&amp;only=styles&amp;skin=minerva"/>
<script async="" src="loadc82b.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=minerva&amp;target=mobile"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="load1154.css?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=minerva"/>
<meta name="generator" content="MediaWiki 1.35.1"/>
<meta name="robots" content="noindex,follow"/>
<meta name="description" content="←Index"/>
<meta name="theme-color" content="#eaecf0"/>
<meta name="viewport" content="initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0, width=device-width"/>
<link rel="manifest" href="api-resultc989.json?action=webapp-manifest"/>
<link rel="shortcut icon" href="extensions/StardewValley/images/favicon.png"/>
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Stardew Valley Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="api-result251f.xml?action=rsd"/>
<link rel="license" href="../../creativecommons.org/licenses/by-nc-sa/3.0/index.html"/>
<meta property="og:title" content="Modding:Migrate to Stardew Valley 1.3 - Stardew Valley Wiki"/>
<meta property="og:site_name" content="Stardew Valley Wiki"/>
<meta property="og:url" content="https://stardewvalleywiki.com/Modding:Migrate_to_Stardew_Valley_1.3"/>
<meta property="og:description" content="←Index"/>
<meta property="og:image" content="https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/site_logo_sm.png"/>
<meta property="twitter:site" content="@stardewwiki"/>
<meta property="twitter:title" content="Modding:Migrate to Stardew Valley 1.3 - Stardew Valley Wiki"/>
<meta property="twitter:description" content="←Index"/>
<meta property="twitter:image" content="https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/site_logo_sm.png"/>
<meta property="twitter:card" content="summary_large_image"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"article","name":"Modding:Migrate to Stardew Valley 1.3 - Stardew Valley Wiki","headline":"Modding:Migrate to Stardew Valley 1.3 - Stardew Valley Wiki","mainEntityOfPage":"Modding:Migrate to Stardew Valley 1.3","identifier":"https:\/\/stardewvalleywiki.com\/Modding:Migrate_to_Stardew_Valley_1.3","url":"https:\/\/stardewvalleywiki.com\/Modding:Migrate_to_Stardew_Valley_1.3","description":"\u2190Index","dateModified":"2021-11-08T01:06:31Z","datePublished":"2021-11-08T01:06:31Z","image":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png"},"author":{"@type":"Organization","name":"Stardew Valley Wiki","url":"\/\/stardewvalleywiki.com","logo":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png","caption":"Stardew Valley Wiki"}},"publisher":{"@type":"Organization","name":"Stardew Valley Wiki","url":"\/\/stardewvalleywiki.com","logo":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png","caption":"Stardew Valley Wiki"}},"potentialAction":{"@type":"SearchAction","target":"https:\/\/stardewvalleywiki.com\/mediawiki\/index.php?title=Special:Search&search={search_term}","query-input":"required name=search_term"}}</script>
<!--[if lt IE 9]><script src="/mediawiki/resources/lib/html5shiv/html5shiv.js"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-570 ns-subject page-Modding_Migrate_to_Stardew_Valley_1_3 rootpage-Modding_Migrate_to_Stardew_Valley_1_3 stable skin-minerva action-view skin-vector-legacy">
<div id="mw-mf-viewport">
	<div id="mw-mf-page-center">
		<a class="mw-mf-page-center__mask" href="#"></a>
		<header class="header-container header-chrome">
			<form class="header" action="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php" method="get">
				<nav class="navigation-drawer toggle-list view-border-box">
					<input type="checkbox" id="main-menu-input" class="toggle-list__checkbox" role="button" aria-labelledby="mw-mf-main-menu-button">
					<label for="main-menu-input" id="mw-mf-main-menu-button"
						class="mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-menu-base20 mw-ui-icon-flush-left toggle-list__toggle"
						title="Open main menu" data-event-name="ui.mainmenu">Open main menu</label>
					<div id="mw-mf-page-left" class="menu toggle-list__list view-border-box">
	<ul id="p-navigation">
			<li class="">
			    <a href="../Stardew_Valley_Wiki.html" class="mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-home" data-event-name="menu.home"><span>Home</span></a>
			</li>
			<li class="">
			    <a href="../Small_Crystal.html#/random" class="mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-die " data-event-name="menu.random"><span>Random</span></a>
			</li>
	</ul>
	<ul id="p-personal">
			<li class="">
			    <a href="index7020.html?title=Special:UserLogin&amp;returnto=Modding%3AMigrate+to+Stardew+Valley+1.3&amp;returntoquery=mobileaction%3Dtoggle_view_mobile" class="menu__item--login mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-logIn " data-event-name="menu.login"><span>Log in</span></a>
			</li>
	</ul>
	<ul id="pt-preferences">
			<li class="jsonly">
			    <a href="index3edb.html?title=Special:MobileOptions&amp;returnto=Modding%3AMigrate+to+Stardew+Valley+1.3" class="menu__item--settings mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-settings " data-event-name="menu.settings"><span>Settings</span></a>
			</li>
	</ul>
	<ul class="hlist">
			<li class="">
			    <a href="../Stardew_Valley_Wiki_About.html" class="" data-event-name=""><span>About Stardew Valley Wiki</span></a>
			</li>
			<li class="">
			    <a href="../Stardew_Valley_Wiki_General_disclaimer.html" class="" data-event-name=""><span>Disclaimers</span></a>
			</li>
	</ul>
</div>

					<label class="main-menu-mask" for="main-menu-input"></label>
				</nav>
				<div class="branding-box">
					<a href="../Stardew_Valley_Wiki.html">
						<span>Stardew Valley Wiki</span>
						
					</a>
				</div>
				<div class="search-box">
					<input class="search mw-ui-background-icon-search skin-minerva-search-trigger" type="search" name="search" id="searchInput"
						autocomplete="off" placeholder="Search Stardew Valley Wiki" aria-label="Search Stardew Valley Wiki"
						value="">
				</div>
				<nav class="minerva-user-navigation" aria-label="User navigation">
					<div><button id="searchIcon" class="mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-search-base20 skin-minerva-search-trigger" type="submit">Search</button></div>
					
				</nav>
			</form>
		</header>
		<main id="content" class="mw-body">
			<div class="banner-container">
			<div id="siteNotice"></div>
			</div>
			
			<div class="pre-content heading-holder">
				<div class="page-heading">
					<h1 id="section_0">Modding:Migrate to Stardew Valley 1.3</h1>
					<div class="tagline"></div>
				</div>
				<nav class="page-actions-menu">
	<ul id="page-actions" class="page-actions-menu__list">
		<li id="language-selector" class="page-actions-menu__list-item">
				<a id="" href="#" class="mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-language-base20 mw-ui-icon-with-label-desktop language-selector disabled"
					data-mw="interface"
					data-event-name="menu.languages" role="button" title="Language">Language</a>
		</li>
		<li id="page-actions-watch" class="page-actions-menu__list-item">
				<a id="ca-watch" href="index7111.html?title=Special:UserLogin&amp;returnto=Modding%3AMigrate+to+Stardew+Valley+1.3" class="mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-star-base20 mw-ui-icon-with-label-desktop watch-this-article mw-watchlink menu__item--page-actions-watch"
					data-mw="interface"
					data-event-name="menu.watch" role="button" title="Watch">Watch</a>
		</li>
		<li id="page-actions-edit" class="page-actions-menu__list-item">
				<a id="ca-edit" href="indexbd8c-3.html?title=Modding:Migrate_to_Stardew_Valley_1.3&amp;action=edit&amp;section=0" class="edit-page menu__item--page-actions-edit mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-editLock-base20 mw-ui-icon-with-label-desktop"
					data-mw="interface"
					data-event-name="menu.edit" role="button" title="Edit the lead section of this page">Edit</a>
		</li>
	</ul>
</nav>
<!-- version 1.0.2 (change every time you update a partial) -->

				
				
				<div class="minerva__subtitle"></div>
			</div>
			
			<div id="bodyContent" class="content"><div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><script>function mfTempOpenSection(id){var block=document.getElementById("mf-section-"+id);block.className+=" open-block";block.previousSibling.className+=" open-block";}</script><div class="mw-parser-output"><section class="mf-section-0" id="mf-section-0"><p>←<a href="../Modding_Index.html" title="Modding:Index">Index</a>
</p>
<div style="border: 1px solid orange; border-left: 1em solid orange; padding: 0.5em 1em; border-radius: 5px;">
<p><b>This page is for mod authors. Players: see <a href="../Modding_Mod_compatibility.html" title="Modding:Mod compatibility">Modding:Mod compatibility</a> instead.</b>
</p>
</div>
<p>For updating Content Patcher or XNB mods, see <a href="../Modding_Migrate_XNB_changes_to_Stardew_Valley_1.html" title="Modding:Migrate XNB changes to Stardew Valley 1.3"><i>Migrate XNB changes to Stardew Valley 1.3</i></a>.
</p><p>This page explains how to update your SMAPI mod code for compatibility with Stardew Valley 1.3.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Overview"><span class="tocnumber">1</span> <span class="toctext">Overview</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Single_player"><span class="tocnumber">1.1</span> <span class="toctext">Single player</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Multiplayer"><span class="tocnumber">1.2</span> <span class="toctext">Multiplayer</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Major_changes"><span class="tocnumber">2</span> <span class="toctext">Major changes</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#.E2.9A.A0_Net_fields"><span class="tocnumber">2.1</span> <span class="toctext">⚠ Net fields</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#.E2.9A.A0_Location_changes_for_farmhands"><span class="tocnumber">2.2</span> <span class="toctext">⚠ Location changes for farmhands</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Game1.player.friendships_is_obsolete"><span class="tocnumber">2.3</span> <span class="toctext">Game1.player.friendships is obsolete</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Texture_constructor_arguments"><span class="tocnumber">2.4</span> <span class="toctext">Texture constructor arguments</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Reserved_key_bindings"><span class="tocnumber">2.5</span> <span class="toctext">Reserved key bindings</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Reflection"><span class="tocnumber">2.6</span> <span class="toctext">Reflection</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Overlay_objects"><span class="tocnumber">2.7</span> <span class="toctext">Overlay objects</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#SMAPI_deprecated_APIs_removed"><span class="tocnumber">2.8</span> <span class="toctext">SMAPI deprecated APIs removed</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#SMAPI_event_changes"><span class="tocnumber">2.9</span> <span class="toctext">SMAPI event changes</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Beneficial_changes"><span class="tocnumber">2.10</span> <span class="toctext">Beneficial changes</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15"><a href="#Fix_common_build_warnings"><span class="tocnumber">3</span> <span class="toctext">Fix common build warnings</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#Mismatch_between_the_processor_architecture..."><span class="tocnumber">3.1</span> <span class="toctext">Mismatch between the processor architecture...</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#This_implicitly_converts..."><span class="tocnumber">3.2</span> <span class="toctext">This implicitly converts...</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#FieldName_is_a_Net.2A_field..."><span class="tocnumber">3.3</span> <span class="toctext">FieldName is a Net* field...</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#The_FieldName_field_is_obsolete..."><span class="tocnumber">3.4</span> <span class="toctext">The FieldName field is obsolete...</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#An_instance_of_analyzer_..._cannot_be_created"><span class="tocnumber">3.5</span> <span class="toctext">An instance of analyzer ... cannot be created</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-21"><a href="#FAQs"><span class="tocnumber">4</span> <span class="toctext">FAQs</span></a>
<ul>
<li class="toclevel-2 tocsection-22"><a href="#How_do_I_test_my_code_in_multiplayer.3F"><span class="tocnumber">4.1</span> <span class="toctext">How do I test my code in multiplayer?</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#Why_not_use_implicit_net_field_conversion.3F"><span class="tocnumber">4.2</span> <span class="toctext">Why not use implicit net field conversion?</span></a></li>
</ul>
</li>
</ul>
</div>

</section><h2 class="section-heading" onclick="javascript:mfTempOpenSection(1)"><div class="mw-ui-icon mw-ui-icon-element indicator mw-ui-icon-small mw-ui-icon-flush-left"></div><span class="mw-headline" id="Overview">Overview</span></h2><section class="mf-section-1 collapsible-block" id="mf-section-1">
<h3 class="in-block"><span class="mw-headline" id="Single_player">Single player</span></h3>
<p>At a high level, here's how to update a SMAPI mod:
</p>
<ol><li>Update the <a rel="nofollow" class="external text" href="../../external.html?link=https://www.nuget.org/packages/Pathoschild.Stardew.ModBuildConfig">mod build NuGet package</a> to 2.1-beta. (You may need to enable the 'include prerelease' checkbox to see the beta.)<br><i>This adds support for Stardew Valley 1.3, and adds code analysis which will report common problems in Stardew Valley 1.3 as build warnings.</i></li>
<li><b>Restart Visual Studio</b> to fully install the package.</li>
<li>Rebuild your solution.</li>
<li>Fix any compiler errors and warnings you see in the <i>Error List</i> pane in Visual Studio (or equivalent for other editors).</li>
<li>See below for help with specific changes and warnings.</li>
<li>Test all mod features to make sure they work.</li></ol>
<p>If you need help updating your code, feel free to ask questions <a href="../Modding_Community.html#Discord" title="Modding:Community">on the Stardew Valley Discord</a>.
</p>
<h3 class="in-block"><span class="mw-headline" id="Multiplayer">Multiplayer</span></h3>
<p>The instructions for single player apply for multiplayer too. Stardew Valley 1.3 automatically synchronises most world changes to other players (see <i><a href="../Modding_Modder_Guide/Game_Fundamentals.html#Net_fields" title="Modding:Modder Guide/Game Fundamentals">net fields</a></i>), so many mods will work in multiplayer too. Some mods may need further changes, but that can only be decided case-by-case.
</p><p>There are three common approaches to multiplayer compatibility:
</p>
<ul><li>Let anyone install the mod. If your mod makes changes to the world, make sure it'll work fine if different players have different versions or configuration, or only some of the players have it installed.</li>
<li>Only let the main player install the mod, which avoids complications from other players changing the same data. To do this, check SMAPI's <code>Context.IsMainPlayer</code> in your code.</li>
<li>Only enable in single-player mode. This eliminates all multiplayer and sync complications, though players may be disappointed. To do this, check SMAPI's <code>Context.IsMultiplayer</code> in your code.</li></ul>
<p>Common issues:
</p>
<ul><li>If your mod adds custom buildings or items, the game may crash trying to sync them to other players.</li></ul>
</section><h2 class="section-heading" onclick="javascript:mfTempOpenSection(2)"><div class="mw-ui-icon mw-ui-icon-element indicator mw-ui-icon-small mw-ui-icon-flush-left"></div><span class="mw-headline" id="Major_changes">Major changes</span></h2><section class="mf-section-2 collapsible-block" id="mf-section-2">
<h3 class="in-block"><span id="⚠_Net_fields"></span><span class="mw-headline" id=".E2.9A.A0_Net_fields">⚠ Net fields</span></h3>
<p>A 'net type' is any of several new classes which Stardew Valley 1.3 uses to sync data between players, named for the <code>Net</code> prefix in their name. A net type can represent a simple value like <samp>NetBool</samp>, or complex values like <samp>NetFieldDictionary</samp>. Many existing fields have been converted to net types (called 'net fields'), each wrapping the underlying value:
</p>
<dl><dd><div class="mw-highlight mw-highlight-lang-c# mw-content-ltr" dir="ltr"><pre><span></span><span class="n">NetString</span> <span class="n">str</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NetString</span><span class="p">(</span><span class="s">"bar"</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">Value</span> <span class="p">==</span> <span class="s">"bar"</span><span class="p">)</span> <span class="c1">// true</span>
</pre></div></dd></dl>
<p>Impact on mods:
</p>
<ul><li>The game will regularly collect all the net fields reachable from <samp>Game1.netWorldState</samp> and sync them with other players. That means that many mod changes will be synchronised automatically in multiplayer.</li>
<li>Net fields can implicitly convert to their equivalent normal values (like <code>bool x = new NetBool(true)</code>), but their conversion rules can be counterintuitive and error-prone. For example, <code>item?.category == null &amp;&amp; item?.category != null</code> can both be true at once. <b>Always avoid implicit casts to minimise bugs.</b></li></ul>
<p>Suggested fix:
</p>
<ul><li>With the latest mod build package installed, rebuild your project. The package will detect net field references you need to update, and show an appropriate warning. See <a href="#Fix_common_build_warnings"><i>fix common build warnings</i></a> below.</li></ul>
<h3 class="in-block"><span id="⚠_Location_changes_for_farmhands"></span><span class="mw-headline" id=".E2.9A.A0_Location_changes_for_farmhands">⚠ Location changes for farmhands</span></h3>
<p>In multiplayer, if the current player isn't the main player:
</p>
<ul><li><b><samp>Game1.locations</samp> does not contain the actual list of locations</b>. It contains a set of locations generated locally, which don't match the actual in-game locations. This also affects related functionality like <samp>Utility.getAllCharacters()</samp>, which searches the in-game locations. There's no fix for this yet. You can use SMAPI's <samp>helper.Multiplayer.GetActiveLocations()</samp> to get the list of locations currently being sync'd from the host, but there's currently no way to fetch all locations. That means SMAPI mods installed by a non-main player have no way to fetch all NPCs, locations, objects, etc.</li>
<li><samp>Game1.currentLocation</samp> is always an active location, but may be null when the player transition between locations. Make sure any references to that field can handle it being null.</li></ul>
<h3 class="in-block"><span class="mw-headline" id="Game1.player.friendships_is_obsolete">Game1.player.friendships is obsolete</span></h3>
<p>The <samp>Game1.player.friendships</samp> field is always null in Stardew Valley 1.3. Use the new <samp>Game1.player.friendshipData</samp> field instead, which wraps the raw data with a more useful model and more data.
</p><p>To convert old code:
</p>
<table class="wikitable">
<tbody><tr>
<th>old field
</th>
<th>new equivalent
</th></tr>
<tr>
<td><code>Game1.player.friendships[name][0]</code>
</td>
<td><code>Game1.player.friendshipData[name].Points</code>
</td></tr>
<tr>
<td><code>Game1.player.friendships[name][1]</code>
</td>
<td><code>Game1.player.friendshipData[name].GiftsThisWeek</code>
</td></tr>
<tr>
<td><code>Game1.player.friendships[name][2]</code>
</td>
<td><code>Game1.player.friendshipData[name].TalkedToToday</code> (0 → false, 1 → true)
</td></tr>
<tr>
<td><code>Game1.player.friendships[name][3]</code>
</td>
<td><code>Game1.player.friendshipData[name].GiftsToday</code> (0 → false, 1 → true)
</td></tr></tbody></table>
<h3 class="in-block"><span class="mw-headline" id="Texture_constructor_arguments">Texture constructor arguments</span></h3>
<p>Many constructors which previously accepted <samp>Texture2D texture</samp> arguments now take a <samp>string textureName</samp> argument instead. It's usually better to use SMAPI's content API to override textures instead. You can change the cached texture after the object is constructed (may need <a href="../Modding_Modder_Guide/APIs.html" title="Modding:Modder Guide/APIs">reflection</a>), but don't change the texture name to avoid multiplayer sync issues.
</p>
<h3 class="in-block"><span class="mw-headline" id="Reserved_key_bindings">Reserved key bindings</span></h3>
<p>Mods won't receive input sent to the chatbox, and they won't receive the toggle-chatbox key (<span style="display:inline-block; padding:0px 3px; border-radius:4px; border-style:outset; background:#FFFFFF; background: -webkit-linear-gradient(#FCFCFC, #E0E0E0); background: linear-gradient(#FCFCFC, #E0E0E0);">T</span> by default).
</p>
<h3 class="in-block"><span class="mw-headline" id="Reflection">Reflection</span></h3>
<p>If you use reflection to access private game code, double-check that the fields/properties/methods you're accessing still match. In particular, watch out for these changes:
</p>
<ul><li>fields/properties changing return type;</li>
<li>fields replaced by properties.</li></ul>
<h3 class="in-block"><span class="mw-headline" id="Overlay_objects">Overlay objects</span></h3>
<p>Stardew Valley 1.3 adds an <samp>overlayObjects</samp> field to <samp>GameLocation</samp> instances. These have two special properties:
</p>
<ul><li>They're not synced to other players, so each player has their own overlay objects. (That's used for special quest items, so other players can't take your item.)</li>
<li>They're positioned on top of the normal object layer. (If there was already an object where the item is placed, the previous object will be hidden until you pick up the overlay object instead of being deleted.)</li></ul>
<h3 class="in-block"><span class="mw-headline" id="SMAPI_deprecated_APIs_removed">SMAPI deprecated APIs removed</span></h3>
<p>Since nearly all SMAPI mods broke in Stardew Valley 1.2, SMAPI 2.6 also drops support for deprecated APIs:
</p>
<table class="wikitable">

<tbody><tr>
<th>since
</th>
<th>interfaces
</th>
<th>replacement
</th></tr>
<tr>
<td>2.3
</td>
<td><samp>IReflectionHelper.GetPrivateField</samp><br><samp>IReflectionHelper.GetPrivateMethod</samp><br><samp>IReflectionHelper.GetPrivateProperty</samp>
</td>
<td>renamed to <samp>GetField</samp>, <samp>GetMethod</samp>, and <samp>GetProperty</samp> respectively; their return values have also been renamed (<samp>IPrivateField</samp> → <samp>IReflectedField</samp>, <samp>IPrivateProperty</samp> → <samp>IReflectedProperty</samp>, and <samp>IPrivateMethod</samp> → <samp>IReflectedMethod</samp>).
</td></tr>
<tr>
<td>2.3
</td>
<td><samp>IReflectionHelper.GetPrivateValue</samp>
</td>
<td>use <samp>GetPrivateField(...).GetValue()</samp> instead.
</td></tr></tbody></table>
<h3 class="in-block"><span class="mw-headline" id="SMAPI_event_changes">SMAPI event changes</span></h3>
<p>Some SMAPI events were rewritten so they make sense in multiplayer. These also use a new architecture under the hood, so they provide much more useful event data (<i>e.g.,</i> added/removed instead of just current values). The following events have breaking changes:
</p>
<table class="wikitable">

<tbody><tr>
<th>old event
</th>
<th>
</th>
<th>new event
</th>
<th>migration notes
</th></tr>
<tr>
<td><samp>LocationEvents.CurrentLocationChanged</samp>
</td>
<td>→
</td>
<td><samp>PlayerEvents.Warped</samp>
</td>
<td> 
<ul><li>Change <samp>EventArgsCurrentLocationChanged</samp> to <samp>EventArgsPlayerWarped</samp>.</li></ul>
</td></tr>
<tr>
<td><samp>LocationEvents.LocationsChanged</samp>
</td>
<td>
</td>
<td><i>(same name)</i>
</td>
<td> 
<ul><li>Change <samp>EventArgsGameLocationsChanged</samp> to <samp>EventArgsLocationsChanged</samp>.</li>
<li>The event is now raised when <i>any</i> location is added/removed (including building interiors), not just the main world locations in <samp>Game1.locations</samp>. If you need to handle only main world locations, you can check <code>if (Game1.locations.Contains(e.NewLocation))</code>.</li>
<li>The event data previously contained the current list of locations; it now contains the locations added or removed since the last tick. If you previously used <samp>e.NewLocations</samp>, you can replace it with <samp>Game1.locations</samp>.</li></ul>
</td></tr>
<tr>
<td><samp>LocationEvents.LocationObjectsChanged</samp>
</td>
<td>→
</td>
<td><samp>LocationEvents.ObjectsChanged</samp>
</td>
<td> 
<ul><li>The event is now raised when objects are added/removed to <i>any</i> location (including building interiors), not just the current player's location. If you need to handle only the current player's location, you can check <code>if (e.Location == Game1.player.currentLocation)</code>.</li>
<li>The event data previously contained the current location's list of objects; it now contains the location, and the objects added/removed in it since the last tick. If you previously used <samp>e.NewObjects</samp>, you can use <samp>e.Location.netObjects.FieldDict</samp> instead.</li></ul>
</td></tr></tbody></table>
<h3 class="in-block"><span class="mw-headline" id="Beneficial_changes">Beneficial changes</span></h3>
<p>Stardew Valley 1.3 includes several changes which benefit modders. These aren't disruptive, but worth noting for use. Some of the most relevant are...
</p>
<ul><li>Many more methods and properties are now virtual.</li>
<li><samp>Game1.WorldDate</samp> is a new field which provides a more useful way to check the date. This combines the day, season, and year with useful logic like day-of-week and date comparisons. This incorporates many of the features from SMAPI's <samp>SDate</samp> class.</li>
<li>Many type checks now allow subclasses (like <code>item.GetType() == typeof(Axe)</code> → <code>item is Axe</code>).</li>
<li>Any <samp>GameLocation</samp> can now set <samp>IsGreenhouse = true</samp>, and crops will grow there all year.</li>
<li>Any <samp>NPC</samp> can now set <samp>IsSocial</samp> to determine whether they appear in the social menu.</li>
<li>Bee houses now find nearby flowers in any location, not only when placed on the farm.</li>
<li>Custom map tilesheets no longer need hacks to avoid the game's seasonal logic. Tilesheets which don't start with a season name and underscore won't be seasonalised.</li>
<li>Several changes to support upcoming SMAPI features and fixes.</li></ul>
</section><h2 class="section-heading" onclick="javascript:mfTempOpenSection(3)"><div class="mw-ui-icon mw-ui-icon-element indicator mw-ui-icon-small mw-ui-icon-flush-left"></div><span class="mw-headline" id="Fix_common_build_warnings">Fix common build warnings</span></h2><section class="mf-section-3 collapsible-block" id="mf-section-3">
<p>Make sure you check your Error List pane in Visual Studio (or equivalent in other IDEs) and fix any warnings. Here are some common ones:
</p>
<h3 class="in-block"><span class="mw-headline" id="Mismatch_between_the_processor_architecture...">Mismatch between the processor architecture...</span></h3>
<p>Sample warning: "<i>There was a mismatch between the processor architecture of the project being built "{0}" and the processor architecture of the reference "{1}". This mismatch may cause runtime failures.</i>"
</p><p>That warning is normal. The error is saying that your build is set to 'Any CPU', but Stardew Valley is x86-only so it'll only work in x86 anyway. You can either ignore it, or <a rel="nofollow" class="external text" href="../../external.html?link=https://msdn.microsoft.com/en-us/library/ms185328.aspx">change your platform target</a> to x86.
</p>
<h3 class="in-block"><span class="mw-headline" id="This_implicitly_converts...">This implicitly converts...</span></h3>
<p>Sample warning: "<i>This implicitly converts '{0}' from Net{1} to {2}, but Net{1} has unintuitive implicit conversion rules. Consider comparing against the actual value instead to avoid bugs. See <a rel="nofollow" class="external free" href="../../external.html?link=https://smapi.io/package/avoid-implicit-net-field-cast">https://smapi.io/package/avoid-implicit-net-field-cast</a> for details.</i>"
</p><p>Your code is referencing a <a href="#Net_fields">net field</a>, which can cause subtle bugs. The field you're referencing has an equivalent non-net property, like <samp>monster.Health</samp> (<samp>int</samp>) instead of <samp>monster.health</samp> (<samp>NetBool</samp>). Change your code to use the suggested property instead.
</p>
<h3 class="in-block"><span id="FieldName_is_a_Net*_field..."></span><span class="mw-headline" id="FieldName_is_a_Net.2A_field...">FieldName is a Net* field...</span></h3>
<p>Sample warning: "'<i>{0}' is a Net{1} field; consider using the {2} property instead. See <a rel="nofollow" class="external free" href="../../external.html?link=https://smapi.io/package/avoid-net-field">https://smapi.io/package/avoid-net-field</a> for details.</i>"
</p><p>Your code is referencing a <a href="#Net_fields">net field</a>, which can cause subtle bugs. You should access the underlying value instead:
</p>
<ul>
<li>For a reference type (<i>i.e.,</i> one that can contain <samp>null</samp>), you can use the <samp>.Value</samp> property (or <samp>.FieldDict</samp> for a <samp>NetDictionary</samp>):
<div class="mw-highlight mw-highlight-lang-c# mw-content-ltr" dir="ltr"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">building</span><span class="p">.</span><span class="n">indoors</span><span class="p">.</span><span class="n">Value</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</pre></div>
<p>Or convert the value before comparison:
</p>
<div class="mw-highlight mw-highlight-lang-c# mw-content-ltr" dir="ltr"><pre><span></span><span class="n">GameLocation</span> <span class="n">indoors</span> <span class="p">=</span> <span class="n">building</span><span class="p">.</span><span class="n">indoors</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="n">indoors</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
   <span class="c1">// ...</span>
</pre></div></li>
<li>For a value type (<i>i.e.,</i> one that can't contain <samp>null</samp>), check if the parent is null (if needed) and compare with <samp>.Value</samp>:
<div class="mw-highlight mw-highlight-lang-c# mw-content-ltr" dir="ltr"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">item</span><span class="p">.</span><span class="n">category</span><span class="p">.</span><span class="n">Value</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</pre></div></li>
</ul>
<h3 class="in-block"><span class="mw-headline" id="The_FieldName_field_is_obsolete...">The FieldName field is obsolete...</span></h3>
<p>Sample warning: "<i>The 'Character.friendships' field is obsolete and should be replaced with 'friendshipData'. See <a rel="nofollow" class="external free" href="../../external.html?link=https://smapi.io/package/avoid-obsolete-field">https://smapi.io/package/avoid-obsolete-field</a> for details.</i>"
</p><p>You're referencing a field which should no longer be used. Use the suggested field name instead to fix it.
</p>
<h3 class="in-block"><span class="mw-headline" id="An_instance_of_analyzer_..._cannot_be_created">An instance of analyzer ... cannot be created</span></h3>
<p>Update to the latest <a rel="nofollow" class="external text" href="../../external.html?link=https://visualstudio.microsoft.com/vs/community/">Visual Studio</a>; the NuGet package uses a recent feature that isn't available in older versions.
</p>
</section><h2 class="section-heading" onclick="javascript:mfTempOpenSection(4)"><div class="mw-ui-icon mw-ui-icon-element indicator mw-ui-icon-small mw-ui-icon-flush-left"></div><span class="mw-headline" id="FAQs">FAQs</span></h2><section class="mf-section-4 collapsible-block" id="mf-section-4">
<h3 class="in-block"><span id="How_do_I_test_my_code_in_multiplayer?"></span><span class="mw-headline" id="How_do_I_test_my_code_in_multiplayer.3F">How do I test my code in multiplayer?</span></h3>
<p>You can test mods in multiplayer on the same computer, by launching two instances of the game:
</p>
<ol><li>Prepare player one:
<ol><li>Launch SMAPI like usual.</li>
<li>From the title screen: click <i>co-op</i>, then <i>host</i>.</li>
<li>Start a new save slot (unless you've already created one). Make sure to set 'starting cabins' to at least one (you'll need one cabin per extra player).</li></ol></li>
<li>Prepare player two:
<ol><li>Launch SMAPI again. (This will automatically create a separate log file.)</li>
<li>From the title screen: click <i>co-op</i>, then <i>join LAN game</i>.</li>
<li>Leave the 'Enter IP...' box empty and click OK.</li></ol></li></ol>
<h3 class="in-block"><span id="Why_not_use_implicit_net_field_conversion?"></span><span class="mw-headline" id="Why_not_use_implicit_net_field_conversion.3F">Why not use implicit net field conversion?</span></h3>
<p>The migration guide suggests <a href="#Net_fields">avoiding net field implicit conversion</a>. This may be the most tedious part of the migration for many mods, and the code compiles fine without doing that, so it's tempting to just skip this step. That's not recommended. Although net field conversions will work fine in most cases, their conversion rules can cause strange bugs in unexpected places. It's better to avoid it altogether, rather than learn all the different cases where they'll cause problems. If you really want, you can <a rel="nofollow" class="external text" href="../../external.html?link=https://smapi.io/package/code-warnings">disable the build warnings</a> and decide for yourself when to use the implicit conversion.
</p>




</section></div></div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index2b1b.html?title=Modding:Migrate_to_Stardew_Valley_1.3&amp;oldid=130208">https://stardewvalleywiki.com/mediawiki/index.php?title=Modding:Migrate_to_Stardew_Valley_1.3&amp;oldid=130208</a>"</div>
</div>
			<div class="post-content" id="page-secondary-actions">
			
			</div>
		</main>
		<footer class="mw-footer minerva-footer">
		<div class="last-modified-bar">
	<div class="post-content last-modified-bar__content">
		<span class="last-modified-bar__icon mw-ui-icon mw-ui-icon-mw-ui-icon-small mw-ui-icon-wikimedia-history-base20 "></span>
		<a class="last-modified-bar__text modified-enhancement" href="../Special_History/Modding_Migrate_to_Stardew_Valley_1-3.html"
				data-user-name="Margotbean"
				data-user-gender="female"
				data-timestamp="1636333591">
				<span>Last edited on 8 November 2021, at 01:06</span>
		</a>
		<span class="mw-ui-icon mw-ui-icon-small mw-ui-icon-mf-expand-gray mf-mw-ui-icon-rotate-anti-clockwise indicator"></span>
	</div>
</div>

		<div class="post-content footer-content">
			
			<h2>Stardew Valley Wiki</h2>
			<div class="license">Content is available under <a class="external" rel="nofollow" href="../../creativecommons.org/licenses/by-nc-sa/3.0/index.html">Creative Commons Attribution-NonCommercial-ShareAlike</a> unless otherwise noted.</div>
			<ul class="footer-info hlist hlist-separated">
				<li id="footer-info-lastmod"> This page was last edited on 8 November 2021, at 01:06.</li><li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="../../creativecommons.org/licenses/by-nc-sa/3.0/index.html">Creative Commons Attribution-NonCommercial-ShareAlike</a> unless otherwise noted.</li>
			</ul>
			<ul class="footer-places hlist hlist-separated">
				<li id="footer-places-privacy"><a href="../Stardew_Valley_Wiki_Privacy_policy.html" title="Stardew Valley Wiki:Privacy policy">Privacy policy</a></li><li id="footer-places-about"><a href="../Stardew_Valley_Wiki_About.html" title="Stardew Valley Wiki:About">About Stardew Valley Wiki</a></li><li id="footer-places-disclaimer"><a href="../Stardew_Valley_Wiki_General_disclaimer.html" title="Stardew Valley Wiki:General disclaimer">Disclaimers</a></li><li id="footer-places-desktop-toggle"><a id="mw-mf-display-toggle" href="index4b93.html?title=Modding:Migrate_to_Stardew_Valley_1.3&amp;mobileaction=toggle_view_desktop">Desktop</a></li>
			</ul>
		</div>
		</footer>
	</div>
</div>
<div class="mw-notification-area" data-mw="interface"></div>
<!-- v:8.3.0 -->

<script src="../../external.html?link=https://www.googletagmanager.com/gtag/js?id=G-1S37VCXXZ9" async=""></script><script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-1S37VCXXZ9', {"anonymize_ip":true});
</script>

<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.031","walltime":"0.559","ppvisitednodes":{"value":112,"limit":1000000},"postexpandincludesize":{"value":429,"limit":2097152},"templateargumentsize":{"value":1,"limit":2097152},"expansiondepth":{"value":3,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":2170,"limit":5000000},"timingprofile":["100.00%  268.550      1 -total","  0.60%    1.621      1 Template:Key","  0.42%    1.125      1 Template:Modder_compatibility_header"]},"cachereport":{"timestamp":"20240709113644","ttl":86400,"transientcontent":false}}});});</script>
<script>(window.NORLQ=window.NORLQ||[]).push(function(){var ns,i,p,img;ns=document.getElementsByTagName('noscript');for(i=0;i<ns.length;i++){p=ns[i].nextSibling;if(p&&p.className&&p.className.indexOf('lazy-image-placeholder')>-1){img=document.createElement('img');img.setAttribute('src',p.getAttribute('data-src'));img.setAttribute('width',p.getAttribute('data-width'));img.setAttribute('height',p.getAttribute('data-height'));img.setAttribute('alt',p.getAttribute('data-alt'));p.parentNode.replaceChild(img,p);}}});</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":127});});</script>		</body>
		

</html>

