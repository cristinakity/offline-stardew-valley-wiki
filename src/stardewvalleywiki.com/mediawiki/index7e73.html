<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">


<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>Talk:Oil of Garlic - Stardew Valley Wiki</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":!1,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"0a905c927b9ecf60e299227a","wgCSPNonce":!1,"wgCanonicalNamespace":"Talk","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":1,"wgPageName":"Talk:Oil_of_Garlic","wgTitle":"Oil of Garlic","wgCurRevisionId":141756,"wgRevisionId":141756,"wgArticleId":13462,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"Talk:Oil_of_Garlic","wgRelevantArticleId":13462,"wgIsProbablyEditable":!1,"wgRelevantPageIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgMFMode":"stable","wgMFAmc":!1,"wgMFAmcOutreachActive":!1,
"wgMFAmcOutreachUserEligible":!1,"wgMFLazyLoadImages":!0,"wgMFDisplayWikibaseDescriptions":{"search":!1,"nearby":!1,"watchlist":!1,"tagline":!1},"wgMFIsPageContentModelEditable":!0,"wgCargoMapClusteringMinimum":80,"wgCargoMonthNames":["January","February","March","April","May","June","July","August","September","October","November","December"],"wgCargoMonthNamesShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgCargoWeekDays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"wgCargoWeekDaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"wgMinervaPermissions":{"watch":!0,"talk":!0},"wgMinervaFeatures":{"beta":!1,"donate":!0,"mobileOptionsLink":!0,"categories":!1,"pageIssues":!0,"talkAtTop":!1,"historyInPageActions":!1,"overflowSubmenu":!1,"tabsOnSpecials":!1,"personalMenu":!1,"mainMenuExpanded":!1,"simplifiedTalk":!0},"wgMinervaDownloadNamespaces":[0]};RLSTATE={
"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","ext.pygments":"ready","skins.minerva.base.styles":"ready","skins.minerva.content.styles":"ready","skins.minerva.content.styles.images":"ready","mediawiki.hlist":"ready","mediawiki.ui.icon":"ready","mediawiki.ui.button":"ready","skins.minerva.icons.wikimedia":"ready","skins.minerva.mainMenu.icons":"ready","skins.minerva.mainMenu.styles":"ready","skins.minerva.talk.styles":"ready","mobile.init.styles":"ready"};RLPAGEMODULES=["site","mediawiki.page.startup","skins.minerva.options","skins.minerva.scripts","mobile.init"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@1hzgi",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});});</script>
<link rel="stylesheet" href="loadb626.css?lang=en&amp;modules=ext.pygments%7Cmediawiki.hlist%7Cmediawiki.ui.button%2Cicon%7Cmobile.init.styles%7Cskins.minerva.base.styles%7Cskins.minerva.content.styles%7Cskins.minerva.content.styles.images%7Cskins.minerva.icons.wikimedia%7Cskins.minerva.mainMenu.icons%2Cstyles%7Cskins.minerva.talk.styles&amp;only=styles&amp;skin=minerva"/>
<script async="" src="loadc82b.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=minerva&amp;target=mobile"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="load1154.css?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=minerva"/>
<meta name="generator" content="MediaWiki 1.35.1"/>
<meta name="robots" content="noindex,follow"/>
<meta name="description" content="I was looking at the code, and saw this:"/>
<meta name="theme-color" content="#eaecf0"/>
<meta name="viewport" content="initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0, width=device-width"/>
<link rel="manifest" href="api-resultc989.json?action=webapp-manifest"/>
<link rel="shortcut icon" href="extensions/StardewValley/images/favicon.png"/>
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Stardew Valley Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="api-result251f.xml?action=rsd"/>
<link rel="license" href="../../creativecommons.org/licenses/by-nc-sa/3.0/index.html"/>
<meta property="og:title" content="Talk:Oil of Garlic - Stardew Valley Wiki"/>
<meta property="og:site_name" content="Stardew Valley Wiki"/>
<meta property="og:url" content="https://stardewvalleywiki.com/Talk:Oil_of_Garlic"/>
<meta property="og:description" content="I was looking at the code, and saw this:"/>
<meta property="og:image" content="https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/site_logo_sm.png"/>
<meta property="twitter:site" content="@stardewwiki"/>
<meta property="twitter:title" content="Talk:Oil of Garlic - Stardew Valley Wiki"/>
<meta property="twitter:description" content="I was looking at the code, and saw this:"/>
<meta property="twitter:image" content="https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/site_logo_sm.png"/>
<meta property="twitter:card" content="summary_large_image"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"article","name":"Talk:Oil of Garlic - Stardew Valley Wiki","headline":"Talk:Oil of Garlic - Stardew Valley Wiki","mainEntityOfPage":"Talk:Oil of Garlic","identifier":"https:\/\/stardewvalleywiki.com\/Talk:Oil_of_Garlic","url":"https:\/\/stardewvalleywiki.com\/Talk:Oil_of_Garlic","description":"I was looking at the code, and saw this:","dateModified":"2022-09-17T19:39:10Z","datePublished":"2022-09-17T19:39:10Z","image":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png"},"author":{"@type":"Organization","name":"Stardew Valley Wiki","url":"\/\/stardewvalleywiki.com","logo":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png","caption":"Stardew Valley Wiki"}},"publisher":{"@type":"Organization","name":"Stardew Valley Wiki","url":"\/\/stardewvalleywiki.com","logo":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png","caption":"Stardew Valley Wiki"}},"potentialAction":{"@type":"SearchAction","target":"https:\/\/stardewvalleywiki.com\/mediawiki\/index.php?title=Special:Search&search={search_term}","query-input":"required name=search_term"}}</script>
<!--[if lt IE 9]><script src="/mediawiki/resources/lib/html5shiv/html5shiv.js"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-1 ns-talk page-Talk_Oil_of_Garlic rootpage-Talk_Oil_of_Garlic stable skin-minerva action-view skin-minerva--talk-simplified skin-vector-legacy">
<div id="mw-mf-viewport">
	<div id="mw-mf-page-center">
		<a class="mw-mf-page-center__mask" href="#"></a>
		<header class="header-container header-chrome">
			<form class="header" action="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php" method="get">
				<nav class="navigation-drawer toggle-list view-border-box">
					<input type="checkbox" id="main-menu-input" class="toggle-list__checkbox" role="button" aria-labelledby="mw-mf-main-menu-button">
					<label for="main-menu-input" id="mw-mf-main-menu-button"
						class="mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-menu-base20 mw-ui-icon-flush-left toggle-list__toggle"
						title="Open main menu" data-event-name="ui.mainmenu">Open main menu</label>
					<div id="mw-mf-page-left" class="menu toggle-list__list view-border-box">
	<ul id="p-navigation">
			<li class="">
			    <a href="../Stardew_Valley_Wiki.html" class="mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-home" data-event-name="menu.home"><span>Home</span></a>
			</li>
			<li class="">
			    <a href="../Small_Crystal.html#/random" class="mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-die " data-event-name="menu.random"><span>Random</span></a>
			</li>
	</ul>
	<ul id="p-personal">
			<li class="">
			    <a href="indexdbd4.html?title=Special:UserLogin&amp;returnto=Talk%3AOil+of+Garlic&amp;returntoquery=mobileaction%3Dtoggle_view_mobile" class="menu__item--login mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-logIn " data-event-name="menu.login"><span>Log in</span></a>
			</li>
	</ul>
	<ul id="pt-preferences">
			<li class="jsonly">
			    <a href="index967c.html?title=Special:MobileOptions&amp;returnto=Talk%3AOil+of+Garlic" class="menu__item--settings mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-settings " data-event-name="menu.settings"><span>Settings</span></a>
			</li>
	</ul>
	<ul class="hlist">
			<li class="">
			    <a href="../Stardew_Valley_Wiki_About.html" class="" data-event-name=""><span>About Stardew Valley Wiki</span></a>
			</li>
			<li class="">
			    <a href="../Stardew_Valley_Wiki_General_disclaimer.html" class="" data-event-name=""><span>Disclaimers</span></a>
			</li>
	</ul>
</div>

					<label class="main-menu-mask" for="main-menu-input"></label>
				</nav>
				<div class="branding-box">
					<a href="../Stardew_Valley_Wiki.html">
						<span>Stardew Valley Wiki</span>
						
					</a>
				</div>
				<div class="search-box">
					<input class="search mw-ui-background-icon-search skin-minerva-search-trigger" type="search" name="search" id="searchInput"
						autocomplete="off" placeholder="Search Stardew Valley Wiki" aria-label="Search Stardew Valley Wiki"
						value="">
				</div>
				<nav class="minerva-user-navigation" aria-label="User navigation">
					<div><button id="searchIcon" class="mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-search-base20 skin-minerva-search-trigger" type="submit">Search</button></div>
					
				</nav>
			</form>
		</header>
		<main id="content" class="mw-body">
			<div class="banner-container">
			<div id="siteNotice"></div>
			</div>
			
			<div class="pre-content heading-holder">
				<div class="page-heading">
					<h1 id="section_0">Talk:Oil of Garlic</h1>
					<div class="tagline"></div>
				</div>
				<nav class="page-actions-menu">
	<ul id="page-actions" class="page-actions-menu__list">
		<li id="language-selector" class="page-actions-menu__list-item">
				<a id="" href="#" class="mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-language-base20 mw-ui-icon-with-label-desktop language-selector disabled"
					data-mw="interface"
					data-event-name="menu.languages" role="button" title="Language">Language</a>
		</li>
		<li id="page-actions-watch" class="page-actions-menu__list-item">
				<a id="ca-watch" href="index38da.html?title=Special:UserLogin&amp;returnto=Talk%3AOil+of+Garlic" class="mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-star-base20 mw-ui-icon-with-label-desktop watch-this-article mw-watchlink menu__item--page-actions-watch"
					data-mw="interface"
					data-event-name="menu.watch" role="button" title="Watch">Watch</a>
		</li>
		<li id="page-actions-edit" class="page-actions-menu__list-item">
				<a id="ca-edit" href="indexb793.html?title=Talk:Oil_of_Garlic&amp;action=edit&amp;section=0" class="edit-page menu__item--page-actions-edit mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-editLock-base20 mw-ui-icon-with-label-desktop"
					data-mw="interface"
					data-event-name="menu.edit" role="button" title="Edit the lead section of this page">Edit</a>
		</li>
	</ul>
</nav>
<!-- version 1.0.2 (change every time you update a partial) -->

				<div class="minerva-talk-content-explained">Active discussions</div>
				
				<div class="minerva__subtitle"></div>
			</div>
			
			<div id="bodyContent" class="content"><div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><script>function mfTempOpenSection(id){var block=document.getElementById("mf-section-"+id);block.className+=" open-block";block.previousSibling.className+=" open-block";}</script><div class="mw-parser-output"><section class="mf-section-0" id="mf-section-0"><style data-mw-deduplicate="TemplateStyles:r121376">.mw-parser-output #talkheadertitle{background-color:#03A007;text-align:center;color:white;text-shadow:0px 2px #00321f;font-size:120%}.mw-parser-output #talkheaderbody{width:80%;margin:0 auto 1em auto;border:1px solid rgb(170,170,170);background-color:rgba(255,255,255,0.58);color:rgb(0,0,0)}.mw-parser-output .white{color:white}</style>
<table id="talkheaderbody">

<tbody><tr>
<th colspan="2" id="talkheadertitle">This talk page is for discussing <a rel="nofollow" class="external text" href="../Oil_of_Garlic.html"><span class="white">Oil of Garlic</span></a>.
</th></tr>
<tr>
<td>
<ul><li>Sign and date your posts by typing four tildes (~~~~).</li>
<li>Put new text below old text.</li></ul>
</td>
<td>
<ul><li>Be polite.</li>
<li>Assume good faith.</li>
<li>Don't delete discussions.</li></ul>
</td></tr></tbody></table>
</section><h2 class="section-heading" onclick="javascript:mfTempOpenSection(1)"><div class="mw-ui-icon mw-ui-icon-element indicator mw-ui-icon-small mw-ui-icon-flush-left"></div><span class="mw-headline" id="Effect_on_Monster_Spawning">Effect on Monster Spawning</span></h2><section class="mf-section-1 collapsible-block" id="mf-section-1">
<p>I was looking at the code, and saw this:
</p><p>In <code>Locations\MineShaft::adjustLevelChances</code> (systematically called by <samp>MineShaft::populateLevel</samp>)
</p>
<div class="mw-highlight mw-highlight-lang-c# mw-content-ltr" dir="ltr"><pre><span></span><span class="kt">bool</span> <span class="n">num</span> <span class="p">=</span> <span class="n">AnyOnlineFarmerHasBuff</span><span class="p">(</span><span class="m">23</span><span class="p">);</span>
<span class="n">flag</span> <span class="p">=</span> <span class="n">AnyOnlineFarmerHasBuff</span><span class="p">(</span><span class="m">24</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="p">&amp;&amp;</span> <span class="n">getMineArea</span><span class="p">()</span> <span class="p">!=</span> <span class="m">121</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(!</span><span class="n">flag</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">monsterChance</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p><i>23 is Oil of Garlic, 24 is Monster Musk (can be double checked in <samp>Buffs.cs</samp>)</i>
</p><p>I don't see any modification to <samp>monsterChance</samp> after <samp>adjustLevelChances()</samp> has been called. I guess it would mean using Oil of Garlic (without Monster Musk) remove all monsters in the Mines (not in Skull Cavern, for which <samp>getMineArea() == 121</samp>).
</p><p>I checked in-game quickly. I encountered no monster in the Mines, except on "quarry levels" (this is specified in the code right after my excerpt in the same function), and level 91; looking in the game code I don't find why, probably just a bug?
</p><p>-- <a href="../User_Charly.html" title="User:Charly">Charly</a> (<a href="../User_talk_Charly.html" title="User talk:Charly">talk</a>) 18:38, 23 November 2021 (UTC)
</p>
<dl><dd>Well, this is huge! The game didn't used to function this way, I remember thinking Oil of Garlic was pretty much worthless if I was carrying a staircase, because it only prevented swarms/infested levels. I wonder when it changed?</dd>
<dd>Anyway, thanks for doing the work <i>and</i> for testing in-game. I'm not sure what to report as the bug -- if preventing all monsters in the mines was intended (why wasn't it in the change notes?), or just limiting it to "weak" monsters (not including Haunted Skulls).¬†??? <a href="../User_Margotbean.html" title="User:Margotbean">margotbean</a> (<a href="../User_talk_Margotbean.html" title="User talk:Margotbean">talk</a>) 21:06, 23 November 2021 (UTC)</dd></dl>
<dl><dd><dl><dd>I looked up in the Forums, Discord, and YouTube trying to have some infos about the Oil of Garlic history, but I couldn't find anything conclusive. There are a lot of references to the wiki page. My guess is the access to the Oil is quite late in the game to people already have reached level 120 in the Mines by that time (and a lot of people just rely on the wiki), so it probably hasn't been tested a lot.</dd></dl></dd></dl>
<dl><dd><dl><dd>To make myself more clear about the bug thing:
<ol><li>I think the removing of monsters, except for quarry levels (so Haunted Skull and Slimes can spawn in there), is a feature, as it is written clearly and very likely purposely in the code.</li>
<li>More suspicious: Entering level 91 once I got two Shadow mobs (it was a normal lava level). I tried to reproduce this. I went with staircases through the Mines with the Buff, and I encountered one or two mobs very rarely: e.g. 1 Bug in level 3, 1 Green Slime in level 15, 2 Grubs in level 19, 1 Bug in level 39, 1 Shadow Brute on level 94, 1 Red Slime on level 115... (Note that's not just one straight up-to-bottom travel, I made some back-and-forth.)</li></ol></dd></dl></dd></dl>
<dl><dd><dl><dd>I dug a bit into that. My first guess following a bug hypothesis was it could be linked to the fact a "lesser or equal" is used in the code to compare with <samp>monsterChance</samp>, i.e. <code>mineRandom.NextDouble() &lt;= monsterChance</code>. But it would be quite a surprise that a random double between 0 and 1 could equal 0 so often.</dd></dl></dd></dl>
<dl><dd><dl><dd>So I checked every <samp>characters.Add(...)</samp> calls in the <samp>Locations\MineShaft.cs</samp> file to inspect monster spawning processes. (In passing, I can say <samp>spawnFlyingMonsterOffScreen()</samp> should never trigger when the Buff is active if I'm not mistaken.)</dd></dl></dd></dl>
<dl><dd><dl><dd>Checking those, I think the rare spawning is due to this chunk of code towards the end of the <samp>populateLevel()</samp> function, which does not depend on the <samp>monsterChance</samp> value, and sometimes replace a stone with a mob (if I'm reading it right: <i>for each 35 stones batch on the level, a 1.5 to 3.5 square around one random stone is defined, and each stone in this square, if it is at more than 5 tiles to the elevator or entering ladder, has a 1.2% chance to be turned into a mob</i>). I can't say if the omission of <samp>monsterChance</samp> check (like <samp>!= 0</samp>) is voluntary or oblivious (could indeed be oblivious in my opinion).</dd></dl></dd></dl>
<dl><dd><dl><dd><div class="mw-highlight mw-highlight-lang-c# mw-content-ltr" dir="ltr"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">stonesLeftOnThisLevel</span> <span class="p">&gt;</span> <span class="m">35</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">num4</span> <span class="p">=</span> <span class="n">stonesLeftOnThisLevel</span> <span class="p">/</span> <span class="m">35</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">l</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">l</span> <span class="p">&lt;</span> <span class="n">num4</span><span class="p">;</span> <span class="n">l</span><span class="p">++)</span>
	<span class="p">{</span>
		<span class="n">Vector2</span> <span class="n">key2</span> <span class="p">=</span> <span class="n">objects</span><span class="p">.</span><span class="n">Keys</span><span class="p">.</span><span class="n">ElementAt</span><span class="p">(</span><span class="n">mineRandom</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="n">objects</span><span class="p">.</span><span class="n">Count</span><span class="p">()));</span>
		<span class="k">if</span> <span class="p">(!</span><span class="n">objects</span><span class="p">[</span><span class="n">key2</span><span class="p">].</span><span class="n">name</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="s">"Stone"</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="kt">int</span> <span class="n">num5</span> <span class="p">=</span> <span class="n">mineRandom</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">8</span><span class="p">);</span>
		<span class="kt">bool</span> <span class="n">flag3</span> <span class="p">=</span> <span class="n">mineRandom</span><span class="p">.</span><span class="n">NextDouble</span><span class="p">()</span> <span class="p">&lt;</span> <span class="m">0.1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">m</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">key2</span><span class="p">.</span><span class="n">X</span> <span class="p">-</span> <span class="n">num5</span> <span class="p">/</span> <span class="m">2</span><span class="p">;</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">m</span> <span class="p">&lt;</span> <span class="n">key2</span><span class="p">.</span><span class="n">X</span> <span class="p">+</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">num5</span> <span class="p">/</span> <span class="m">2</span><span class="p">);</span> <span class="n">m</span><span class="p">++)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">key2</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> <span class="n">num5</span> <span class="p">/</span> <span class="m">2</span><span class="p">;</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">n</span> <span class="p">&lt;</span> <span class="n">key2</span><span class="p">.</span><span class="n">Y</span> <span class="p">+</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">num5</span> <span class="p">/</span> <span class="m">2</span><span class="p">);</span> <span class="n">n</span><span class="p">++)</span>
			<span class="p">{</span>
				<span class="n">Vector2</span> <span class="n">key3</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">objects</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="n">key3</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">objects</span><span class="p">[</span><span class="n">key3</span><span class="p">].</span><span class="n">name</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="s">"Stone"</span><span class="p">))</span>
				<span class="p">{</span>
					<span class="n">objects</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">key3</span><span class="p">);</span>
					<span class="n">stonesLeftOnThisLevel</span><span class="p">--;</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">getDistanceFromStart</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="p">&gt;</span> <span class="m">5f</span> <span class="p">&amp;&amp;</span> <span class="n">flag3</span> <span class="p">&amp;&amp;</span> <span class="n">mineRandom</span><span class="p">.</span><span class="n">NextDouble</span><span class="p">()</span> <span class="p">&lt;</span> <span class="m">0.12</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">Monster</span> <span class="n">monster3</span> <span class="p">=</span> <span class="n">BuffMonsterIfNecessary</span><span class="p">(</span><span class="n">getMonsterForThisLevel</span><span class="p">(</span><span class="n">mineLevel</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">));</span>
						<span class="n">characters</span><span class="p">.</span><span class="n">Add</span><span class="p">((</span><span class="n">NPC</span><span class="p">)</span><span class="n">monster3</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></div></dd></dl></dd></dl>
<dl><dd><dl><dd>-- <a href="../User_Charly.html" title="User:Charly">Charly</a> (<a href="../User_talk_Charly.html" title="User talk:Charly">talk</a>) 01:21, 24 November 2021 (UTC)</dd></dl></dd></dl>
<p><br>
</p>
</section><h2 class="section-heading" onclick="javascript:mfTempOpenSection(2)"><div class="mw-ui-icon mw-ui-icon-element indicator mw-ui-icon-small mw-ui-icon-flush-left"></div><span class="mw-headline" id="Quarry_Levels">Quarry Levels</span></h2><section class="mf-section-2 collapsible-block" id="mf-section-2">
<p>In-game testing shows that Oil of Garlic prevents floors from being Quarry levels, except in the dangerous mines.
</p><p>The relevant code seems to be <samp>MineShaft::loadLevel</samp>.
</p>
<div class="mw-highlight mw-highlight-lang-c# mw-content-ltr" dir="ltr"><pre><span></span>            <span class="k">if</span> <span class="p">((!</span><span class="k">this</span><span class="p">.</span><span class="n">AnyOnlineFarmerHasBuff</span><span class="p">(</span><span class="m">23</span><span class="p">)</span> <span class="p">||</span> <span class="k">this</span><span class="p">.</span><span class="n">getMineArea</span><span class="p">()</span> <span class="p">==</span> <span class="m">121</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">r</span><span class="p">.</span><span class="n">NextDouble</span><span class="p">()</span> <span class="p">&lt;</span> <span class="m">0.044</span> <span class="p">&amp;&amp;</span> <span class="n">mapNumberToLoad</span> <span class="p">%</span> <span class="m">5</span> <span class="p">!=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">mapNumberToLoad</span> <span class="p">%</span> <span class="m">40</span> <span class="p">&gt;</span> <span class="m">5</span> <span class="p">&amp;&amp;</span> <span class="n">mapNumberToLoad</span> <span class="p">%</span> <span class="m">40</span> <span class="p">&lt;</span> <span class="m">30</span> <span class="p">&amp;&amp;</span> <span class="n">mapNumberToLoad</span> <span class="p">%</span> <span class="m">40</span> <span class="p">!=</span> <span class="m">19</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">NextDouble</span><span class="p">()</span> <span class="p">&lt;</span> <span class="m">0.5</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">isMonsterArea</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">isSlimeArea</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">getMineArea</span><span class="p">()</span> <span class="p">==</span> <span class="m">121</span> <span class="p">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="n">mineLevel</span> <span class="p">&gt;</span> <span class="m">126</span> <span class="p">&amp;&amp;</span> <span class="n">r</span><span class="p">.</span><span class="n">NextDouble</span><span class="p">()</span> <span class="p">&lt;</span> <span class="m">0.5</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">isDinoArea</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">isSlimeArea</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">isMonsterArea</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">mineLevel</span> <span class="p">&lt;</span> <span class="m">121</span> <span class="p">&amp;&amp;</span> <span class="n">r</span><span class="p">.</span><span class="n">NextDouble</span><span class="p">()</span> <span class="p">&lt;</span> <span class="m">0.044</span> <span class="p">&amp;&amp;</span> <span class="n">Utility</span><span class="p">.</span><span class="n">doesMasterPlayerHaveMailReceivedButNotMailForTomorrow</span><span class="p">(</span><span class="s">"ccCraftsRoom"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">Game1</span><span class="p">.</span><span class="n">MasterPlayer</span><span class="p">.</span><span class="n">hasOrWillReceiveMail</span><span class="p">(</span><span class="s">"VisitedQuarryMine"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">mapNumberToLoad</span> <span class="p">%</span> <span class="m">40</span> <span class="p">&gt;</span> <span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">mapNumberToLoad</span> <span class="p">%</span> <span class="m">5</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="n">isQuarryArea</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">NextDouble</span><span class="p">()</span> <span class="p">&lt;</span> <span class="m">0.25</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">isMonsterArea</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
</pre></div>
<p>The "<samp>else if</samp>" conditions aren't met when I step through the code, and I don't know why. <samp>mineLevel</samp> is &lt; 121, the save has the Quarry Mine unlocked, and the levels I tried were 22 &amp; 63. Both were persistent quarry levels, until I drank Oil of Garlic. Any insights are very much appreciated! 
</p><p>Also, there seems to be a 4.4% chance of a level being a quarry level, but I found that levels 22 &amp; 63 were consistently quarry levels (until I drank Oil of Garlic). This is also odd to me. I'm stumped. <a href="../User_Margotbean.html" title="User:Margotbean">margotbean</a> (<a href="../User_talk_Margotbean.html" title="User talk:Margotbean">talk</a>) 19:34, 11 September 2022 (UTC)
</p>
<dl><dd>That last bit, about quarry levels and where they appear, changes on a daily basis. Next day they will be on different levels. This can be checked in the Predictor site located... somewhere¬†:-/ The other bit with Oil of garlic is a bit odd, but maybe those enemies are seen as not dangerous enough, and therefore the Quarry won't spawn at all? <a href="../User_Pangaea.html" title="User:Pangaea">Pangaea</a> (<a href="../User_talk_Pangaea.html" title="User talk:Pangaea">talk</a>) 20:00, 11 September 2022 (UTC)
<dl><dd>I used MouseyPounds' predictor utility to find the levels to check before I started testing.¬†;)</dd>
<dd>(Side note: I have messaged Mousey about a couple of updates to the site (like the fact that Quarry levels can no longer be infested as of v1.5), but the site hasn't been updated yet. He may be waiting for v1.6, or some other reason...)</dd>
<dd>The other code about spawning flying monsters offscreen and populating the level happen after the level type is set, and the monsters do update every 10 in-game minutes, but again, only after the level type is set.</dd>
<dd>I literally hit <b><samp>this.isQuarryArea = true;</samp></b> each time until I drank Oil of Garlic, and then the whole block got skipped. Something in the <samp>else if</samp> conditions didn't get met, and I don't see what it is. I guess my next step is to break the code up into separate "if" statements, so I can check each condition separately.¬†:/ <a href="../User_Margotbean.html" title="User:Margotbean">margotbean</a> (<a href="../User_talk_Margotbean.html" title="User talk:Margotbean">talk</a>) 20:40, 11 September 2022 (UTC)
<dl><dd>I broke the <samp>else if</samp> conditions up into separate <samp>if</samp> statements, and the failure is happening on <samp>if (r.NextDouble() &lt; 0.044)</samp>. But, only after drinking Oil of Garlic. This doesn't make sense to me at all.</dd>
<dd>Therefore, I'm going to add it to the page without a code reference. It's repeatedly reproduceable in-game, so I believe it's a true statement. If anyone can provide any insight into the game code, it will be appreciated! <a href="../User_Margotbean.html" title="User:Margotbean">margotbean</a> (<a href="../User_talk_Margotbean.html" title="User talk:Margotbean">talk</a>) 15:27, 13 September 2022 (UTC)</dd></dl></dd></dl></dd></dl>
<dl><dd><dl><dd><dl><dd><dl><dd>Ah! It's subtle, but explainable! Randoms always produce numbers in a specific order. So what was happening was roughly:
<ul><li>Without Oil of Garlic: passes !this.AnyOnlineFarmerHasBuff(23), asks the Random r for a random number, fails somewhere in the next few checks, goes to else if, asks the Random for another random number, passes that check.</li>
<li>With Oil of Garlic: fails !this.AnyOnlineFarmerHasBuff(23), doesn't ask the Random r in the if statement and goes to the else if directly. Because the random wasn't queried, the numbers produced will in effect shift by one, which then caused it to fail (which is very likely, given there's only a 4.4% chance of passing).</li></ul></dd></dl></dd></dl></dd></dl></dd></dl>
<dl><dd><dl><dd><dl><dd><dl><dd>I suspect it's perfectly possible to get a quarry floor with Oil of Garlic, what you're seeing is just a consequence of how Random works.</dd>
<dd>Anyways, the `Game1.MasterPlayer.hasOrWillReceiveMail("VisitedQuarryMine")` part of the check was added in 1.5, otherwise it seems date from 1.4.</dd>
<dd><a href="../User_Atravita.html?title=User:Atravita&amp;action=edit&amp;redlink=1" class="new" title="User:Atravita (page does not exist)">Atravita</a> (<a href="../User_talk_Atravita.html" title="User talk:Atravita">talk</a>) 19:11, 17 September 2022 (UTC)</dd></dl></dd></dl></dd></dl></dd></dl>
<dl><dd><dl><dd><dl><dd><dl><dd><dl><dd>O.M.G. and holy tamales... I stepped through that code for 3 days! Genius, Atravita, genius!! When you say "subtle", you aren't kidding.</dd>
<dd>I'm going to revert my edits now that we have an explanation. I'll be floored by your insight for quite a while. üëç</dd>
<dd>And thank you to IBugOne for the assistance offered on my talk page too! I do have the v1.4 decompiled code, it's just a matter of finding a LAN cable and transferring it from the old PC to the new one. (For context, it's been almost a year and it's still on my "to do" list.) üòÅ</dd>
<dd>Wonderful work, guys! Really wonderful! <a href="../User_Margotbean.html" title="User:Margotbean">margotbean</a> (<a href="../User_talk_Margotbean.html" title="User talk:Margotbean">talk</a>) 19:38, 17 September 2022 (UTC)</dd></dl></dd></dl></dd></dl></dd></dl></dd></dl>




</section></div></div><div class="printfooter">
Retrieved from "<a dir="ltr" href="indexd3ce.html?title=Talk:Oil_of_Garlic&amp;oldid=141756">https://stardewvalleywiki.com/mediawiki/index.php?title=Talk:Oil_of_Garlic&amp;oldid=141756</a>"</div>
<a href="../Oil_of_Garlic.html" class="return-link" title="Oil of Garlic">Return to &quot;Oil of Garlic&quot; page.</a></div>
			<div class="post-content" id="page-secondary-actions">
			
			</div>
		</main>
		<footer class="mw-footer minerva-footer">
		<div class="last-modified-bar">
	<div class="post-content last-modified-bar__content">
		<span class="last-modified-bar__icon mw-ui-icon mw-ui-icon-mw-ui-icon-small mw-ui-icon-wikimedia-history-base20 "></span>
		<a class="last-modified-bar__text modified-enhancement" href="../Special_History/Talk_Oil_of_Garlic.html"
				data-user-name="Margotbean"
				data-user-gender="female"
				data-timestamp="1663443550">
				<span>Last edited on 17 September 2022, at 19:39</span>
		</a>
		<span class="mw-ui-icon mw-ui-icon-small mw-ui-icon-mf-expand-gray mf-mw-ui-icon-rotate-anti-clockwise indicator"></span>
	</div>
</div>

		<div class="post-content footer-content">
			
			<h2>Stardew Valley Wiki</h2>
			<div class="license">Content is available under <a class="external" rel="nofollow" href="../../creativecommons.org/licenses/by-nc-sa/3.0/index.html">Creative Commons Attribution-NonCommercial-ShareAlike</a> unless otherwise noted.</div>
			<ul class="footer-info hlist hlist-separated">
				<li id="footer-info-lastmod"> This page was last edited on 17 September 2022, at 19:39.</li><li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="../../creativecommons.org/licenses/by-nc-sa/3.0/index.html">Creative Commons Attribution-NonCommercial-ShareAlike</a> unless otherwise noted.</li>
			</ul>
			<ul class="footer-places hlist hlist-separated">
				<li id="footer-places-privacy"><a href="../Stardew_Valley_Wiki_Privacy_policy.html" title="Stardew Valley Wiki:Privacy policy">Privacy policy</a></li><li id="footer-places-about"><a href="../Stardew_Valley_Wiki_About.html" title="Stardew Valley Wiki:About">About Stardew Valley Wiki</a></li><li id="footer-places-disclaimer"><a href="../Stardew_Valley_Wiki_General_disclaimer.html" title="Stardew Valley Wiki:General disclaimer">Disclaimers</a></li><li id="footer-places-desktop-toggle"><a id="mw-mf-display-toggle" href="indexcd57.html?title=Talk:Oil_of_Garlic&amp;mobileaction=toggle_view_desktop">Desktop</a></li>
			</ul>
		</div>
		</footer>
	</div>
</div>
<div class="mw-notification-area" data-mw="interface"></div>
<!-- v:8.3.0 -->

<script src="../../external.html?link=https://www.googletagmanager.com/gtag/js?id=G-1S37VCXXZ9" async=""></script><script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-1S37VCXXZ9', {"anonymize_ip":true});
</script>

<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.040","walltime":"0.434","ppvisitednodes":{"value":62,"limit":1000000},"postexpandincludesize":{"value":695,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":8,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":13960,"limit":5000000},"timingprofile":["100.00%   11.217      1 Template:Talkheader","100.00%   11.217      1 -total"]},"cachereport":{"timestamp":"20240709143224","ttl":86400,"transientcontent":false}}});});</script>
<script>(window.NORLQ=window.NORLQ||[]).push(function(){var ns,i,p,img;ns=document.getElementsByTagName('noscript');for(i=0;i<ns.length;i++){p=ns[i].nextSibling;if(p&&p.className&&p.className.indexOf('lazy-image-placeholder')>-1){img=document.createElement('img');img.setAttribute('src',p.getAttribute('data-src'));img.setAttribute('width',p.getAttribute('data-width'));img.setAttribute('height',p.getAttribute('data-height'));img.setAttribute('alt',p.getAttribute('data-alt'));p.parentNode.replaceChild(img,p);}}});</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":127});});</script>		</body>
		

</html>
		

