<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from stardewvalleywiki.com/mediawiki/index.php?title=Modding:Migrate_to_Stardew_Valley_1.5.5&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 11 Apr 2024 05:34:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>View source for Modding:Migrate to Stardew Valley 1.5.5 - Stardew Valley Wiki</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":!0,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"bbdf0ff0ba22a43997493312","wgCSPNonce":!1,"wgCanonicalNamespace":"Modding","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":570,"wgPageName":"Modding:Migrate_to_Stardew_Valley_1.5.5","wgTitle":"Migrate to Stardew Valley 1.5.5","wgCurRevisionId":160135,"wgRevisionId":0,"wgArticleId":13270,"wgIsArticle":!1,"wgIsRedirect":!1,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"Modding:Migrate_to_Stardew_Valley_1.5.5","wgRelevantArticleId":13270,"wgIsProbablyEditable":!1,"wgRelevantPageIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgMFMode":"stable"
,"wgMFAmc":!1,"wgMFAmcOutreachActive":!1,"wgMFAmcOutreachUserEligible":!1,"wgMFLazyLoadImages":!0,"wgMFDisplayWikibaseDescriptions":{"search":!1,"nearby":!1,"watchlist":!1,"tagline":!1},"wgMFIsPageContentModelEditable":!0,"wgCargoMapClusteringMinimum":80,"wgCargoMonthNames":["January","February","March","April","May","June","July","August","September","October","November","December"],"wgCargoMonthNamesShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgCargoWeekDays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"wgCargoWeekDaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"wgMinervaPermissions":{"watch":!0,"talk":!1},"wgMinervaFeatures":{"beta":!1,"donate":!0,"mobileOptionsLink":!0,"categories":!1,"pageIssues":!0,"talkAtTop":!1,"historyInPageActions":!1,"overflowSubmenu":!1,"tabsOnSpecials":!1,"personalMenu":!1,"mainMenuExpanded":!1,"simplifiedTalk":!0},
"wgMinervaDownloadNamespaces":[0],"wgSiteNoticeId":"1.0"};RLSTATE={"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","mediawiki.ui.input":"ready","mediawiki.ui.checkbox":"ready","skins.minerva.base.styles":"ready","skins.minerva.content.styles":"ready","skins.minerva.content.styles.images":"ready","mediawiki.hlist":"ready","mediawiki.ui.icon":"ready","mediawiki.ui.button":"ready","skins.minerva.icons.wikimedia":"ready","skins.minerva.mainMenu.icons":"ready","skins.minerva.mainMenu.styles":"ready","mobile.init.styles":"ready","mobile.messageBox.styles":"ready","ext.dismissableSiteNotice.styles":"ready"};RLPAGEMODULES=["site","mediawiki.page.startup","skins.minerva.options","skins.minerva.scripts","mobile.init","ext.dismissableSiteNotice"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@1hzgi",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});});</script>
<link rel="stylesheet" href="load85db.css?lang=en&amp;modules=ext.dismissableSiteNotice.styles%7Cmediawiki.hlist%7Cmediawiki.ui.button%2Ccheckbox%2Cicon%2Cinput%7Cmobile.init.styles%7Cmobile.messageBox.styles%7Cskins.minerva.base.styles%7Cskins.minerva.content.styles%7Cskins.minerva.content.styles.images%7Cskins.minerva.icons.wikimedia%7Cskins.minerva.mainMenu.icons%2Cstyles&amp;only=styles&amp;skin=minerva"/>
<script async="" src="loadc82b.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=minerva&amp;target=mobile"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="load1154.css?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=minerva"/>
<meta name="generator" content="MediaWiki 1.35.1"/>
<meta name="robots" content="noindex,nofollow"/>
<meta name="description" content="You do not have permission to edit this page, for the following reason:"/>
<meta name="theme-color" content="#eaecf0"/>
<meta name="viewport" content="initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0, width=device-width"/>
<link rel="manifest" href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/api.php?action=webapp-manifest"/>
<link rel="shortcut icon" href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/favicon.png"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/opensearch_desc.php" title="Stardew Valley Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="../../external.html?link=http://stardewvalleywiki.com/mediawiki/api.php?action=rsd"/>
<link rel="license" href="../../external.html?link=https://creativecommons.org/licenses/by-nc-sa/3.0/"/>
<meta property="og:title" content="View source for Modding:Migrate to Stardew Valley 1.5.5 - Stardew Valley Wiki"/>
<meta property="og:site_name" content="Stardew Valley Wiki"/>
<meta property="og:url" content="https://stardewvalleywiki.com/Modding:Migrate_to_Stardew_Valley_1.5.5"/>
<meta property="og:description" content="←Index"/>
<meta property="og:image" content="https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/site_logo_sm.png"/>
<meta property="article:modified_time" content="2024-03-25T20:42:58Z"/>
<meta property="article:published_time" content="2024-03-25T20:42:58Z"/>
<meta property="twitter:site" content="@stardewwiki"/>
<meta property="twitter:title" content="View source for Modding:Migrate to Stardew Valley 1.5.5 - Stardew Valley Wiki"/>
<meta property="twitter:description" content="←Index"/>
<meta property="twitter:image" content="https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/site_logo_sm.png"/>
<meta property="twitter:card" content="summary_large_image"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"article","name":"View source for Modding:Migrate to Stardew Valley 1.5.5 - Stardew Valley Wiki","headline":"View source for Modding:Migrate to Stardew Valley 1.5.5 - Stardew Valley Wiki","mainEntityOfPage":"View source for Modding:Migrate to Stardew Valley 1.5.5","identifier":"https:\/\/stardewvalleywiki.com\/Modding:Migrate_to_Stardew_Valley_1.5.5","url":"https:\/\/stardewvalleywiki.com\/Modding:Migrate_to_Stardew_Valley_1.5.5","description":"\u2190Index","dateModified":"2024-03-25T20:42:58Z","datePublished":"2024-03-25T20:42:58Z","image":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png"},"author":{"@type":"Organization","name":"Stardew Valley Wiki","url":"\/\/stardewvalleywiki.com","logo":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png","caption":"Stardew Valley Wiki"}},"publisher":{"@type":"Organization","name":"Stardew Valley Wiki","url":"\/\/stardewvalleywiki.com","logo":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png","caption":"Stardew Valley Wiki"}},"potentialAction":{"@type":"SearchAction","target":"https:\/\/stardewvalleywiki.com\/mediawiki\/index.php?title=Special:Search&search={search_term}","query-input":"required name=search_term"}}</script>
<!--[if lt IE 9]><script src="/mediawiki/resources/lib/html5shiv/html5shiv.js"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-570 ns-subject page-Modding_Migrate_to_Stardew_Valley_1_5_5 rootpage-Modding_Migrate_to_Stardew_Valley_1_5_5 stable skin-minerva action-edit skin-vector-legacy">
<div id="mw-mf-viewport">
	<div id="mw-mf-page-center">
		<a class="mw-mf-page-center__mask" href="#"></a>
		<header class="header-container header-chrome">
			<form class="header" action="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php" method="get">
				<nav class="navigation-drawer toggle-list view-border-box">
					<input type="checkbox" id="main-menu-input" class="toggle-list__checkbox" role="button" aria-labelledby="mw-mf-main-menu-button">
					<label for="main-menu-input" id="mw-mf-main-menu-button"
						class="mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-menu-base20 mw-ui-icon-flush-left toggle-list__toggle"
						title="Open main menu" data-event-name="ui.mainmenu">Open main menu</label>
					<div id="mw-mf-page-left" class="menu toggle-list__list view-border-box">
	<ul id="p-navigation">
			<li class="">
			    <a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki" class="mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-home" data-event-name="menu.home"><span>Home</span></a>
			</li>
			<li class="">
			    <a href="../../external.html?link=https://stardewvalleywiki.com/Special:Random#/random" class="mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-die " data-event-name="menu.random"><span>Random</span></a>
			</li>
	</ul>
	<ul id="p-personal">
			<li class="">
			    <a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Special:UserLogin&amp;returnto=Modding%3AMigrate+to+Stardew+Valley+1.5.5&amp;returntoquery=action%3Dedit" class="menu__item--login mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-logIn " data-event-name="menu.login"><span>Log in</span></a>
			</li>
	</ul>
	<ul id="pt-preferences">
			<li class="jsonly">
			    <a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Special:MobileOptions&amp;returnto=Modding%3AMigrate+to+Stardew+Valley+1.5.5" class="menu__item--settings mw-ui-icon mw-ui-icon-before mw-ui-icon-minerva-settings " data-event-name="menu.settings"><span>Settings</span></a>
			</li>
	</ul>
	<ul class="hlist">
			<li class="">
			    <a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:About" class="" data-event-name=""><span>About Stardew Valley Wiki</span></a>
			</li>
			<li class="">
			    <a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:General_disclaimer" class="" data-event-name=""><span>Disclaimers</span></a>
			</li>
	</ul>
</div>

					<label class="main-menu-mask" for="main-menu-input"></label>
				</nav>
				<div class="branding-box">
					<a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki">
						<span>Stardew Valley Wiki</span>
						
					</a>
				</div>
				<div class="search-box">
					<input class="search mw-ui-background-icon-search skin-minerva-search-trigger" type="search" name="search" id="searchInput"
						autocomplete="off" placeholder="Search Stardew Valley Wiki" aria-label="Search Stardew Valley Wiki"
						value="">
				</div>
				<nav class="minerva-user-navigation" aria-label="User navigation">
					<div><button id="searchIcon" class="mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-search-base20 skin-minerva-search-trigger" type="submit">Search</button></div>
					
				</nav>
			</form>
		</header>
		<main id="content" class="mw-body">
			<div class="banner-container">
			<div id="siteNotice"></div>
			</div>
			
			<div class="pre-content heading-holder">
				<div class="page-heading">
					<h1 id="section_0">View source for Modding:Migrate to Stardew Valley 1.5.5</h1>
					<div class="tagline"></div>
				</div>
				
				
				
				<div class="minerva__subtitle">← <a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Migrate_to_Stardew_Valley_1.5.5" title="Modding:Migrate to Stardew Valley 1.5.5">Modding:Migrate to Stardew Valley 1.5.5</a></div>
			</div>
			
			<div id="bodyContent" class="content"><div id="mw-content-text"><script>function mfTempOpenSection(id){var block=document.getElementById("mf-section-"+id);block.className+=" open-block";block.previousSibling.className+=" open-block";}</script><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in the group: <a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Stardew_Valley_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Stardew Valley Wiki:Users (page does not exist)">Users</a>.
</p>
</div><hr />
<p>You can view and copy the source of this page.
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" class="mw-editfont-monospace mw-ui-input" lang="en" dir="ltr" name="wpTextbox1">←[[Modding:Index|Index]]

{{Modder compatibility header}}

This page explains how to update your mods for compatibility with {{version|1.5.5|Stardew Valley 1.5.5}}, and documents some of the changes and new functionality.

==Breaking changes for SMAPI mods==
===64-bit MonoGame and .NET 5===
Stardew Valley 1.5.5 migrates to 64-bit MonoGame and .NET 5 on all platforms. SMAPI rewrites mods so they should mostly still work, but posting an update for every C# mod is strongly recommended to avoid edge cases.

To update your C# mod code:
&lt;ol>
&lt;li>[[Modding:Migrate to 64-bit on Windows#How do I update mod code for 64-bit?|Enable 64-bit compatibility]] if you haven't already. (Unless you explicitly changed the project settings, mods are 64-bit ready by default.)&lt;/li>
&lt;li>Migrate your &lt;samp>.csproj&lt;/samp> files to the new format if you haven't already:&lt;ol>
&lt;li>Replace your mod's &lt;samp>.csproj&lt;/samp> file with this:
&lt;syntaxhighlight lang="xml">
&lt;Project Sdk="Microsoft.NET.Sdk">
  &lt;PropertyGroup>
    &lt;AssemblyName>EXAMPLE_MOD_NAME&lt;/AssemblyName>
    &lt;RootNamespace>EXAMPLE_MOD_NAME&lt;/RootNamespace>
    &lt;Version>1.0.0&lt;/Version>
    &lt;TargetFramework>net5.0&lt;/TargetFramework>
    &lt;LangVersion>Latest&lt;/LangVersion>
  &lt;/PropertyGroup>

  &lt;ItemGroup>
    &lt;PackageReference Include="Pathoschild.Stardew.ModBuildConfig" Version="4.1.1" />
  &lt;/ItemGroup>
&lt;/Project>
&lt;/syntaxhighlight>
&lt;/li>
&lt;li>If the mod uses [[Modding:Modder Guide/APIs/Harmony|Harmony]], add &lt;code>&lt;nowiki>&lt;EnableHarmony>true&lt;/EnableHarmony>&lt;/nowiki>&lt;/code> to the property group.&lt;/li>
&lt;li>Update the &lt;samp>AssemblyName&lt;/samp>, &lt;samp>RootNamespace&lt;/samp>, and &lt;samp>Version&lt;/samp> tags. (You can delete the &lt;samp>AssemblyName&lt;/samp> and &lt;samp>RootNamespace&lt;/samp> tags if they just match the project name.)&lt;/li>
&lt;li>Add any other NuGet packages you used, if any.&lt;/li>
&lt;/ol>

If you're using the simplified format already, you just need to update version numbers in the .csproj file:
&lt;ol>
&lt;li>Replace &lt;code>&lt;nowiki>&lt;TargetFramework>net452&lt;/TargetFramework>&lt;/nowiki>&lt;/code> with &lt;code>&lt;nowiki>&lt;TargetFramework>net5.0&lt;/TargetFramework>&lt;/nowiki>&lt;/code>.&lt;/li>
&lt;li>Replace &lt;code>&lt;nowiki>&lt;PackageReference Include="Pathoschild.Stardew.ModBuildConfig" Version="3.3.0" />&lt;/nowiki>&lt;/code> with &lt;code>&lt;nowiki>&lt;PackageReference Include="Pathoschild.Stardew.ModBuildConfig" Version="4.1.1" />&lt;/nowiki>&lt;/code>&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>Delete the &lt;samp>Properties/AssemblyInfo.cs&lt;/samp> file, &lt;samp>packages&lt;/samp> folder, and &lt;samp>packages.config&lt;/samp> file (if present).&lt;/li>
&lt;li>Exit Visual Studio.&lt;/li>
&lt;li>Delete your solution's hidden &lt;samp>.vs&lt;/samp> folder, and every project's &lt;samp>bin&lt;/samp> and &lt;samp>obj&lt;/samp> folders.&lt;/li>
&lt;li>Reopen the solution in Visual Studio, click ''Build > Rebuild Solution'', fix any errors, and test the mod in-game.&lt;/li>
&lt;/ol>

Specific things to check for:
* [[Modding:Modder Guide/APIs/Utilities#Constants|&lt;code>Constants.GameFramework&lt;/code>]] now always returns &lt;samp>MonoGame&lt;/samp>. Any code which checks for &lt;samp>Xna&lt;/samp> can be removed or rewritten.

If you need help, feel free to ask in [[Modding:Community#Discord|#making-mods on the Stardew Valley Discord]]!

===Asset name format change===
Some background first:
* An ''asset name'' identifies an asset you can load through a content API like &lt;code>&lt;nowiki>Game1.content.Load&lt;T>("asset name")&lt;/nowiki>&lt;/code>. For example: &lt;code>Characters/Abigail&lt;/code>.
* A ''file path'' identifies a physical file on the computer. For example: &lt;code>C:\Program Files (x86)\Steam\steamapps\common\Stardew Valley\Content\Characters\Abigail.xnb&lt;/code>.

Stardew Valley 1.5.5 makes that distinction more important, since MonoGame uses Linux-style separators in asset names on all platforms. That means '''asset names no longer match path conventions on Windows'''.

You should review all code in your mods that creates/compares paths, check whether it's actually creating/comparing asset names, and if so migrate it to the equivalent methods:

{| class="wikitable"
|-
! code for file paths
! code for asset names
|-
| &lt;code>PathUtilities.NormalizePath("a/b")&lt;/code>
| &lt;code>PathUtilities.NormalizeAssetName("a/b")&lt;/code>
|-
| &lt;code>Path.Combine("a", "b")&lt;/code>
| &lt;code>PathUtilities.NormalizeAssetName("a/b")&lt;/code>
|-
| &lt;code>Path.DirectorySeparatorChar&lt;/code>
| &lt;code>PathUtilities.AssetDirectorySeparator&lt;/code>
|}

===Game compatibility branch===
{{main article|Modding:Player Guide/Troubleshooting#SMAPI doesn't work with compatibility branch}}

Stardew Valley 1.5.5 is available in two branches on each OS: the ''main branch'' which is installed by default, and an optional [https://www.stardewvalley.net/compatibility''compatibility branch'' for older systems]. These have identical content for players, but use different frameworks:

{| class="wikitable"
|-
! branch
! OS
! game framework
! runtime
|- style="color: #090;"
|rowspan="2"| main
| Linux/macOS
| MonoGame 3.8
| 64-bit .NET 5
|- style="color: #090;"
| Windows
| MonoGame 3.8
| 64-bit .NET 5
|- style="color: #900;"
|rowspan="2"| compatibility
| Linux/macOS
| MonoGame 3.5.1
| 64-bit Mono 4.5
|- style="color: #900;"
| Windows
| XNA Framework 4.0
| 32-bit .NET Framework 4.5
|}

Unfortunately '''SMAPI only supports the main branch of the game currently.''' There are formidable difficulties across all mods in supporting all three variations, 32-bit imposes significant restrictions on what mods can do, and the [https://store.steampowered.com/hwsurvey Steam hardware stats] show that ≈99.69% of players have 64-bit.

Having two versions of SMAPI (like we do for Linux/macOS vs Windows compatibility) wouldn't be enough in this case. Every C# mod author would need to manually port two versions of every update of every mod forever, which is prohibitively unfeasible. It's possible that in the future we'll either figure out how SMAPI can automatically rewrite mods for the compatibility branch, or some modders may port SMAPI and individual mods to the compatibility branch.

===Game assembly name===
Previously the game assembly was &lt;code>Stardew Valley&lt;/code> on Windows, and &lt;code>StardewValley&lt;/code> on Linux and macOS. The assembly is now named &lt;code>Stardew Valley&lt;/code> on all platforms. Most mods shouldn't be affected once you update the mod build package.

===New assembly reference model===
If your mod references a &lt;samp>.dll&lt;/samp> file manually, note that assembly references are handled differently in .NET 5. Custom assemblies are no longer copied into your mod's folder by default, which may break your mod. In that case you need to explicitly enable assembly bundling in your project file; see &lt;code>BundleExtraAssemblies&lt;/code> in the [https://smapi.io/package mod build package] documentation for details.

==Breaking changes for Content Patcher packs==
===XNB impact===
Here's a summary of the XNB files which changed in Stardew Valley 1.5.5.

Notes:
* This ignores text changes in non-English files for simplicity.
* New content files aren't listed, since they won't impact existing mods.
* XNB mods are disproportionately affected, since they replace the entire file. Content Patcher packs are typically unaffected unless they replace the entire file (in which case see the XNB mod column).

Shorthand:
* 'broken' means removing new content or potentially important changes, or potentially causing significant display bugs. This is a broad category — the game may work fine without it or crash, depending how it uses that specific content.
* 'mostly unaffected' means mods will only be affected if they edit specific entries or fields.
* Blank means no expected impact for the vast majority of mods.

{| class="wikitable"
|-
! content file
! changes
! XNB
! Content Patcher
|-
| &lt;samp>Data/TV/TipChannel&lt;/samp>
| fixed typo
| ✘ will remove changes
| ✓ mostly unaffected
|-
| &lt;samp>Effects/BloomCombine&lt;/samp>&lt;br />&lt;samp>Effects/BloomExtract&lt;/samp>&lt;br />&lt;samp>Effects/GaussianBlur&lt;/samp>
| deleted
|
|
|-
| &lt;samp>Fonts/*&lt;/samp>
| no changes&lt;br />([[Modding:Editing XNB files#unpack|unpacked format]] may differ on Windows due to [[#64-bit MonoGame and .NET 5|MonoGame]])
|
|
|-
| &lt;samp>LooseSprites/Cursors2&lt;/samp>
| new sprite in empty area
| '''✘ broken'''
| ✓ mostly unaffected
|-
| &lt;samp>Maps/Desert&lt;/samp>
| cosmetic fixes
| ✘ will remove changes
| ✓ mostly unaffected
|-
| &lt;samp>Maps/ElliottHouse&lt;/samp>
| minor fixes
| ✘ will remove changes
| ✓ mostly unaffected
|-
| &lt;samp>Maps/Farm&lt;/samp>&lt;br />&lt;samp>Maps/Farm_Combat&lt;/samp>&lt;br />&lt;samp>Maps/Farm_Fishing&lt;/samp>&lt;br />&lt;samp>Maps/Farm_Foraging&lt;/samp>&lt;br />&lt;samp>Maps/Farm_FourCorners&lt;/samp>&lt;br />&lt;samp>Maps/Farm_Island&lt;/samp>&lt;br />&lt;samp>Maps/Farm_Mining&lt;/samp>
| cave and shipping areas now use tile properties to disable building, instead of being hardcoded
| ✘ will remove those build restrictions
| ✘ may remove those build restrictions
|-
| &lt;samp>Maps/FarmHouse&lt;/samp>&lt;br />&lt;samp>Maps/FarmHouse1&lt;/samp>&lt;br />&lt;samp>Maps/FarmHouse1_marriage&lt;/samp>&lt;br />&lt;samp>Maps/FarmHouse2&lt;/samp>&lt;br />&lt;samp>Maps/FarmHouse2_marriage&lt;/samp>&lt;br />&lt;samp>Maps/Farmhouse_*&lt;/samp> renovation maps&lt;br />&lt;samp>Maps/IslandFarmHouse&lt;/samp>&lt;br />&lt;samp>Maps/Shed&lt;/samp>&lt;br />&lt;samp>Maps/Shed2&lt;/samp>
| added new [[#Custom floors/walls|wall/flooring properties]]
| '''✘ broken''' (will disable most floor/walls when renovations applied)
| ✘ may disable some floor/walls when renovations applied
|-
| &lt;samp>Maps/spouseRooms&lt;/samp>
| added [[#Custom spouse rooms|spouse standing spots]] (defaults to old offset if not set)
| ✓ mostly unaffected
| ✓ mostly unaffected
|-
| &lt;samp>Strings/Locations&lt;/samp>
| changed &lt;samp>ManorHouse_DivorceBook_*&lt;/samp> entries to support [[#Non-Krobus roommates|Non-Krobus roommates]]
| '''✘ broken'''
| ✓ mostly unaffected
|}

==New features for SMAPI mods==
: ''See also [[#New features for Content Patcher packs|new features for Content Patcher packs]], which apply for C# mods too.

===Scarecrow changes===
You can now patch &lt;code>Object.IsScarecrow()&lt;/code> and/or &lt;code>Object.GetRadiusForScarecrow()&lt;/code> (or add [[#Custom scarecrows|context tags]]) to support custom scarecrows or custom ranges.

===Horse footstep changes===
You can now override the footstep logic for a horse by setting its &lt;samp>onFootstepAction&lt;/samp> field. For example:
&lt;syntaxhighlight lang="c#">
Horse horse = ...; // get the horse instance you want to change
horse.onFootstepAction = (string tileType) =>
{
   // play custom audio, etc
};
&lt;/syntaxhighlight>

==New features for Content Patcher packs==
Stardew Valley 1.5.5 has no known breaking changes for content packs. All content packs should work fine once the framework mod that loads them is updated.

===Custom farm types===
You can now add custom farm types by editing the &lt;samp>Data/AdditionalFarms&lt;/samp> asset. Each entry consists of an object with these fields:

{| class="wikitable"
|-
! field
! description
|-
| &lt;samp>ID&lt;/samp>
| A unique ID value. This must be '''globally''' unique across all mods, so you should prefix your mod ID (''e.g.,'' &lt;samp>Example.PineapplesAnywhere/PineappleFarm&lt;/samp>). You should avoid commas for compatibility with Content Patcher packs checking the &lt;samp>&lt;nowiki>{{FarmType}}&lt;/nowiki>&lt;/samp> token. This is not shown in-game.
|-
| &lt;samp>TooltipStringPath&lt;/samp>
| Where to get the translatable farm name and description. This must be a key in the form &lt;samp>{{t|asset name}}:{{t|key}}&lt;/samp>; for example, &lt;samp>Strings/UI:Farm_Description&lt;/samp> will get it from the &lt;samp>Farm_Description&lt;/samp> entry in the &lt;samp>Strings/UI&lt;/samp> file. The translated text must be in the form "&lt;samp>{{t|name}}_{{t|description}}&lt;/samp>", like "Pineapple Farm_A farm shaped like a pineapple".
|-
| &lt;samp>MapName&lt;/samp>
| The map asset name relative to the &lt;samp>Maps&lt;/samp> folder. For example, &lt;samp>Farm_Pineapple&lt;/samp> would load &lt;samp>Maps/Farm_Pineapple&lt;/samp>.
|-
| &lt;samp>IconTexture&lt;/samp>
| ''(optional)'' The asset name for a 22x20 pixel icon texture, shown on the 'New Game' and co-op join screens.
|-
| &lt;samp>WorldMapTexture&lt;/samp>
| ''(optional)'' The asset name for a 131x61 pixel texture that's drawn over the farm area in the in-game world map.
|-
| &lt;samp>ModData&lt;/samp>
| ''(optional)'' A string→string dictionary of mod-specific metadata for the farm, which can be accessed in C# code via &lt;samp>Game1.GetFarmTypeModData(key)&lt;/samp>.
|}

For example, this Content Patcher pack would create a 'pineapple' farm:
{{#tag:syntaxhighlight|
{
    "Format": "{{Content Patcher version}}",
    "Changes": [
        // add farm type
        {
            "Action": "EditData",
            "Target": "Data/AdditionalFarms",
            "Entries": {
                "ExampleAuthor.PineappleFarm/PineappleFarm": { // for technical reasons, you need to specify the ID here *and* in the "ID" field
                    "ID": "ExampleAuthor.PineappleFarm/PineappleFarm",
                    "TooltipStringPath": "Strings/UI:ExampleAuthor_PineappleFarm",
                    "MapName": "ExampleAuthor_PineappleFarm",
                    "IconTexture": "Mods/ExampleAuthor.PineappleFarm/Icon",
                    "WorldMapTexture": "Mods/ExampleAuthor.PineappleFarm/WorldMap"
                }
            }
        },

        // add farm name + description
        {
            "Action": "EditData",
            "Target": "Strings/UI",
            "Entries": {
                "ExampleAuthor_PineappleFarm": "Pineapple Farm_A farm shaped like a pineapple!" // tip: use &lt;nowiki>{{i18n}}&lt;/nowiki> to translate it
            }
        },

        // load map
        {
            "Action": "Load",
            "Target": "Maps/ExampleAuthor_PineappleFarm",
            "FromFile": "assets/map.tmx"
        },

        // load icon
        {
            "Action": "Load",
            "Target": "Mods/ExampleAuthor.PineappleFarm/Icon, Mods/ExampleAuthor.PineappleFarm/WorldMap",
            "FromFile": "assets/&lt;nowiki>{{TargetWithoutPath}}&lt;/nowiki>.png"
        }
    ]
}|lang=javascript}}

===Custom languages===
{{main article|Modding:Custom languages}}

You can now add custom languages by editing the &lt;samp>Data/AdditionalLanguages&lt;/samp> asset. Each entry consists of an object with these fields:

{| class="wikitable"
|-
! field
! description
|-
| &lt;samp>ID&lt;/samp>
| A unique ID value. This is not shown in-game.
|-
| &lt;samp>LanguageCode&lt;/samp>
| The language code for this localization. This should ideally be a [[wikipedia:List of ISO 639-1 codes|ISO 639-1 code]]. You should avoid commas for compatibility with Content Patcher packs checking the &lt;samp>&lt;nowiki>{{Language}}&lt;/nowiki>&lt;/samp> token.
|-
| &lt;samp>ButtonTexture&lt;/samp>
| The asset name for a 174x78 pixel texture containing the button of the language for language selection menu. The top half of the sprite is the default state, while the bottom half is the hover state.
|-
| &lt;samp>UseLatinFont&lt;/samp>
| Whether the language uses the same Latin character font as English. If set to &lt;samp>false&lt;/samp>, you must set the &lt;samp>FontFile&lt;/samp> field.
|-
| &lt;samp>TimeFormat&lt;/samp>
| A string which describes the in-game time format, with tokens replaced by in-game values. For example, &lt;code>[HOURS_12]:[MINUTES] [AM_PM]&lt;/code> would show &lt;code>12:00 PM&lt;/code> at noon.

The valid tokens are:
* &lt;code>[HOURS_12]&lt;/code>: hours in 12-hour format, where midnight and noon are both "12".
* &lt;code>[HOURS_12_0]&lt;/code>: hours in 12-hour format, where midnight and noon are both "0".
* &lt;code>[HOURS_24]&lt;/code>: hours in 24-hour format, where midnight is "0" and noon is "12".
* &lt;code>[HOURS_24_00]&lt;/code>: hours in 24-hour format with zero-padding, where midnight is "00" and noon is "12".
* &lt;code>[MINUTES]&lt;/code>: minutes with zero-padding.
* &lt;code>[AM_PM]&lt;/code>: the localized text for "am" or "pm" (taken from &lt;code>Strings\\StringsFromCSFiles:DayTimeMoneyBox.cs.10370&lt;/code> and &lt;code>DayTimeMoneyBox.cs.10371&lt;/code> respectively). The game shows "pm" between noon and 11:59pm inclusively; it shows "am" otherwise.
|-
| &lt;samp>ClockTimeFormat&lt;/samp>
| A string which describes the in-game time format. Equivalent to &lt;samp>TimeFormat&lt;/samp>, but used for the in-game clock.
|-
| &lt;samp>ClockDateFormat&lt;/samp>
| A string which describes the in-game date format as shown in the in-game clock, with tokens replaced by in-game values. For example, &lt;code>[DAY_OF_WEEK]. [DAY_OF_MONTH]&lt;/code> would show &lt;code>Mon. 1&lt;/code>.

The valid tokens are:
* &lt;code>[DAY_OF_WEEK]&lt;/code>: the abbreviated day of week as returned by &lt;code>Game1.shortDayDisplayNameFromDayOfSeason&lt;/code> (like &lt;samp>Mon&lt;/samp> for Monday).
* &lt;code>[DAY_OF_MONTH]&lt;/code>: the numerical day of the month.
|-
| &lt;samp>FontFile&lt;/samp>
| ''(optional)'' The asset name for the font file to use (if &lt;samp>UseLatinFont&lt;/samp> is &lt;samp>false&lt;/samp>).
|-
| &lt;samp>FontPixelZoom&lt;/samp>
| ''(optional)'' A factor by while to multiply the font size.
|-
| &lt;samp>FontApplyYOffset&lt;/samp>
| ''(optional)'' Whether to shift the font up by four pixels (multiplied by the &lt;samp>FontPixelZoom&lt;/samp>), to better align languages with larger characters like Chinese and Japanese.
|-
| &lt;samp>NumberComma&lt;/samp>
| ''(optional)'' The string to use as the thousands separator (''e.g.,'' &lt;code>","&lt;/code> for &lt;code>5,000,000&lt;/code>). Defaults to a comma.
|-
| &lt;samp>SmallFontLineSpacing&lt;/samp>
| ''(optional)'' The line spacing value used by &lt;samp>smallFont&lt;/samp>. Defaults to 26.
|-
| &lt;samp>UseGenderedCharacterTranslations&lt;/samp>
| ''(optional)'' Whether the social tab and gift log will use gender-specific translations (like the vanilla Portuguese language). Defaults to false.

Specifically, this affects the &lt;samp>Strings\StringsFromCSFiles:SocialPage.cs.11635&lt;/samp> translation ("''(Single)''"). When enabled, it can contain male and female translations separated by &lt;code>/&lt;/code>, like the vanilla Portuguese translation: "''(solteiro)/(solteira)''".
|}

For example, this Content Patcher pack would add Esperanto to the game:
{{#tag:syntaxhighlight|
{
    "Format": "{{Content Patcher version}}",
    "Changes": [
        // define language
        {
            "Action": "EditData",
            "Target": "Data/AdditionalLanguages",
            "Entries": {
                "ExampleAuthor.Esperanto": { // for technical reasons, you need to specify the ID here *and* in the "ID" field
                    "ID": "ExampleAuthor.Esperanto",
                    "LanguageCode": "eo",
                    "ButtonTexture": "Mods/ExampleAuthor.Esperanto/Button",
                    "UseLatinFont": true,
                    "TimeFormat": "[HOURS_24_00]:[MINUTES]",
                    "ClockTimeFormat": "[HOURS_24_00]:[MINUTES]",
                    "ClockDateFormat": "[DAY_OF_WEEK] [DAY_OF_MONTH]"
                }
            }
        },

        // load button texture
        {
            "Action": "Load",
            "Target": "Mods/ExampleAuthor.Esperanto/Button",
            "FromFile": "assets/button.png"
        }
    ]
}|lang=javascript}}

Once the language is defined, you can add translations to the game by patching game assets like usual, and use the language code you specified above. For example:
&lt;syntaxhighlight lang="javascript">
{
    "Action": "EditData",
    "Target": "Strings/StringsFromCSFiles",
    "Entries": {
        "Game1.cs.3043": "Lundo",
        "Game1.cs.3044": "Mardo",
        ...
    },
    "When": {
        "Language": "eo"
    }
}
&lt;/syntaxhighlight>

===Custom festival location names===
The location name in the festival-started message (''e.g.,'' "''The Luau has begun on the beach''") was previously hardcoded, so it would always show the internal name for non-vanilla festival locations. You can now add a &lt;samp>locationDisplayName&lt;/samp> field in the &lt;samp>Data/Festivals/*&lt;/samp> file to set the display name.

===Custom spouse rooms===
Adding spouse rooms for custom NPCs is now much easier. 
&lt;ul>
&lt;li>You can edit the &lt;samp>Data/SpouseRooms&lt;/samp> asset to add the spouse room info in this format: &lt;code>"{{t|NPC name}}": "{{t|map name}}/{{t|map index}}"&lt;/code>.

{| class="wikitable"
|-
! field
! effect
|-
| &lt;code>{{t|NPC name}}&lt;/code>
| The internal name of the NPC (''i.e.,'' their key in &lt;samp>Data/NPCDispositions&lt;/samp>).
|-
| &lt;code>{{t|map name}}&lt;/code>
| The asset name of the map in the game's &lt;samp>Content/Maps&lt;/samp> folder. This can be a custom map loaded through Content Patcher's &lt;samp>Load&lt;/samp> action or SMAPI's &lt;samp>IAssetLoader&lt;/samp> API.
|-
| &lt;code>{{t|map index}}&lt;/code>
| The index of the spouse room within the map file, to allow multiple spouse rooms in the same file. Each spouse room is 6 tiles across by 9 tiles down, starting with index 0 in the top-left corner. You can have any number of rows and columns (the index will wrap at the end of the row), as long as they fit an integer number of spouse rooms.
|}&lt;/li>
&lt;li>You can mark where the spouse stands in their spouse room by placing the red circle path tile (tile index 7) on [[Modding:Maps#Paths layer|the &lt;samp>Paths&lt;/samp> layer]].&lt;/li>
&lt;li>The spouse room maps are now applied using the game's newer map override system, so tile properties and custom tilesheets in the spouse room map are copied over automatically.&lt;/li>
&lt;li>Some of the game's spouse room code (''e.g.,'' positions for Sebastian's 14-heart frog terrarium) was updated to potentially allow moving spouse rooms around. However, some things like event positions are still hardcoded and will need to be fixed to fully support this feature.&lt;/li>
&lt;/ul>

For example, this Content Patcher pack would add a spouse room for a new Akila NPC:
{{#tag:syntaxhighlight|
{
    "Format": "{{Content Patcher version}}",
    "Changes": [
        // register spouse room
        {
            "Action": "EditData",
            "Target": "Data/SpouseRooms",
            "Entries": {
                "Akila": "ExampleAuthor_ExampleAkilaMod_SpouseRoom/0"
            }
        },

        // load spouse room map
        {
            "Action": "Load",
            "Target": "Maps/ExampleAuthor_ExampleAkilaMod_SpouseRoom",
            "FromFile": "assets/spouse-room.tmx"
        }
    ]
}|lang=javascript}}

===Custom spouse outside areas===
You can now customize the [[Marriage#Spouse Outside Area|spouse outside area]] for any NPC by editing &lt;samp>Data/SpousePatios&lt;/samp>, which has four slash-delimited fields:
{| class="wikitable"
|-
! field
! effect
|-
| &lt;samp>map asset name&lt;/samp>
| The asset name relative to the &lt;samp>Content/Maps&lt;/samp> folder which contains the spouse area map. The map must contain one or more 4x4 tile areas, with any number of rows and columns.
|-
| &lt;samp>index&lt;/samp>
| The index (starting at zero) within the map for the 4x4 area to use as the outdoor area.
|-
| &lt;samp>NPC animation frames&lt;/samp>
| ''(Optional)'' The spouse's animation frames, as a sequence of space-delimited frame indexes in their sprite's spritesheet each lasting 100 milliseconds. If not set, vanilla spouses will use their hardcoded animations and custom spouses won't be animated.
|-
| &lt;samp>{{t|NPC offset X}} {{t|NPC offset Y}}&lt;/samp>
| ''(Optional)'' A pixel X and Y offset applied to the NPC's position when they're in their outdoor area.
|}

You can mark where the spouse stands in their spouse area by placing the red circle path tile (tile index 7) on [[Modding:Maps#Paths layer|the &lt;samp>Paths&lt;/samp> layer]].

For example, this Content Patcher pack would add the outside area for a new Akila NPC. When in the outside area, their sprite would cycle through spritesheet indexes 16&amp;ndash;19 for 300 milliseconds each, and be offset by 1 pixel to the right and 5 pixels down.
{{#tag:syntaxhighlight|
{
    "Format": "{{Content Patcher version}}",
    "Changes": [
        // register outside area
        {
            "Action": "EditData",
            "Target": "Data/SpousePatios",
            "Entries": {
                "Akila": "ExampleAuthor_ExampleAkilaMod_OutsideArea/0/16 16 16 17 17 17 18 18 18 19 19 19/1 5"
            }
        },

        // load spouse map
        {
            "Action": "Load",
            "Target": "Maps/ExampleAuthor_ExampleAkilaMod_OutsideArea",
            "FromFile": "assets/outside-area.tmx"
        }
    ]
}|lang=javascript}}

===Custom farmhouse renovations===
You can now add custom [[Farmhouse#Upgrades|farmhouse renovations]] that will be applied automatically when the specified [[Modding:Mail data#Mail flags|mail flag]] is set. This is based on a new map property in the farmhouse map:

{| class="wikitable"
|-
! valid in
! map property
! usage
|-
| farmhouse
| &lt;samp>AdditionalRenovations {{t|renovation}}+&lt;/samp>
| A comma-separated list of renovations to apply, each in the form &lt;samp>{{t|map patch ID}} {{t|required mail flag}} {{t|map asset if active}} {{t|map asset if inactive}} {{o|area rectangle}}&lt;/samp>. Fields:
{| class="wikitable"
|-
! field
! effect
|-
| &lt;samp>map patch ID&lt;/samp>
| A unique ID for the patch being applied. This is usually similar to the renovation name, but can be any unique value. If a renovation applies multiple map patches, each one must have unique ID.
|-
| &lt;samp>required mail flag&lt;/samp>
| The [[Modding:Mail data#Mail flags|mail flag]] that is checked on the house's owner  to decide whether the patch should be applied.
|-
| &lt;samp>map asset if active&lt;/samp>
| The asset name for the map applied when the mail flag is set, relative to the &lt;samp>Maps&lt;/samp> folder.
|-
| &lt;samp>map asset if inactive&lt;/samp>
| The asset name for the map applied when the mail flag is not set, relative to the &lt;samp>Maps&lt;/samp> folder.
|-
| &lt;samp>area rectangle&lt;/samp>
| ''(Optional)'' The tile area in the map to patch, specified as &lt;samp>{{t|X}} {{t|Y}} {{t|width}} {{t|height}}&lt;/samp>. If {{t|X}} isn't set, this defaults to the top-left corner of the map. If it is, you must specify all four values.
|}
|}

For example, this Content Patcher pack would add a renovation to the fully-upgraded farmhouse based on a custom &lt;samp>ExampleAuthor_PineapplesEverywhere_HasRenovation&lt;/samp> flag. Note that &lt;samp>TextOperations&lt;/samp> is used to avoid overwriting any renovations added by another mod, and &lt;samp>ExampleAuthor_PineapplesEverywhere_&lt;/samp> is a unique prefix for the hypothetical mod to avoid conflicts with other mods.
{{#tag:syntaxhighlight|
{
    "Format": "{{Content Patcher version}}",
    "Changes": [
        // add renovation
        {
            "Action": "EditMap",
            "Target": "Maps/FarmHouse2, Maps/FarmHouse2_marriage",
            "TextOperations": [
                {
                    "Operation": "Append",
                    "Target": [ "MapProperties", "AdditionalRenovations" ],
                    "Value": "ExampleAuthor_PineapplesEverywhere_KitchenUpgrade ExampleAuthor_PineapplesEverywhere_HasRenovation ExampleAuthor_PineapplesEverywhere_Kitchen ExampleAuthor_PineapplesEverywhere_Empty 0 19 3 3",
                    "Delimiter": "," // if there are already renovations, add a comma before this one
                }
            ]
        },

        // load renovation map patch
        {
            "Action": "Load",
            "Target": "Maps/ExampleAuthor_PineapplesEverywhere_Kitchen",
            "FromFile": "assets/kitchen-upgrade.tmx"
        },

        // load empty map (applied if renovation is inactive)
        {
            "Action": "Load",
            "Target": "Maps/ExampleAuthor_PineapplesEverywhere_Empty",
            "FromFile": "assets/kitchen-upgrade-empty.tmx"
        }
    ]
}|lang=javascript}}

===Custom floors/walls===
====In decoratable locations====
You can now change the walls/floors for decoratable locations (like farmhouses, cabins, or sheds) for flooring/painting/wallpaper placement just by editing map/tile properties.

First, you can define distinct areas using two new map properties:

{| class="wikitable"
|-
! valid in
! map property
! usage
|-
| ''decoratable locations''
| &lt;samp>FloorIDs {{o|area}}+&lt;/samp>&lt;br />&lt;samp>WallIDs {{o|area}}+&lt;/samp>&lt;br />
| A comma-separated list of the distinct areas which have flooring or walls. The &lt;samp>FloorIDs&lt;/samp> and &lt;samp>WallIDs&lt;/samp> don't need to match. Each area has the form &lt;code>{{t|area ID}} {{o|default flooring/wallpaper ID}}&lt;/code>, where:
* &lt;samp>{{t|area ID}}&lt;/samp> uniquely identifies the area or room.
* &lt;samp>{{o|default flooring/wallpaper ID}}&lt;/samp> (optional) sets the initial flooring/wallpaper ID if that area hasn't been customized by the player yet. This can be defined in three forms:
** &lt;code>{{t|index}}&lt;/code>: get the floor/wallpaper matching that index in the vanilla &lt;samp>Maps/walls_and_floors&lt;/samp> tilesheet.
** &lt;code>{{t|tilesheet}}:{{t|index}}&lt;/code>: add &lt;samp>Maps/{{t|tilesheet}}&lt;/samp> to the map, and match the index in that tilesheet.
** &lt;code>{{t|area ID}}&lt;/code>: inherit the default floor/wallpaper from the named area. For example, &lt;samp>Hallway_Bedroom Bedroom&lt;/samp> applies the bedroom wallpaper to the hallway between the bedroom and living room when the farmhouse is first upgraded.
** If omitted, the default will be flooring/wallpaper #0.

For example: &lt;pre>FloorIDs: Kitchen 22, LivingRoom Bedroom, Hallway_Bedroom Bedroom, Bedroom
WallIDs: LivingRoom, Hallway_Bedroom Bedroom, Bedroom&lt;/pre>

You don't need to add every area to the &lt;samp>FloorIDs&lt;/samp>/&lt;samp>WallIDs&lt;/samp> list; assigning a flooring/wall to an unlisted value will be handled correctly. You only really need to add an area to &lt;samp>FloorIDs&lt;/samp>/&lt;samp>WallIDs&lt;/samp> to set the default flooring/wallpaper value, or for cases where the order of the walls/floors is important (for backwards compatibility with code that sets wallpaper/flooring by an integer room index, as is the case with the floors/walls in the vanilla farmhouse).
|}

Then you can add individual tiles to each area with two new tile properties:

{| class="wikitable"
|-
! layer
! property
! effect
|-
| &lt;samp>Back&lt;/samp>
| &lt;samp>WallID {{t|area ID}}&lt;/samp>&lt;br />&lt;samp>FloorID {{t|area ID}}&lt;/samp>
| Adds this tile to the given floor/wall area. Each floor tile should have the &lt;samp>FloorID&lt;/samp> property, but only the top edge of the wall should have &lt;samp>WallID&lt;/samp>.
|}

====In the furniture catalogue====
You can also add new flooring/wallpaper options to the furniture catalogue by adding it to &lt;samp>Data/AdditionalWallpaperFlooring&lt;/samp>. Each entry consists of an object with these fields:

{| class="wikitable"
|-
! field
! description
|-
| &lt;samp>ID&lt;/samp>
| A unique ID value. This is not shown in-game.
|-
| &lt;samp>Texture&lt;/samp>
| The asset name which contains 32x32 pixel (flooring) or 16x48 pixel (wallpaper) sprites. The tilesheet must be 256 pixels wide, but can have any number of flooring/wallpaper rows.
|-
| &lt;samp>IsFlooring&lt;/samp>
| Whether this is a flooring tilesheet; else it's a wallpaper tilesheet.
|-
| &lt;samp>Count&lt;/samp>
| The number of flooring or wallpaper sprites in the tilesheet.
|}

For example, this Content Patcher pack would add three new wallpapers to the game:
{{#tag:syntaxhighlight|
{
    "Format": "{{Content Patcher version}}",
    "Changes": [
        // define wallpaper
        {
            "Action": "EditData",
            "Target": "Data/AdditionalWallpaperFlooring",
            "Entries": {
                "ExampleAuthor.CustomWallpapers": { // for technical reasons, you need to specify the ID here *and* in the "ID" field
                    "ID": "ExampleAuthor.CustomWallpapers",
                    "Texture": "Mods/ExampleAuthor.CustomWallpapers/Wallpapers",
                    "IsFlooring": false,
                    "Count": 3
                }
            }
        },

        // load wallpaper tilesheet
        {
            "Action": "Load",
            "Target": "Mods/ExampleAuthor.CustomWallpapers/Wallpapers",
            "FromFile": "assets/wallpapers.png"
        }
    ]
}|lang=javascript}}

===Map property changes===
{{main article|Modding:Maps#Known_properties}}
Stardew Valley 1.5.5 adds several map properties (in addition to those listed in their own sections):

{| class="wikitable"
|-
! valid in
! map property
! usage
|-
| ''any''
| &lt;samp>AllowGrassGrowInWinter T&lt;/samp>
| Allows [[grass]] to spread in winter.
|-
| ''any''
| &lt;samp>AllowGrassSurviveInWinter T&lt;/samp>
| Allows [[grass]] that's alive on the last day of fall to survive through to winter.
|-
| ''any''
| &lt;samp>ClearEmptyDirtOnNewMonth T&lt;/samp>
| Destroy most tilled dirt that doesn't contain crops when a new year starts.
|-
| ''any''
| &lt;samp>EnableGrassSpread T&lt;/samp>
| Gives [[grass]] in the location a chance to spread each day.
|-
| ''any''
| &lt;samp>ForceAllowTreePlanting T&lt;/samp>
| Allows planting trees (both wild and fruit) in this location, even if it normally wouldn't be allowed.
|-
| ''any''
| &lt;samp>IsFarm T&lt;/samp>
| Marks the location as a farm. This only affects generic location/interaction logic which checks the in-code &lt;code>location.IsFarm&lt;/code> property; logic hardcoded into the game's &lt;code>Farm&lt;/code> class (''e.g.,'' farm animals, pets, crows/scarecrows, greenhouse, farm buildings, etc) is still limited to the actual farm.
|-
| ''any''
| &lt;samp>IsGreenhouse T&lt;/samp>
| Marks the location as a greenhouse.
|-
| ''any''
| &lt;samp>SpawnGrassFromPathsOnNewYear T&lt;/samp>
| Spawns grass on every tile with index 22 on the &lt;samp>Paths&lt;/samp> layer when a new year starts. See also &lt;samp>SpawnRandomGrassOnNewYear&lt;/samp>.
|-
| ''any''
| &lt;samp>SpawnDebrisOnNewMonth T&lt;/samp>&lt;br />&lt;samp>SpawnDebrisOnNewYear T&lt;/samp>
| Spawns weeds, stones, or twigs at random positions when a new month/year starts (subject to their usual spawn rules).
|-
| ''any''
| &lt;samp>SpawnRandomGrassOnNewYear T&lt;/samp>
| Spawns grass at random positions when a new year starts (subject to its usual spawn rules). See also &lt;samp>SpawnGrassFromPathsOnNewYear&lt;/samp>.
|-
| farm
| &lt;samp>FarmFishLocationOverride {{t|location name}} {{t|chance}}&lt;/samp>
| Adds an alternative location name when catching fish, where the {{t|chance}} is a decimal value between 0 (never happens) and 1 (always happens). For example, &lt;samp>FarmFishLocationOverride Mountain 0.5&lt;/samp> adds a 50% chance of catching mountain fish instead of the normal fish for that location. The location name is case-sensitive, and matches those shown by the {{nexus mod|679|Debug Mode mod}}.
|-
| farm
| &lt;samp>FarmHouseFurniture [{{t|furniture ID}} {{t|tile X}} {{t|tile Y}} {{t|rotations}}]+&lt;/samp>
| Spawns initial furniture in the farmhouse when creating a new save. If you add multiple furniture to the same tile, the first one will be placed on the ground and the last one will be placed on the first one.&lt;br />This is also required to enable the &lt;samp>FarmHouseWallpaper&lt;/samp>, &lt;samp>FarmHouseFlooring&lt;/samp>, and &lt;samp>FarmHouseStarterSeedsPosition&lt;/samp> properties. You can enable it without spawning any furniture with &lt;samp>FarmHouseFurniture -1 0 0 0&lt;/samp>.
|-
| farm
| &lt;samp>FarmHouseFlooring {{t|flooring id}}&lt;/samp>
| Sets the initial farmhouse floor to the given ID when creating a new save. These are mapped to the 4x4 tile areas in the &lt;samp>Maps/walls_and_floors&lt;/samp> tilesheet starting at tile index 336 (where index 0 is mapped to the top-left square).&lt;br />This is only enabled if &lt;samp>FarmHouseFurniture&lt;/samp> is set.
|-
| farm
| &lt;samp>FarmHouseWallpaper {{t|wallpaper id}}&lt;/samp>
| Sets the initial farmhouse wallpaper to the given ID when creating a new save. These are mapped to the 1x4 tile areas in the &lt;samp>Maps/walls_and_floors&lt;/samp> tilesheet starting from the top-left.&lt;br />This is only enabled if &lt;samp>FarmHouseFurniture&lt;/samp> is set.
|-
| farm
| &lt;samp>FarmHouseStarterSeedsPosition {{t|tile X}} {{t|tile Y}}&lt;/samp>
| Sets the tile position in the farmhouse where the seed package is placed when creating a new save.&lt;br />This is only enabled if &lt;samp>FarmHouseFurniture&lt;/samp> is set.
|-
| farm
| &lt;samp>FarmOceanCrabPotOverride T&lt;/samp>
| Causes crab pots on the farm should catch ocean fish.
|-
| farm
| &lt;samp>SpawnBeachFarmForage T&lt;/samp>
| Randomly spawns beach forage and [[Supply Crate|supply crates]] on the farm (like the [[Farm Maps|vanilla beach farm]]). Forage and crates will only appear on tiles which have the &lt;samp>BeachSpawn T&lt;/samp> property on the &lt;samp>Back&lt;/samp> layer, are clear for placement, and don't have a tile on the &lt;samp>AlwaysFront&lt;/samp> layer.
|-
| farm
| &lt;samp>SpawnForestFarmForage T&lt;/samp>
| Randomly spawns forest forage on the farm (like the [[Farm Maps|vanilla forest farm]]). Forage will only spawn on tiles which have the &lt;samp>Type Grass&lt;/samp> tile property, are clear for placement, and don't have a tile on the &lt;samp>AlwaysFront&lt;/samp> layer.
|-
| farm
| &lt;samp>SpawnMountainFarmOreRect {{t|tile X}} {{t|tile Y}} {{t|tile width}} {{t|tile height}}&lt;/samp>
| The tile area on the farm map where ores should randomly spawn (like the [[Farm Maps|vanilla hilltop farm]]). Ores will only spawn on tiles which have the &lt;samp>Type Dirt&lt;/samp> tile property and are clear for object placement.
|-
| farmhouse
| &lt;samp>EntryLocation {{t|tile X}} {{t|tile Y}}&lt;/samp>
| Sets the tile on which the player appears when they warp into the farmhouse.
|}

And one new tile property:

{| class="wikitable"
|-
! layer
! property
! effect
|-
| &lt;samp>Back&lt;/samp>
| &lt;samp>TouchAction Warp {{t|area}} {{t|x}} {{t|y}} {{o|string prerequisite}}&lt;/samp>
| Adds a player-only warp on the tile to the specified location name and position. This is exactly equivalent to &lt;samp>TouchAction MagicWarp&lt;/samp>, but without the magic sound/visual effect.
|}

It also changes one tile property:
{| class="wikitable"
|-
! layer
! property
! effect
|-
| &lt;samp>Back&lt;/samp>
| &lt;samp>Water&lt;/samp>
| Setting the value to &lt;samp>I&lt;/samp> (uppercase i) will make the tile behave like normal water, but won't render the water animation overlay for it.
|}

===Non-Krobus roommates===
The game's [[marriage]] logic previously had hardcoded exceptions to treat [[Krobus]] as a roommate instead. That logic has been reworked so it can be applied to any NPC (including custom NPCs).

Specifically:
&lt;ul>
&lt;li>Items with the "&lt;samp>propose_roommate_{{t|NPC name}}&lt;/samp>" [[Modding:Items#Context tags|context tag]] will trigger a roommate proposal when given to the named NPC. The NPC name must be lowercase with underscores instead of spaces (''e.g.,'' &lt;samp>propose_roommate_dwarf&lt;/samp>).&lt;/li>
&lt;li>These [[Modding:Dialogue|dialogue keys]] apply before they move in:
{| class="wikitable"
|-
! content file
! key
! effect
|-
| &lt;samp>Strings/StringsFromCSFiles&lt;/samp>
| &lt;samp>{{t|NPC name}}_EngagedRoommate&lt;/samp>
| The NPC's roommate proposal accept dialogue.&lt;br />⚠ Ignored if you don't specify &lt;samp>Data/EngagementDialogue:{{t|NPC name}}Roommate0&lt;/samp>.&lt;br />For example: ''A Void Ghost pendant! How did you...?$3#$b#Oh, wow.$7#$b#@... yes, I'll come live with you, if you like. But we have to keep it secret from everyone.#$b#I'll be at your house in a few days... okay?$h''
|-
| &lt;samp>Strings/Characters&lt;/samp>
| &lt;samp>MovieInvite_NoTheater&lt;/samp>
| The NPC's roommate proposal rejection text when you don't meet the requirements (''i.e.,'' min friendship + house upgrade level, and not already having a roommate/spouse). This is the same dialogue used when you can't invite someone to the movies.
|-
| &lt;samp>Data/EngagementDialogue&lt;/samp>
| &lt;samp>{{t|NPC name}}Roommate0&lt;/samp>&lt;br />&lt;samp>{{t|NPC name}}Roommate1&lt;/samp>
| The NPC's normal dialogue after accepting the proposal, but before moving in. The &lt;samp>Roommate0&lt;/samp> variant is always used on the day the NPC accepted; on subsequent days the NPC randomly chooses &lt;samp>Roommate0&lt;/samp> or &lt;samp>Roommate1&lt;/samp>. If the &lt;samp>Roommate0&lt;/samp> variant isn't defined, the NPC will use the normal &lt;samp>{{t|NPC Name}}0&lt;/samp> and &lt;samp>{{t|NPC Name}}1&lt;/samp> keys. If the &lt;samp>Roommate0&lt;/samp> variant is defined, &lt;samp>Roommate1&lt;/samp> must be set too to avoid errors.&lt;br />For example: ''@... I'm afraid we'll have to keep this a secret... Neither my people nor yours would accept us living together.''
|}

And after they move in:
{| class="wikitable"
|-
! content file
! key
! effect
|-
| &lt;samp>Characters/Dialogue/MarriageDialogue{{t|NPC name}}Roommate&lt;/samp>
| ''all keys''
| Equivalent to &lt;samp>Characters/Dialogue/MarriageDialogue{{t|NPC name}}&lt;/samp>, but only applies if the NPC is a roommate. If the file exists, it completely replaces the spouse version; otherwise the game defaults to the spouse version.
|-
| &lt;samp>Characters/Dialogue/MarriageDialogue&lt;/samp>
| &lt;samp>*Roommate&lt;/samp>
| Keys with the &lt;samp>Roommate&lt;/samp> suffix take priority if they exist (only in this file, not the &lt;samp>MarriageDialogue{{t|NPC name}}&lt;/samp> files).
|-
| &lt;samp>Data/Festivals/*&lt;/samp>
| &lt;samp>{{t|NPC name}}_roommate&lt;/samp>
| The NPC's normal dialogue at the festival if they're a roommate. If the key isn't defined, they'll use &lt;samp>{{t|NPC name}}_spouse&lt;/samp> instead.
|}

And for other NPCs:
{| class="wikitable"
|-
! content file
! key
! effect
|-
| &lt;samp>Characters/Dialogue/*&lt;/samp>
| &lt;samp>*_roommate_*&lt;/samp>
| Equivalent to the &lt;samp>*_inlaw_*&lt;/samp> infix in [[Modding:Dialogue#Generic dialogue|generic dialogue]], used if you're a roommate with the NPC. If not defined, the game will fallback to the non-infixed dialogue (it won't use the &lt;samp>*_inlaw_*&lt;/samp> variant).
|}&lt;/li>
&lt;li>Roommates will sleep in a [[Single Bed]] if one is available and unused in the house; otherwise they'll use a double bed like a normal spouse. (Krobus is an exception, since he doesn't sleep in a bed.)&lt;/li>
&lt;li>Added [[Modding:Event data#Event preconditions|event preconditions]] to check whether the local player has a roommate (&lt;samp>R&lt;/samp>) or doesn't have a roommate (&lt;samp>Rf&lt;/samp>). This can be combined with &lt;samp>O {{t|NPC name}}&lt;/samp> to check for a specific roommate, like &lt;samp>R/O Abigail&lt;/samp>.&lt;/li>
&lt;/ul>

===Custom mail formatting===
You can now customize [[Modding:Mail data|mail]] and [[Secret Notes|secret notes]] by including three custom commands in the letter text (including the &lt;samp>[]&lt;/samp> characters):
{| class="wikitable"
|-
! command
! effect
|-
| &lt;samp>[letterbg {{t|index}}]&lt;/samp>
| Changes the default letter background to a vanilla background from &lt;samp>LooseSprites/letterBG&lt;/samp>. The index can be 0 (default letter), 1 (Sandy's lined paper), 2 (Wizard style), or 3 (Krobus style). This will also set the default text color for that style, unless overridden by &lt;samp>textcolor&lt;/samp>.
|-
| &lt;samp>[letterbg {{t|asset name}} {{t|index}}]&lt;/samp>
| Changes the default letter background to the given texture. The asset name should match a texture containing two rows: one with 320x180 pixel letter background images, and one with 24x24 pixel button backgrounds shown behind attached items. The index is the sprite to use from those rows, starting at 0 for the first one.
Only the first 4 letter background images of a row will be properly displayed.
Only one row of button may exist.
See image below
|-
| &lt;samp>[textcolor {{t|color}}]&lt;/samp>
| Changes the letter text color. The valid colors are &lt;samp>black&lt;/samp>, &lt;samp>blue&lt;/samp>, &lt;samp>cyan&lt;/samp>, &lt;samp>gray&lt;/samp>, &lt;samp>green&lt;/samp>, &lt;samp>orange&lt;/samp>, &lt;samp>purple&lt;/samp>, &lt;samp>red&lt;/samp>, and &lt;samp>white&lt;/samp>.
|}


[[File:Lettersbglayers.png|center|thumb|Example : the letters  background images can go on the pale pink, pink and purple spaces, while the buttons can only go on the orange line.]]

===Custom scarecrows===
You can now mark any placeable item as a [[scarecrow]] with two new [[Modding:Items#Context tags|context tags]]:

{| class="wikitable"
|-
! context tag
! effect
|-
| &lt;samp>crow_scare&lt;/samp>
| Sets the item as a placeable scarecrow. If not set, the item is considered a scarecrow if its default name contains the substring &lt;code>arecrow&lt;/code> (like before).
|-
| &lt;samp>crow_scare_radius_{{t|radius}}&lt;/samp>
| If the item is a scarecrow, sets the radius that it covers. If not set, the scarecrow defaults to 17 if the default name contains the substring &lt;code>Deluxe&lt;/code> and 9 otherwise.
|}

===Improved map seats===
{{main article|Modding:Maps#Sitting on non-furniture chairs}}

When defining map seats via &lt;samp>Data\ChairTiles&lt;/samp> (see [[Modding:Migrate to Stardew Valley 1.5#Sitting on non-furniture chairs|docs in the 1.5 migration guide]]), you can now set the type field to &lt;samp>custom {{t|offset_x}} {{t|offset_y}} {{t|extra_height}}&lt;/samp> to override the hardcoded offset and height values in code. The three values are measured in tiles (''e.g.,'' an X offset value of 0.5 would shift the sitting location by half a tile).

==See also==
* [[User:Pathoschild/Modding wishlist/Completed#Done in Stardew Valley 1.5.5|Modding wishlist items done in Stardew Valley 1.5.5]]

[[Category:Modding]]

[[es:Modding:Migrar a Stardew Valley 1.5.5]]
[[zh:模组:迁移至游戏本体1.5.5]]
</textarea><div class="templatesUsed"><div class="mw-templatesUsedExplanation"><p>Templates used on this page:
</p></div><ul>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Template:Content_Patcher_version" title="Template:Content Patcher version">Template:Content Patcher version</a> (<a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Template:Content_Patcher_version&amp;action=edit" title="Template:Content Patcher version">view source</a>) </li><li><a href="../../external.html?link=https://stardewvalleywiki.com/Template:Main_article" title="Template:Main article">Template:Main article</a> (<a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Template:Main_article&amp;action=edit" title="Template:Main article">view source</a>) </li><li><a href="../../external.html?link=https://stardewvalleywiki.com/Template:Modder_compatibility_header" title="Template:Modder compatibility header">Template:Modder compatibility header</a> (<a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Template:Modder_compatibility_header&amp;action=edit" title="Template:Modder compatibility header">view source</a>) </li><li><a href="../../external.html?link=https://stardewvalleywiki.com/Template:Nexus_mod" title="Template:Nexus mod">Template:Nexus mod</a> (<a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Template:Nexus_mod&amp;action=edit" title="Template:Nexus mod">view source</a>) </li><li><a href="../../external.html?link=https://stardewvalleywiki.com/Template:O" title="Template:O">Template:O</a> (<a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Template:O&amp;action=edit" title="Template:O">view source</a>) </li><li><a href="../../external.html?link=https://stardewvalleywiki.com/Template:T" title="Template:T">Template:T</a> (<a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Template:T&amp;action=edit" title="Template:T">view source</a>) </li><li><a href="../../external.html?link=https://stardewvalleywiki.com/Template:Version" title="Template:Version">Template:Version</a> (<a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Template:Version&amp;action=edit" title="Template:Version">view source</a>) </li></ul></div><p id="mw-returnto">Return to <a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Migrate_to_Stardew_Valley_1.5.5" title="Modding:Migrate to Stardew Valley 1.5.5">Modding:Migrate to Stardew Valley 1.5.5</a>.</p>
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="../../external.html?link=https://stardewvalleywiki.com/Modding:Migrate_to_Stardew_Valley_1.5.5">https://stardewvalleywiki.com/Modding:Migrate_to_Stardew_Valley_1.5.5</a>"</div>
</div>
			<div class="post-content" id="page-secondary-actions">
			
			</div>
		</main>
		<footer class="mw-footer minerva-footer">
		
		<div class="post-content footer-content">
			
			<h2>Stardew Valley Wiki</h2>
			<div class="license">Content is available under <a class="external" rel="nofollow" href="../../external.html?link=https://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike</a> unless otherwise noted.</div>
			<ul class="footer-info hlist hlist-separated">
				
			</ul>
			<ul class="footer-places hlist hlist-separated">
				<li id="footer-places-privacy"><a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:Privacy_policy" title="Stardew Valley Wiki:Privacy policy">Privacy policy</a></li><li id="footer-places-about"><a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:About" title="Stardew Valley Wiki:About">About Stardew Valley Wiki</a></li><li id="footer-places-disclaimer"><a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:General_disclaimer" title="Stardew Valley Wiki:General disclaimer">Disclaimers</a></li><li id="footer-places-desktop-toggle"><a id="mw-mf-display-toggle" href="../../external.html?link=http://stardewvalleywiki.com/mediawiki/index.php?title=Modding:Migrate_to_Stardew_Valley_1.5.5&amp;action=edit&amp;mobileaction=toggle_view_desktop">Desktop</a></li>
			</ul>
		</div>
		</footer>
	</div>
</div>
<div class="mw-notification-area" data-mw="interface"></div>
<!-- v:8.3.0 -->

<script src="../../external.html?link=https://www.googletagmanager.com/gtag/js?id=G-1S37VCXXZ9" async=""></script><script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-1S37VCXXZ9', {"anonymize_ip":true});
</script>

<script>(window.NORLQ=window.NORLQ||[]).push(function(){var ns,i,p,img;ns=document.getElementsByTagName('noscript');for(i=0;i<ns.length;i++){p=ns[i].nextSibling;if(p&&p.className&&p.className.indexOf('lazy-image-placeholder')>-1){img=document.createElement('img');img.setAttribute('src',p.getAttribute('data-src'));img.setAttribute('width',p.getAttribute('data-width'));img.setAttribute('height',p.getAttribute('data-height'));img.setAttribute('alt',p.getAttribute('data-alt'));p.parentNode.replaceChild(img,p);}}});</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":75});});</script>		</body>
		
<!-- Mirrored from stardewvalleywiki.com/mediawiki/index.php?title=Modding:Migrate_to_Stardew_Valley_1.5.5&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 11 Apr 2024 05:34:16 GMT -->
</html>
		