
<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">


<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>Modding:Modder Guide/APIs/Harmony - Stardew Valley Wiki</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":!1,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"0a905c927b9ecf60e299227a","wgCSPNonce":!1,"wgCanonicalNamespace":"Modding","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":570,"wgPageName":"Modding:Modder_Guide/APIs/Harmony","wgTitle":"Modder Guide/APIs/Harmony","wgCurRevisionId":150590,"wgRevisionId":150590,"wgArticleId":9905,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Modding"],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"Modding:Modder_Guide/APIs/Harmony","wgRelevantArticleId":9905,"wgIsProbablyEditable":!1,"wgRelevantPageIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[],
"wgMFDisplayWikibaseDescriptions":{"search":!1,"nearby":!1,"watchlist":!1,"tagline":!1},"wgCargoMapClusteringMinimum":80,"wgCargoMonthNames":["January","February","March","April","May","June","July","August","September","October","November","December"],"wgCargoMonthNamesShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgCargoWeekDays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"wgCargoWeekDaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};RLSTATE={"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","ext.pygments":"ready","skins.vector.styles.legacy":"ready","mediawiki.toc.styles":"ready"};RLPAGEMODULES=["site","mediawiki.page.startup","mediawiki.page.ready","mediawiki.toc","skins.vector.legacy.js"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@1hzgi",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});});</script>
<link rel="stylesheet" href="loadb7e5.css?lang=en&amp;modules=ext.pygments%7Cmediawiki.toc.styles%7Cskins.vector.styles.legacy&amp;only=styles&amp;skin=vector"/>
<script async="" src="load52c0.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="load2f5e.css?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.35.1"/>
<meta name="robots" content="noindex,nofollow"/>
<meta name="description" content="Creating SMAPI mods"/>
<link rel="shortcut icon" href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/favicon.png"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/opensearch_desc.php" title="Stardew Valley Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="../../external.html?link=http://stardewvalleywiki.com/mediawiki/api.php?action=rsd"/>
<link rel="license" href="../../external.html?link=https://creativecommons.org/licenses/by-nc-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="Stardew Valley Wiki Atom feed" href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<meta property="og:title" content="Modding:Modder Guide/APIs/Harmony - Stardew Valley Wiki"/>
<meta property="og:site_name" content="Stardew Valley Wiki"/>
<meta property="og:url" content="https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Harmony"/>
<meta property="og:description" content="Creating SMAPI mods"/>
<meta property="og:image" content="https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/site_logo_sm.png"/>
<meta property="twitter:site" content="@stardewwiki"/>
<meta property="twitter:title" content="Modding:Modder Guide/APIs/Harmony - Stardew Valley Wiki"/>
<meta property="twitter:description" content="Creating SMAPI mods"/>
<meta property="twitter:image" content="https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/site_logo_sm.png"/>
<meta property="twitter:card" content="summary_large_image"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"article","name":"Modding:Modder Guide\/APIs\/Harmony - Stardew Valley Wiki","headline":"Modding:Modder Guide\/APIs\/Harmony - Stardew Valley Wiki","mainEntityOfPage":"Modding:Modder Guide\/APIs\/Harmony","identifier":"https:\/\/stardewvalleywiki.com\/Modding:Modder_Guide\/APIs\/Harmony","url":"https:\/\/stardewvalleywiki.com\/Modding:Modder_Guide\/APIs\/Harmony","description":"Creating SMAPI mods","dateModified":"2023-09-30T22:39:56Z","datePublished":"2023-09-30T22:39:56Z","image":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png"},"author":{"@type":"Organization","name":"Stardew Valley Wiki","url":"\/\/stardewvalleywiki.com","logo":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png","caption":"Stardew Valley Wiki"}},"publisher":{"@type":"Organization","name":"Stardew Valley Wiki","url":"\/\/stardewvalleywiki.com","logo":{"@type":"ImageObject","url":"https:\/\/stardewvalleywiki.com\/mediawiki\/extensions\/StardewValley\/images\/site_logo_sm.png","caption":"Stardew Valley Wiki"}},"potentialAction":{"@type":"SearchAction","target":"https:\/\/stardewvalleywiki.com\/mediawiki\/index.php?title=Special:Search&search={search_term}","query-input":"required name=search_term"}}</script>
<!--[if lt IE 9]><script src="/mediawiki/resources/lib/html5shiv/html5shiv.js"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-570 ns-subject page-Modding_Modder_Guide_APIs_Harmony rootpage-Modding_Modder_Guide skin-vector action-view minerva--history-page-action-enabled skin-vector-legacy">
<div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body" role="main">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Modding:Modder Guide/APIs/Harmony</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From Stardew Valley Wiki</div>
		<div id="contentSub"><span class="subpages">&lt; <a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide" class="mw-redirect" title="Modding:Modder Guide">Modding:Modder Guide</a>&lrm; | <a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs" title="Modding:Modder Guide/APIs">APIs</a></span><div class="mw-revision warningbox"><div id="mw-revision-info">Revision as of 22:39, 30 September 2023 by <a href="../../external.html?link=https://stardewvalleywiki.com/User:Pathoschild" class="mw-userlink" title="User:Pathoschild"><bdi>Pathoschild</bdi></a> <span class="mw-usertoollinks">(<a href="../../external.html?link=https://stardewvalleywiki.com/User_talk:Pathoschild" class="mw-usertoollinks-talk" title="User talk:Pathoschild">talk</a> | <a href="../../external.html?link=https://stardewvalleywiki.com/Special:Contributions/Pathoschild" class="mw-usertoollinks-contribs" title="Special:Contributions/Pathoschild">contribs</a>)</span> <span class="comment">(<span dir="auto"><span class="autocomment"><a href="#When_to_use_Harmony">→‎When to use Harmony</a>: </span> clarify version compatibility note</span>)</span></div><div id="mw-revision-nav">(<a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Modding:Modder_Guide/APIs/Harmony&amp;diff=prev&amp;oldid=150590" title="Modding:Modder Guide/APIs/Harmony">diff</a>) <a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Modding:Modder_Guide/APIs/Harmony&amp;direction=prev&amp;oldid=150590" title="Modding:Modder Guide/APIs/Harmony">← Older revision</a> | Latest revision (diff) | Newer revision → (diff)</div></div></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div style="float: right; border: 2px solid rgb(0, 116, 72); background: #A1DEE2; padding: 0.75em; padding-top: 0.5em; margin: 0 0 2em 2em;">
<p><span style="font-size: larger;"><b>Creating SMAPI mods</b> <a href="../../external.html?link=https://stardewvalleywiki.com/File:SMAPI_mascot.png" class="image"><img alt="SMAPI mascot.png" src="../../external.html?link=https://stardewvalleywiki.com/mediawiki/images/thumb/9/96/SMAPI_mascot.png/25px-SMAPI_mascot.png" decoding="async" width="25" height="25" srcset="/mediawiki/images/thumb/9/96/SMAPI_mascot.png/38px-SMAPI_mascot.png 1.5x, /mediawiki/images/thumb/9/96/SMAPI_mascot.png/50px-SMAPI_mascot.png 2x" /></a></span>
</p>
<hr />
<ul><li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/Get_Started" title="Modding:Modder Guide/Get Started">Get started</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/Game_Fundamentals" title="Modding:Modder Guide/Game Fundamentals">Game fundamentals</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/Test_and_Troubleshoot" title="Modding:Modder Guide/Test and Troubleshoot">Test &amp; troubleshoot</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/Release" title="Modding:Modder Guide/Release">Release</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs" title="Modding:Modder Guide/APIs">API reference</a>
<dl><dd>Basic SMAPI APIs:
<ul><li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Mod_structure" title="Modding:Modder Guide/APIs/Mod structure">Mod structure</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Manifest" title="Modding:Modder Guide/APIs/Manifest">Manifest</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Events" title="Modding:Modder Guide/APIs/Events">Events</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Config" title="Modding:Modder Guide/APIs/Config">Configuration</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Content" title="Modding:Modder Guide/APIs/Content">Load &amp; edit content</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Data" title="Modding:Modder Guide/APIs/Data">Data</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Input" title="Modding:Modder Guide/APIs/Input">Input</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Logging" title="Modding:Modder Guide/APIs/Logging">Logging</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Reflection" title="Modding:Modder Guide/APIs/Reflection">Reflection</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Multiplayer" title="Modding:Modder Guide/APIs/Multiplayer">Multiplayer</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Translation" title="Modding:Modder Guide/APIs/Translation">Translation</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Update_checks" title="Modding:Modder Guide/APIs/Update checks">Update checks</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Utilities" title="Modding:Modder Guide/APIs/Utilities">Utilities</a></li></ul></dd>
<dd>Advanced SMAPI APIs:
<ul><li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Content_Packs" title="Modding:Modder Guide/APIs/Content Packs">Content packs</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Console" title="Modding:Modder Guide/APIs/Console">Mod console commands</a></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Integrations" title="Modding:Modder Guide/APIs/Integrations">Mod integrations</a></li>
<li><a class="mw-selflink selflink">Harmony patching</a></li></ul></dd></dl></li>
<li><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Index#Advanced_topics" title="Modding:Index">Specific guides</a></li></ul>
</div><p>← <span style="font-size: smaller;"><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Index" title="Modding:Index">Modding:Index</a></span>
<style data-mw-deduplicate="TemplateStyles:r130583">.mw-parser-output .decorativequotemark{font-family:"Georgia","Times New Roman","Times",serif;font-size:5em;line-height:0.02em;font-weight:bold;color:rgb(41,129,178);border-right:1px solid rgb(47,148,204);padding:25px 0.06em 0em 0.2em}.mw-parser-output .quotetext{font-family:"Georgia","Times New Roman","Times",serif;font-size:1.1em;font-style:italic;line-height:1.5em;padding-left:15px}.mw-parser-output .quotesource{text-align:left;font-size:0.9em;font-style:italic;margin-top:0;padding-left:120px}</style>
</p><table>

<tbody><tr>
<td rowspan="2" class="decorativequotemark">&#8220;
</td>
<td class="quotetext">&#8220;Here be dragons. Thou art forewarned.&#8221;
</td></tr>
</tbody></table>
<p><a rel="nofollow" class="external text" href="../../external.html?link=https://github.com/pardeike/Harmony">Harmony</a> lets you patch or replace methods, effectively rewriting the game code. SMAPI includes a copy of Harmony for mods to use.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none" /><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#When_to_use_Harmony"><span class="tocnumber">1</span> <span class="toctext">When to use Harmony</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#How_to_use_it"><span class="tocnumber">2</span> <span class="toctext">How to use it</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Best_practices"><span class="tocnumber">3</span> <span class="toctext">Best practices</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#FAQs"><span class="tocnumber">4</span> <span class="toctext">FAQs</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Which_version_of_Harmony_should_I_use.3F"><span class="tocnumber">4.1</span> <span class="toctext">Which version of Harmony should I use?</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Why_should_I_avoid_Harmony_annotations_and_PatchAll.3F"><span class="tocnumber">4.2</span> <span class="toctext">Why should I avoid Harmony annotations and PatchAll?</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#What_is_inlining_and_why_does_it_matter.3F"><span class="tocnumber">4.3</span> <span class="toctext">What is inlining and why does it matter?</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="When_to_use_Harmony">When to use Harmony</span></h2>
<p><b>Harmony should be a last resort.</b> It's a powerful tool that lets you do things that may be harder otherwise, but it comes with significant disadvantages:
</p>
<ul><li>It's very easy to cause crashes, errors, or subtle bugs, including difficult-to-diagnose memory corruption errors.</li>
<li>SMAPI often can't detect incompatible Harmony code.</li>
<li>SMAPI often can't rewrite Harmony patches for compatibility, so the mod may break on other platforms (e.g. Android) or in future game updates.</li>
<li>Patches may conflict with other Harmony mods, sometimes in ways that are difficult to troubleshoot.</li>
<li>Patches may have unpredictable effects on other mods that aren't using Harmony. That may also irritate other modders, if players often report bugs to other mods due to your patches.</li>
<li>Patches may prevent you from attaching a debugger when testing (even when you're testing unrelated code).</li>
<li>If someone else's mod calls code you patched and that code crashes, the error will be logged under their mod's name (unless you handle errors). This can cause players to report bugs to other authors, which can be irritating if they know it's due to your mod.</li>
<li>SMAPI will show a warning when your mod is loaded saying it may affect game stability.</li></ul>
<p>You should only use Harmony if you're sure what you want isn't feasible without it. For example: instead of patching logic that handles player interaction, you can detect and suppress the interaction using <a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Input" title="Modding:Modder Guide/APIs/Input">SMAPI's input API</a>, and run your own code to handle it.
</p>
<h2><span class="mw-headline" id="How_to_use_it">How to use it</span></h2>
<p><b>Harmony should be a last resort</b> (see the previous section).
</p>
<ol>
<li>Edit your mod's <samp>.csproj</samp> project file, and add this to the first <samp>&lt;PropertyGroup&gt;</samp> section:
<div class="mw-highlight mw-highlight-lang-xml mw-content-ltr" dir="ltr"><pre><span></span><span class="nt">&lt;EnableHarmony&gt;</span>true<span class="nt">&lt;/EnableHarmony&gt;</span>
</pre></div></li>
<li>In your mod's <samp>Entry</samp> method, use Harmony's code API to register patches:
<div class="mw-highlight mw-highlight-lang-c# mw-content-ltr" dir="ltr"><pre><span></span><span class="kt">var</span> <span class="n">harmony</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Harmony</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">ModManifest</span><span class="p">.</span><span class="n">UniqueID</span><span class="p">);</span>

<span class="c1">// example patch, you&#39;ll need to edit this for your patch</span>
<span class="n">harmony</span><span class="p">.</span><span class="n">Patch</span><span class="p">(</span>
   <span class="n">original</span><span class="p">:</span> <span class="n">AccessTools</span><span class="p">.</span><span class="n">Method</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">StardewValley</span><span class="p">.</span><span class="n">Object</span><span class="p">),</span> <span class="n">nameof</span><span class="p">(</span><span class="n">StardewValley</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">canBePlacedHere</span><span class="p">)),</span>
   <span class="n">prefix</span><span class="p">:</span> <span class="k">new</span> <span class="n">HarmonyMethod</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ObjectPatches</span><span class="p">),</span> <span class="n">nameof</span><span class="p">(</span><span class="n">ObjectPatches</span><span class="p">.</span><span class="n">CanBePlacedHere_Prefix</span><span class="p">))</span>
<span class="p">);</span>
</pre></div></li>
<li>See the <a rel="nofollow" class="external text" href="../../external.html?link=https://harmony.pardeike.net/">Harmony tutorials and documentation</a>.</li>
</ol>
<h2><span class="mw-headline" id="Best_practices">Best practices</span></h2>
<ol>
<li>See <a href="#When_to_use_Harmony">when to use Harmony</a>.</li>
<li>Unhandled errors in a patch can be hard to troubleshoot, which often leads to players asking for help on the SMAPI page instead of your mod. <b>Please</b> handle errors, log them, and default to the original code. For example:
<div class="mw-highlight mw-highlight-lang-c# mw-content-ltr" dir="ltr"><pre><span></span><span class="k">internal</span> <span class="k">class</span> <span class="nc">ObjectPatches</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="n">IMonitor</span> <span class="n">Monitor</span><span class="p">;</span>

    <span class="c1">// call this method from your Entry class</span>
    <span class="k">internal</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">IMonitor</span> <span class="n">monitor</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Monitor</span> <span class="p">=</span> <span class="n">monitor</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// patches need to be static!</span>
    <span class="k">internal</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">CanBePlacedHere_Prefix</span><span class="p">(</span><span class="n">StardewValley</span><span class="p">.</span><span class="n">Object</span> <span class="n">__instance</span><span class="p">,</span> <span class="n">GameLocation</span> <span class="n">location</span><span class="p">,</span> <span class="n">Vector2</span> <span class="n">tile</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">bool</span> <span class="n">__result</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="p">...;</span> <span class="c1">// your patch logic here</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span> <span class="c1">// don&#39;t run original logic</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Monitor</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="err">$</span><span class="s">&quot;Failed in {nameof(CanBePlacedHere_Prefix)}:\n{ex}&quot;</span><span class="p">,</span> <span class="n">LogLevel</span><span class="p">.</span><span class="n">Error</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span> <span class="c1">// run original logic</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</li>
<li>Use postfixes when possible for best compatibility and stability.</li>
<li>Don't use transpile patches unless you have no choice and you know what you're doing. This has a much higher chance of causing issues, is more fragile and likely to break in game updates, and makes it much less likely that other modders can help if you need it.</li>
<li><a href="#How_to_use_it">Use the code API</a> instead of annotations like <samp>[HarmonyPatch]</samp> (see <i><a href="#Why_should_I_avoid_Harmony_annotations_and_PatchAll.3F">Why should I avoid Harmony annotations and <samp>PatchAll</samp>?</a></i>).</li>
</ol>
<h2><span class="mw-headline" id="FAQs">FAQs</span></h2>
<h3><span id="Which_version_of_Harmony_should_I_use?"></span><span class="mw-headline" id="Which_version_of_Harmony_should_I_use.3F">Which version of Harmony should I use?</span></h3>
<p>The Harmony version is managed by SMAPI (currently 2.1.<i>x</i>). If you <a href="#How_to_use_it">use the <samp>EnableHarmony</samp> option</a>, you'll use the version bundled with SMAPI automatically.
</p>
<h3><span id="Why_should_I_avoid_Harmony_annotations_and_PatchAll?"></span><span class="mw-headline" id="Why_should_I_avoid_Harmony_annotations_and_PatchAll.3F">Why should I avoid Harmony annotations and <samp>PatchAll</samp>?</span></h3>
<p>There are two ways to add patches:
</p>
<ul><li><a href="#How_to_use_it">Use the code API</a> (recommended).</li>
<li>Use annotations like <samp>[HarmonyPatch]</samp> on static classes, then call Harmony's <samp>PatchAll</samp> to dynamically scan the assembly for those annotations. This is fragile and discouraged.</li></ul>
<p>For context, SMAPI automatically rewrites mods when needed for compatibility. That's used to keep mods working when there are breaking changes in the game/SMAPI/Harmony, or to handle crossplatform differences (e.g. using PC mods on Android). For example, the Stardew Valley 1.5.5 update broke most C# mods, but nearly all of them were fixed automatically by SMAPI's rewriting.
</p><p>However annotations work differently in the compiled code, so SMAPI can't rewrite them. That means mods which use annotations are more fragile; they may break without warning in future game/SMAPI/Harmony updates, and may not work on some platforms.
</p>
<h3><span id="What_is_inlining_and_why_does_it_matter?"></span><span class="mw-headline" id="What_is_inlining_and_why_does_it_matter.3F">What is inlining and why does it matter?</span></h3>
<p><a rel="nofollow" class="external text" href="../../external.html?link=https://en.wikipedia.org/wiki/Inline_expansion">Inlining</a> is when the JIT takes a method call and sticks the body of the method called instead of emitting an actual call. If this happens, a harmony patch applied to the callee will not take effect.
</p><p>The heuristics the JIT uses to decide whether or not to inline a method are not documented and are subject to change, but <a rel="nofollow" class="external text" href="../../external.html?link=https://stackoverflow.com/a/31467000/19366602">small, simple methods that do not throw exceptions</a> are the most likely to be inlined. Additionally, the heuristic seems to change between platform and platform, with mac being more aggressive than Windows.
</p>
<!-- 
NewPP limit report
Cached time: 20240502175745
Cache expiry: 86400
Dynamic content: false
Complications: []
CPU time usage: 0.040 seconds
Real time usage: 0.409 seconds
Preprocessor visited node count: 69/1000000
Post‐expand include size: 1920/2097152 bytes
Template argument size: 67/2097152 bytes
Highest expansion depth: 4/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 5268/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   14.713      1 -total
 78.86%   11.603      1 Template:Quote
 10.48%    1.542      1 Template:Github
  9.53%    1.402      1 Modding:Modder_Guide/header
-->

<!-- Saved in parser cache with key enwiki:pcache:idhash:9905-0!canonical and timestamp 20240502175744 and revision id 150590
 -->
</div></div><div class="printfooter">Retrieved from "<a dir="ltr" href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Modding:Modder_Guide/APIs/Harmony&amp;oldid=150590">https://stardewvalleywiki.com/mediawiki/index.php?title=Modding:Modder_Guide/APIs/Harmony&amp;oldid=150590</a>"</div>
		<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="../../external.html?link=https://stardewvalleywiki.com/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="../../external.html?link=https://stardewvalleywiki.com/Category:Modding" title="Category:Modding">Modding</a></li></ul></div></div>
	</div>
</div>

<div id="mw-navigation">
	<h2>Navigation menu</h2>
	<div id="mw-head">
		<!-- Please do not use role attribute as CSS selector, it is deprecated. -->
<nav id="p-personal" class="vector-menu" aria-labelledby="p-personal-label" role="navigation" 
	 >
	<h3 id="p-personal-label">
		<span>Personal tools</span>
	</h3>
	<!-- Please do not use the .body class, it is deprecated. -->
	<div class="body vector-menu-content">
		<!-- Please do not use the .menu class, it is deprecated. -->
		<ul class="vector-menu-content-list"><li id="pt-createaccount"><a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Special:CreateAccount&amp;returnto=Modding%3AModder+Guide%2FAPIs%2FHarmony&amp;returntoquery=oldid%3D150590" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li><li id="pt-login"><a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Special:UserLogin&amp;returnto=Modding%3AModder+Guide%2FAPIs%2FHarmony&amp;returntoquery=oldid%3D150590" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li></ul>
		
	</div>
</nav>


		<div id="left-navigation">
			<!-- Please do not use role attribute as CSS selector, it is deprecated. -->
<nav id="p-namespaces" class="vector-menu vector-menu-tabs vectorTabs" aria-labelledby="p-namespaces-label" role="navigation" 
	 >
	<h3 id="p-namespaces-label">
		<span>Namespaces</span>
	</h3>
	<!-- Please do not use the .body class, it is deprecated. -->
	<div class="body vector-menu-content">
		<!-- Please do not use the .menu class, it is deprecated. -->
		<ul class="vector-menu-content-list"><li id="ca-nstab-modding" class="selected"><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Harmony">Modding</a></li><li id="ca-talk" class="new"><a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Modding_talk:Modder_Guide/APIs/Harmony&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></li></ul>
		
	</div>
</nav>


			<!-- Please do not use role attribute as CSS selector, it is deprecated. -->
<nav id="p-variants" class="vector-menu-empty emptyPortlet vector-menu vector-menu-dropdown vectorMenu" aria-labelledby="p-variants-label" role="navigation" 
	 >
	<input type="checkbox" class="vector-menu-checkbox vectorMenuCheckbox" aria-labelledby="p-variants-label" />
	<h3 id="p-variants-label">
		<span>Variants</span>
	</h3>
	<!-- Please do not use the .body class, it is deprecated. -->
	<div class="body vector-menu-content">
		<!-- Please do not use the .menu class, it is deprecated. -->
		<ul class="menu vector-menu-content-list"></ul>
		
	</div>
</nav>


		</div>
		<div id="right-navigation">
			<!-- Please do not use role attribute as CSS selector, it is deprecated. -->
<nav id="p-views" class="vector-menu vector-menu-tabs vectorTabs" aria-labelledby="p-views-label" role="navigation" 
	 >
	<h3 id="p-views-label">
		<span>Views</span>
	</h3>
	<!-- Please do not use the .body class, it is deprecated. -->
	<div class="body vector-menu-content">
		<!-- Please do not use the .menu class, it is deprecated. -->
		<ul class="vector-menu-content-list"><li id="ca-view" class="collapsible selected"><a href="../../external.html?link=https://stardewvalleywiki.com/Modding:Modder_Guide/APIs/Harmony">Read</a></li><li id="ca-viewsource" class="collapsible"><a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Modding:Modder_Guide/APIs/Harmony&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li><li id="ca-history" class="collapsible"><a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Modding:Modder_Guide/APIs/Harmony&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></li></ul>
		
	</div>
</nav>


			<!-- Please do not use role attribute as CSS selector, it is deprecated. -->
<nav id="p-cactions" class="vector-menu-empty emptyPortlet vector-menu vector-menu-dropdown vectorMenu" aria-labelledby="p-cactions-label" role="navigation" 
	 >
	<input type="checkbox" class="vector-menu-checkbox vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
	<h3 id="p-cactions-label">
		<span>More</span>
	</h3>
	<!-- Please do not use the .body class, it is deprecated. -->
	<div class="body vector-menu-content">
		<!-- Please do not use the .menu class, it is deprecated. -->
		<ul class="menu vector-menu-content-list"></ul>
		
	</div>
</nav>


			<div id="p-search" role="search">
	<h3 >
		<label for="searchInput">Search</label>
	</h3>
	<form action="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php" id="searchform">
		<div id="simpleSearch">
			<input type="search" name="search" placeholder="Search Stardew Valley Wiki" title="Search Stardew Valley Wiki [f]" accesskey="f" id="searchInput"/>
			<input type="hidden" name="title" value="Special:Search">
			<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/>
			<input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>
		</div>
	</form>
</div>

		</div>
	</div>
	
<div id="mw-panel">
	<div id="p-logo" role="banner">
		<a  title="Visit the main page" class="mw-wiki-logo" href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki"></a>
	</div>
	<!-- Please do not use role attribute as CSS selector, it is deprecated. -->
<nav id="p-navigation" class="vector-menu vector-menu-portal portal portal-first" aria-labelledby="p-navigation-label" role="navigation" 
	 >
	<h3 id="p-navigation-label">
		<span>Navigation</span>
	</h3>
	<!-- Please do not use the .body class, it is deprecated. -->
	<div class="body vector-menu-content">
		<!-- Please do not use the .menu class, it is deprecated. -->
		<ul class="vector-menu-content-list"><li id="n-mainpage-description"><a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki" title="Visit the main page [z]" accesskey="z">Main page</a></li><li id="n-recentchanges"><a href="../../external.html?link=https://stardewvalleywiki.com/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-Admin-noticeboard"><a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:Admin_noticeboard">Admin noticeboard</a></li><li id="n-Help-Editing"><a href="../../external.html?link=https://stardewvalleywiki.com/Help:Editing">Help Editing</a></li><li id="n-randompage"><a href="../../external.html?link=https://stardewvalleywiki.com/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li></ul>
		
	</div>
</nav>


	<!-- Please do not use role attribute as CSS selector, it is deprecated. -->
<nav id="p-Official Links" class="vector-menu vector-menu-portal portal" aria-labelledby="p-Official Links-label" role="navigation" 
	 >
	<h3 id="p-Official Links-label">
		<span>Official Links</span>
	</h3>
	<!-- Please do not use the .body class, it is deprecated. -->
	<div class="body vector-menu-content">
		<!-- Please do not use the .menu class, it is deprecated. -->
		<ul class="vector-menu-content-list"><li id="n-Official-Site"><a href="../../external.html?link=https://stardewvalley.net/" rel="nofollow">Official Site</a></li><li id="n-Official-Forums"><a href="../../external.html?link=https://forums.stardewvalley.net/" rel="nofollow">Official Forums</a></li><li id="n-Official-Merchandise"><a href="../../external.html?link=https://www.stardewvalley.net/shop/" rel="nofollow">Official Merchandise</a></li><li id="n-Discord"><a href="../../external.html?link=https://discord.com/invite/stardewvalley" rel="nofollow">Discord</a></li><li id="n-Reddit"><a href="../../external.html?link=https://www.reddit.com/r/StardewValley" rel="nofollow">Reddit</a></li></ul>
		
	</div>
</nav>

<!-- Please do not use role attribute as CSS selector, it is deprecated. -->
<nav id="p-tb" class="vector-menu vector-menu-portal portal" aria-labelledby="p-tb-label" role="navigation" 
	 >
	<h3 id="p-tb-label">
		<span>Tools</span>
	</h3>
	<!-- Please do not use the .body class, it is deprecated. -->
	<div class="body vector-menu-content">
		<!-- Please do not use the .menu class, it is deprecated. -->
		<ul class="vector-menu-content-list"><li id="t-whatlinkshere"><a href="../../external.html?link=https://stardewvalleywiki.com/Special:WhatLinksHere/Modding:Modder_Guide/APIs/Harmony" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="../../external.html?link=https://stardewvalleywiki.com/Special:RecentChangesLinked/Modding:Modder_Guide/APIs/Harmony" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-upload"><a href="../../external.html?link=http://stardewvalleywiki.com/Special:Upload" title="Upload files [u]" accesskey="u">Upload file</a></li><li id="t-specialpages"><a href="../../external.html?link=https://stardewvalleywiki.com/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="javascript:print();" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Modding:Modder_Guide/APIs/Harmony&amp;oldid=150590" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Modding:Modder_Guide/APIs/Harmony&amp;action=info" title="More information about this page">Page information</a></li><li id="t-cargopagevalueslink"><a href="../../external.html?link=https://stardewvalleywiki.com/mediawiki/index.php?title=Modding:Modder_Guide/APIs/Harmony&amp;action=pagevalues" rel="cargo-pagevalues">Page values</a></li></ul>
		
	</div>
</nav>


	
</div>

</div>

<footer id="footer" class="mw-footer" role="contentinfo" >
	<ul id="footer-info" >
		<li id="footer-info-lastmod"> This page was last edited on 30 September 2023, at 22:39.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="../../external.html?link=https://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike</a> unless otherwise noted.</li>
	</ul>
	<ul id="footer-places" >
		<li id="footer-places-privacy"><a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:Privacy_policy" title="Stardew Valley Wiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:About" title="Stardew Valley Wiki:About">About Stardew Valley Wiki</a></li>
		<li id="footer-places-disclaimer"><a href="../../external.html?link=https://stardewvalleywiki.com/Stardew_Valley_Wiki:General_disclaimer" title="Stardew Valley Wiki:General disclaimer">Disclaimers</a></li>
		<li id="footer-places-mobileview"><a href="../../external.html?link=http://stardewvalleywiki.com/mediawiki/index.php?title=Modding:Modder_Guide/APIs/Harmony&amp;oldid=150590&amp;mobileaction=toggle_view_mobile" class="noprint stopMobileRedirectToggle">Mobile view</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico"><a href="../../external.html?link=https://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="../../external.html?link=https://stardewvalleywiki.com/mediawiki/resources/assets/licenses/cc-by-nc-sa.png" alt="Creative Commons Attribution-NonCommercial-ShareAlike" width="88" height="31" loading="lazy"/></a></li>
		<li id="footer-poweredbyico"><a href="../../external.html?link=https://www.mediawiki.org/"><img src="../../external.html?link=https://stardewvalleywiki.com/mediawiki/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/mediawiki/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /mediawiki/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"/></a></li>
	</ul>
	<div style="clear: both;"></div>
</footer>



<script src="../../external.html?link=https://www.googletagmanager.com/gtag/js?id=G-1S37VCXXZ9" async=""></script><script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-1S37VCXXZ9', {"anonymize_ip":true});
</script>

<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.040","walltime":"0.409","ppvisitednodes":{"value":69,"limit":1000000},"postexpandincludesize":{"value":1920,"limit":2097152},"templateargumentsize":{"value":67,"limit":2097152},"expansiondepth":{"value":4,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":5268,"limit":5000000},"timingprofile":["100.00%   14.713      1 -total"," 78.86%   11.603      1 Template:Quote"," 10.48%    1.542      1 Template:Github","  9.53%    1.402      1 Modding:Modder_Guide/header"]},"cachereport":{"timestamp":"20240502175745","ttl":86400,"transientcontent":false}}});mw.config.set({"wgBackendResponseTime":127});});</script></body>

</html>

